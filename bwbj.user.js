// ==UserScript==
// @name         冰蛙宝鉴
// @namespace    SMTH
// @version      3.4.4
// @description  随时随地通过API接口看你想看！
// @author       bingri[1523812] kaeru[1769499] htys[1545351] mirrorhye[2564936] tobytorn[1617955] Microdust[2587304]
// @match        https://www.torn.com/*
// @grant        GM_xmlhttpRequest
// @grant        GM.xmlHttpRequest
// @connect      *
// @connect      tornsmth.website
// @require      https://cdn.staticfile.org/xlsx/0.17.5/xlsx.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js
// @downloadURL  https://github.com/raichuq/unlock-music/raw/refs/heads/master/bwbj.user.js
// @updateURL    https://github.com/raichuq/unlock-music/raw/refs/heads/master/bwbj.user.js
// ==/UserScript==
function bingwaMain(){"use strict";if(!window.BINGWA){window.BINGWA=!0,console.log("冰蛙启动");const ue=window.jQuery;var f,b,m,y,o;f=ue,b=window,m=document,o="tornInputMoney",f.fn[o]=function(t){if("string"==typeof t){var e,a=t,n=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!f.data(this,"plugin_"+o)||"function"!=typeof f.data(this,"plugin_"+o)[a])throw new Error("Method "+a+" does not exist on jQuery."+o);e=f.data(this,"plugin_"+o)[a].apply(this,n)}),e!==y?e:this}if("object"==typeof t||!t)return this.each(function(){f.data(this,"plugin_"+o)||f.data(this,"plugin_"+o,new zt(this,t))})};const me=Object.freeze({GM:"gm",PDA:"pda",OTHER:"other"});let e=me.OTHER;"function"==typeof GM_xmlhttpRequest?e=me.GM:"object"==typeof GM&&"function"==typeof GM.xmlHttpRequest?(e=me.GM,window.GM_xmlhttpRequest=GM.xmlHttpRequest):"function"==typeof PDA_httpGet&&(e=me.PDA);const ye=[{name:"foo",title:"阅兵助手",desc:"在部分页面显示阅兵按钮，可以快速获取玩家信息",default:!1},{name:"noAssisting",title:"防打重",desc:"如果已有其他人进入战斗则屏蔽JOIN按钮",default:!1},{name:"mugoo",title:"山贼助手",desc:"在市场列表界面显示用户状态和攻击链接",default:!0},{name:"travelFilter",title:"飞花过滤",desc:"在海外市场页面屏蔽不重要物品",default:!0},{name:"jailView",title:"监狱助手",desc:"在监狱页面屏蔽分数大于10000的目标，本帮人员置顶高亮显示",default:!0},{name:"crimeView",title:"犯罪助手",desc:"在犯罪界面显示额外信息",default:!1},{name:"stockexchange_show_abbr",title:"股票助手",desc:"在股票交易市场页面的股票名称前显示缩写",default:!0},{name:"gym_show_ratio",title:"健身房助手",desc:"在健身房页面显示推荐的属性比例",default:!0},{name:"common_modify_header_links",title:"顶部快捷入口",desc:"在页面顶部添加一些常用页面的链接",default:!0},{name:"hide_cloud_while_flying",title:"飞行无云",desc:"在飞行界面隐藏飞机和云彩",default:!0},{name:"withdrawal_helper",title:"取钱助手",desc:"右下角聊天people框高亮显示帮派可取钱名单",default:!0},{name:"bigger_screen_on_laptop",title:"laptop大屏",desc:"飞行中使用笔记本电脑时可以全屏显示",default:!0},{name:"taking_off_reminder",title:"起飞吃药提醒",desc:"起飞前根据CD提醒吃药和OC",default:!0},{name:"bounty_parade",title:"悬赏阅兵",desc:"报纸-悬赏页面显示目标BS",default:!1},{name:"nurse_suggestion",title:"护士建议",desc:"智能提醒出院吃药",default:!0},{name:"extra_recent_attacks",title:"更多最近攻击(帮派)",desc:"帮派chain页面显示更多5分钟内攻击记录(减少错过的复仇)",default:!1},{name:"shows_bingwa_icon",title:"显示冰蛙图标",desc:"在侧边栏显示冰蛙图标，可以作为冰蛙的快速入口",default:!0},{name:"wawa_detection_cache",title:"蛙蛙探测缓存",desc:"缓存蛙蛙探测结果30秒",default:!0}];ye.forEach(t=>{var e=Kt("BWM_SETTINGS",t.name);null==e&&Yt("BWM_SETTINGS",t.name,String(t.default)),window[t.name]="true"==Kt("BWM_SETTINGS",t.name)});let u=localStorage.getItem("APIKey");const xe={20465:"SMTH - Phoenix Nirvana",36134:"SMTH - Silver Hand",10741:"SMTH - Trisolary",16335:"SMTH - November Chopin",16424:"SMTH - HoYoverse",9356:"SMTH - Party Animals",27902:"SMTH - Concord",11796:"SMTH - Bright Summit",14633:"SMTH - Hermit Sage"};var n,a,d,i,t,r,s,l,c,p,h={8836:"Vinerri",2095:"Guerrilla Warfare",11356:"-UGK-",31312:"TORNado",8255:"Scream Silence",26312:"The Avengers",28205:"Invictus",10913:"Unbroken Warriors",8510:"Ara Pacis",5113:"ThugLife",13343:"The Defiant",39756:"Abusement Park",38761:"Shadow Healers",42125:"Octogenarian DirtyBombers",35739:"Kingsmen",14820:"Unbroken Legion",10140:"In Memory of the Fallen",9405:"Lake Of Lerna",30085:"Rampage Total Destruction"};const ve={gray:"#adadad",red:"#ff7373",green:"#8fbc8f",blue:"#65a5d1",purple:"#8d6dd7",yellow:"#f39826",yellowgreen:"#83a000",pink:"#e467b3",salmon:"#F9CDAD",orange:"#FFDEAD"};if(jt(".bw-hidden { display: none !important }"),jt(`.bw-no-select {
-webkit-user-select: none;
-khtml-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
-o-user-select: none;
user-select: none;
}`),jt(`.bw-chat-withdraw .bw-chat-withdraw-btn {
margin-left: auto;
height: fit-content;
background-color: #adadad;
color: white;
cursor: pointer;
padding: 2px;
}`),jt(`.bw-chat-withdraw.bw-chat-withdraw-amount .bw-chat-withdraw-btn {
background-color: #8fbc8f;
}`),jt(`.bw-shared-armory {
height: 100%;
float: right;
margin-right: 4px;
display: flex;
align-items: center;
}`),jt(`.bw-shared-armory > div {
padding: 4px;
border-radius: 4px;
line-height: 1;
}`),Date.prototype.format=function(t){var e,a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(e in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t},function(){var e=Kt("APICache_companies","last-updated");if(null!=e&&null!=e){var a=new Date;let t=new Date(e);t.setDate(t.getDate()+1),t<a&&ce()}else ce()}(),travelFilter&&function(){const r={186:"绵羊",187:"泰迪熊",215:"猫咪",258:"美洲豹",261:"貂熊",266:"尼斯湖水怪",268:"赤狐",269:"猴子",273:"岩羚羊",274:"大熊猫",281:"狮子",384:"骆驼",618:"黄貂鱼",260:"大丽花",263:"番红花",264:"兰花",267:"帚石楠",271:"木棉花",272:"雪绒花",276:"牡丹花",277:"樱花",282:"非洲堇",385:"蒺藜花",617:"香蕉兰",256:"催泪弹",226:"烟雾弹",222:"闪光弹",616:"鳟鱼"},t=ue(".travel-agency-market ul.users-list li"),s=new Set([8,11,20,21,26,31,50,63,99,107,108,110,111,159,175,177,178,229,230,231,232,259,399,409,432,640,612,613,614,615,619,620,621,622,623,624,625,626,196,197,201,205,252,253,262,402,410,413,645,240,241,242,243,265,419,420,421,430,196,197,198,201,203,205,217,218,219,220,221,397,408,411,415,416,418,431,438,439,641,196,198,199,203,204,255,257,270,333,391,407,196,198,199,201,203,204,223,224,361,398,435,436,197,198,200,203,204,205,233,234,235,236,237,238,239,278,279,334,395,427,429,433,434,197,199,200,201,204,244,245,246,247,248,249,250,251,275,400,381,382,383,386,387,388,412,414,440,4,199,200,201,203,225,227,228,280,332,406,651,652,653,654]);if(0<t.length&&"filtered"!=t.attr("filtered")){let i=parseInt(ue("div.delimiter div.msg:contains(You have purchased) span.bold").last().text());var e=parseInt(ue(ue("div.delimiter div.msg:contains(You have purchased) span.bold").get(-2)).text());i-=e,(isNaN(i)||i<=0)&&(i=1),t.each((t,e)=>{var a=parseInt(ue(e).find("div.details").attr("itemid"));if(isNaN(a)||!(0<a))return!1;if(s.has(a))ue(e).addClass("hide");else{const n=ue(e).find("input#item-"+a)[0];if(n.value=i,n.dispatchEvent(new Event("blur")),r[a]){a=r[a];const o=ue(e).find("span.name");o.html(o.html()+"<span style='float:right;padding-right:10px;'>"+a+"</span>")}}}),t.attr("filtered","filtered")}ue("#show_more").length<1&&(ue(".travel-agency-market").after("<div><div id='show_more' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;background-color:#c0542f;text-align:center;'>点击显示全部</div></div>"),ue("#show_more").click(function(){ue(this).parent().remove(),t.removeClass("hide")}))}(),common_modify_header_links&&pe(),setInterval(function(){const t=ue("[class*=chat-box-header__info-btn___]").closest("[class*=chat-box___]");t.each(function(){var e=ue(this).find("[class*=chat-box-header__name___]").text();if(e){let t=null;const i=ue(this).find("[class*=chat-box-message__timestamp___]").last();var a=Number(i.find("[data-bw-chat-ts]").attr("data-bw-chat-ts")),n=i.text().trim().match(/^(\d\d):(\d\d)(\([0-9mhd]*\))?$/);if(a?t=new Date(1e3*a):n&&(o=n[1],t=new Date,t.setUTCHours(o<=t.getUTCHours()?o:o-24)),t){var a=t.getUTCDate().toString().padStart(2,0),n=(t.getUTCMonth()+1).toString().padStart(2,0),o=t.getUTCFullYear().toString().slice(2),o=`${t.getUTCHours()}:${t.getMinutes()}:00 - ${a}/${n}/${o} TCT`;const r=ue(this).find("[class*=chat-box-message__message___]").toArray().slice(-5).map(t=>`[${ue(t).text()}]`);Yt("CHAT_LAST_MESSAGE",e,o+"|||"+r.join(""))}}})},1e3),function(){setInterval(function(){const t=ue("#chatRoot [class*=chat-box___] [class*=chat-box-body___]");e.disconnect(),t.each(function(){ue(this).children("div").each(function(){n(this)}),e.observe(this,{childList:!0})})},1e3);const e=new MutationObserver(function(t){for(const e of t)for(const a of e.addedNodes)n(a)});function n(t){if(!function(a){const n=ue(a).find("[class*=chat-box-message__timestamp___] p");if(!(0===n.length||0<n.find(".bw-chat-ts").length)){const l=new Date;var o=Math.floor(l.getTime()/1e3);const d=n.text().trim();var i=d.match(/^(\d\d):(\d\d)$/);const c=d.match(/^([A-Za-z]+) (\d\d):(\d\d)$/);var r,s=d.match(/^(\d\d):(\d\d):\d\d - (\d\d)\/(\d\d)\/(\d\d)$/);i?(r=l.getUTCHours(),a=parseInt(i[1]),l.setUTCHours(a<=r?a:a-24),l.setUTCMinutes(parseInt(i[2]))):c?(i={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[c[1].toLowerCase()],i=(l.getUTCDay()+7-i)%7,l.setUTCDate(l.getUTCDate()-(i||0)),l.setUTCHours(parseInt(c[2])),l.setUTCMinutes(parseInt(c[3]))):s&&(l.setUTCHours(parseInt(s[1])),l.setUTCMinutes(parseInt(s[2])),l.setUTCDate(parseInt(s[3])),l.setUTCMonth(parseInt(s[4])-1),l.setUTCFullYear(parseInt(s[5])+2e3));s=Math.floor(l.getTime()/1e3),o=o-s;let t="",e="";86400<=o?(t=`(${Math.floor(o/86400)}d)`,e="t-red"):3600<=o?(t=`(${Math.floor(o/3600)}h)`,e="t-yellow"):0<o&&(t=`(${Math.floor(o/60)}m)`,e="t-green"),n.append(`<span class="bw-chat-ts ${e}" data-bw-chat-ts="${s}" style="margin-left: 4px">${t}</span>`)}}(t),!ue(t).is(".bw-chat-withdraw")&&0!==ue(t).find("[class*=chat-box-message__avatar___]").length){const o=ue(t).find("[class*=chat-box-message__message___]").text().match(/(\bwithdraw|取)(.*)/i);if(o){ue(t).addClass("bw-chat-withdraw");let a=0;const i=o[2].match(/([\.0-9]+)([k|m|b]?)/i);if(i){var e=i[1].replace(/,/g,""),n=i[2].toLowerCase();let t=1;"k"==n?t=1e3:"m"==n?t=1e6:"b"==n&&(t=1e9),a=parseInt(parseFloat(e)*t)}ue(t).toggleClass("bw-chat-withdraw-amount",0<a);const r=ue(t).find("a").last();e=r.text().replace(/[:\s]/g,"");const s=r.attr("href")||"",l=s.substr(s.indexOf("XID=")+4),d=`${e} [${l}]`;ue(t).find("div[class*=chat-box-message--public___]").append('<div class="bw-chat-withdraw-btn bw-no-select">取</div>'),ue(t).find(".bw-chat-withdraw-btn").click(function(){console.log(`${d} ${a}`);const t=window.location.href;if(t.indexOf("#/tab=controls")<0||0<=t.indexOf("option")&&t.indexOf("giveMoneyTo")<0){const e=`https://www.torn.com/factions.php?step=your#/tab=controls&giveMoneyTo=${l}&money=${a}`;window.location.href=e,0<=t.indexOf("factions.php")&&setTimeout(()=>{window.location.href=e,location.reload()},500)}else!function(t,e){const a=ue(".money-wrap").children(".give-block");ue("input#money-user").val(t).addClass("chosen"),a.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",Bt(e)),a.children(".inputs-wrap").children(".radio-wp").children(".btn-wrap").children(".btn").children().attr("disabled",!1).removeClass("disabled"),a.children(".inputs-wrap").children(".radio-wp").find("#give-money").click()}(d,a)})}}}}(),setInterval(function(){if(0<ue("#profile-mini-root").children().children("[class^=profile-mini-_userImageWrapper]").length&&!ue("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").attr("hasdone")){ue("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").attr("hasdone","1");const t=ue("#profile-mini-root").children().children("[class^=profile-mini-_userImageWrapper]").children("a"),e=t?t.attr("href"):void 0,n=e?e.substr(20):void 0;n&&ae(n,function(t){var e=ue("#profile-mini-root").children().css("background-color");ue("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").append(`
<div id="bingwa-mini-profile" class="border-round" style="overflow: hidden; width:254px; height:26px; position: absolute; right: -6px; top: -2px; z-index: 1; color: #fff ;background-image: linear-gradient(${e},#888 25%,${e}); border: 1px solid #000; margin: 5px; text-align: center;">
<div id="bingwa-mini-profile-bs" style="float: left; width:112px; height:16px; background-color: ${ve.purple}; border: 1px solid #000; margin: 4px 2px 4px 4px; text-align: center;"></div>
<div id="bingwa-mini-profile-hp" style="float: left; width:104px; height:16px; background-color: #fff; border: 1px solid #000; margin: 4px 2px; text-align: center;"></div>
<div id="bingwa-mini-profile-attack" style="float: left; width:16px; height:16px; background-color: ${ve.red}; border: 1px solid #000; margin: 4px 4px 4px 2px; text-align: center;"></div>
</div>`);e=`/loader.php?sid=attack&user2ID=${n}`;ue("#bingwa-mini-profile-attack").html(`<div style="padding: 2px 0px; text-shadow: none;"><a href="${e}" style="color:#fff;text-decoration: none;">打</a></div>`),Yt("battlestats",n,t.estimate_bs),ue("#bingwa-mini-profile-bs").html(`<div style="padding: 2px 0px;">${t.estimate_bs_display}</div>`);let a=parseInt(100*t.life.current/t.life.maximum);100<a&&(a=100);e=t.life.current+"/"+t.life.maximum+" ("+a+"%)";a<=66?ue("#bingwa-mini-profile-hp").html(te(16,a,"#c0542f","#fff",e)):ue("#bingwa-mini-profile-hp").html(te(16,a,"#5d9525","#fff",e)),ue("#bingwa-mini-profile-last").html(`<div style="padding: 2px 0px;">${t.last_action_details}</div>`)})}},500),withdrawal_helper&&he(),hide_cloud_while_flying&&0<ue("#plane").length&&(ue("#clouds-1").remove(),ue("#clouds-2").remove(),ue("#clouds-3").remove(),ue("#plane").children().remove()),bigger_screen_on_laptop&&0<ue(".computer-wrap").length&&(ue(".computer-navigation").insertBefore(".computer-wrap"),ue("#computer-content-wrapper").insertBefore(".computer-wrap"),ue(".computer-wrap").css("visibility","hidden"),ue(".computer-navigation").attr("style","position: unset; margin-bottom: 10px;"),ue("#computer-content-wrapper").removeClass("left"),ue("#computer-content-wrapper").css("margin","auto")),0<=window.location.href.indexOf("loader.php?sid=racing")&&setInterval(function(){ue(".bar-tpl-wrap:not([show-value])").each(function(t,e){let a=0,n=0,o=0;o=ue(e).hasClass("negative")?(a=parseFloat(ue(e).find(".progress-light-gray")[0].style.width),n=parseFloat(ue(e).find(".progress-red")[0].style.width),a=parseFloat(a*n/100),a-n):ue(e).hasClass("positive")?(n=parseFloat(ue(e).find(".progress-light-gray")[0].style.width),a=parseFloat(ue(e).find(".progress-light-green")[0].style.width),n=parseFloat(a*n/100),a-n):(n=parseFloat(ue(e).find(".progress-")[0].style.width),0),ue(e).css("line-height","17px").css("margin-top","0px").css("width","88px").html("<span style='color: gray'>"+n.toFixed(2)+"</span>"+(0<=o?" + ":" - ")+Math.abs(o).toFixed(2)),ue(e).css("color",0<=o?"green":"red"),ue(e).attr("show-value","show-value")})},500),0<=window.location.href.indexOf("shops.php?step=bitsnbobs")&&ue(".buy-flexslider input[name^=buyAmount]").val("100"),0<=window.location.href.indexOf("factions.php?step=your")){class t{constructor(){this.data=null,this.error=null,this.whitelist=new Set,this.load()}async load(){try{var t=await ne("https://bingwa-api.tornsmth.website/faction-loan/data.json"),e=JSON.parse(t),a=e.expire,n=Math.floor((new Date).getTime()/1e3);!a||a<n?this.error="数据过期":this.data=e.data}catch(t){this.error=t.toString(),console.log("Fail to load loan data:",t)}}}const we=new t;function g(t){t=t.match(/\[(\d+)\]$/);const e=t?t[1]:"";return e.match(/^\d+$/)?parseInt(ue(`ul.money-depositors > li.depositor[user-id=${e}] div.amount [data-value]`).attr("data-value")):0}function x(){var t=JSON.parse(ue("#websocketConnectionData").text());return t.playername+" ["+t.userID+"]"}function v(e,a){const n=g(a);if(void 0===n||isNaN(n))e.text("").append(`<span>${a}</span><span class ='right'>$error</span>`);else{let t="$"+n;0!=n&&(t=n.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}).replace(/^[^\$]\S+/,function(t){return"$"+t})),t.includes("-")?e.text("").append(`<span>${a}</span><span class ='t-red right'>${t}</span>`):e.text("").append(`<span>${a}</span><span class ='right'>${t}</span>`)}}function w(){const o=ue(".money-wrap").children(".give-block"),a="give-money",i="array";function r(){ue(".button-wrap").remove(),t()}function t(){const n=Kt(a,i);var t=function(){let a=`<div class="button-wrap" style="margin:2px;">
<span id="deposit-self" class="border-round" style="display:inline-block; cursor:pointer; margin:2px; padding:3px; color:white; background-color:${ve.purple};">给自己</span>`;return n.forEach((t,e)=>{a+=(t=t,`<span id="deposit${e}" class="deposit-money-btn border-round" style="display:inline-block; cursor:pointer; margin:2px; padding:3px; color:white; background-color:${ve.blue};">${t.button_name}</span>`)}),a+=`<span id="deposit-add" class="border-round" style="display:inline-block; cursor:pointer; margin:2px; padding:3px; color:white; background-color:${ve.green};">+</span>
<span id="deposit-all" class="border-round" style="display:inline-block; cursor:pointer; margin:2px; padding:3px; color:white; background-color:${ve.blue};">全取</span>
<span id="deposit-remove" class="border-round" style="display:inline-block; cursor:pointer; margin:2px; padding:3px; color:white; background-color:${ve.red};">x</span>
</div>`,a}();o.before(t),ue("#deposit-add").click(()=>{0<ue("#deposit-input").length||(ue("#deposit-add").html('<span style="display: inline-block;"><input id="deposit-input" type="text" class="border-round"></input>'),ue("#deposit-input").tornInputMoney({groupMoneyClass:null}),ue("#deposit-input").focus(),ue("#deposit-input").blur(()=>{var t=ue("#deposit-input").val();let e=n;e.push({button_name:`取${Wt(Lt("$"+t))}`,"button-value":t}),Yt(a,i,e),r()}))}),ue("#deposit-remove").click(()=>{ue("#deposit-remove").hasClass("deposit-removing")?(ue(".deposit-money-btn").css("background-color",ve.blue),ue(".deposit-money-btn").removeClass("deposit-removing"),ue("#deposit-remove").css("background-color",ve.red),ue("#deposit-remove").removeClass("deposit-removing")):(ue(".deposit-money-btn").css("background-color",ve.red),ue(".deposit-money-btn").addClass("deposit-removing"),ue("#deposit-remove").css("background-color",ve.salmon),ue("#deposit-remove").addClass("deposit-removing"))}),ue("#deposit-self").click(()=>{ue("input#money-user").val(x()).addClass("chosen")}),n.forEach((t,e)=>{ue(`#deposit${e}`).click(()=>{if(ue(`#deposit${e}`).hasClass("deposit-removing")){let t=n;return t.splice(e,1),Yt(a,i,t),void r()}o.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t["button-value"]),o.children(".inputs-wrap").children(".radio-wp").children(".btn-wrap").children(".btn").children().attr("disabled",!1).removeClass("disabled"),o.children(".inputs-wrap").children(".radio-wp").find("#give-money").click()})}),ue("#deposit-all").click(()=>{const e=ue("#money-user").val();if(""===e)alert("全取请先输入玩家ID");else{let t=g(e);var a;t<0&&"string"==typeof e&&!we.error&&we.data&&((a=e.match(/\[(\d+)\]$/))&&(a=a[1],a=we.data[a]||0,t+=a)),0<t&&(o.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",Bt(t)),o.children(".inputs-wrap").children(".radio-wp").children(".btn-wrap").children(".btn").children().attr("disabled",!1).removeClass("disabled"))}})}Kt(a,i)||Yt(a,i,[{button_name:"取1m","button-value":"1,000,000"},{button_name:"取5m","button-value":"5,000,000"},{button_name:"取10m","button-value":"10,000,000"},{button_name:"取25m","button-value":"25,000,000"}]),ue(".button-wrap").length<1&&t()}setInterval(function(){if(0!==ue("#before-value").length){const o=ue("#money-user").val();if("string"==typeof o){var e=o.match(/\[(\d+)\]$/);if(e){var a=e[1];ue("#username-value").html(`<div style="padding: 3px 0px;">${ue("#money-user").val()}</div>`);var n=g(o);0<=n?(ue("#before-value").css("background-color","var(--default-green-color)").html(`<div style="padding: 3px 0px;">${Lt(n)}</div>`),ue("#before-title").css("color","var(--default-green-color)")):(ue("#before-value").css("background-color","var(--default-red-color)").html(`<div style="padding: 3px 0px;">${Lt(n)}</div>`),ue("#before-title").css("color","var(--default-red-color)"));e=Bt(ue(".money-wrap").find(".count.input-money").first().val()),n=n-e;0<=n?(ue("#after-value").css("background-color","var(--default-green-color)").html(`<div style="padding: 3px 0px;">${Lt(n)}</div>`),ue("#after-title").css("color","var(--default-green-color)")):(ue("#after-value").css("background-color","var(--default-red-color)").html(`<div style="padding: 3px 0px;">${Lt(n)}</div>`),ue("#after-title").css("color","var(--default-red-color)"));let t=0<=n;!we.error&&we.data?(e=we.data[a]||0,-n<=e?(t=!0,ue("#loan-value").css("background-color","var(--default-green-color)").html(`<div style="padding: 3px 0px;">${Lt(e)}</div>`),ue("#loan-title").css("color","var(--default-green-color)")):(ue("#loan-value").css("background-color","var(--default-red-color)").html(`<div style="padding: 3px 0px;">${Lt(e)}</div>`),ue("#loan-title").css("color","var(--default-red-color)"))):we.error?(ue("#loan-value").css("background-color","var(--default-red-color)").html(`<div style="padding: 3px 0px;">加载失败: ${we.error}</div>`),ue("#loan-title").css("color","var(--default-red-color)")):(ue("#loan-value").css("background-color","var(--default-blue-color)").html('<div style="padding: 3px 0px;">正在加载</div>'),ue("#loan-title").css("color","var(--default-blue-color)")),"checked"!==ue(".money-wrap .give-block .inputs-wrap .radio-wp #give-money").attr("checked")&&(t=!0),we.whitelist.has(a)&&(t=!0),ue(".money-wrap .give-block .action-confirm .btn-wrap button").attr("disabled",!t),t?ue("#bw-check-loan").hide():ue("#bw-check-loan").show().attr("data-uid",a)}}}},1e3);function _(e,a,n){let o=Lt(a);if(0<=a){let t=100*a/n;"准备金率"==e&&(t=Math.min(100*a,100),o=(100*a).toFixed(2)+"%"),ue("#faction_balance_li").append(`
<div style="overflow:hidden; margin:7px; border:1px solid gray;">
<div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${te(22,0,"var(--default-green-color)","var(--default-bg-panel-color)",e)}</div>
<div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${te(22,t,"var(--default-green-color)","var(--default-bg-panel-color)",o)}</div>
</div>`)}else{n=100*a/n+100;ue("#faction_balance_li").append(`
<div style="overflow:hidden; margin:7px; border:1px solid gray;">
<div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${te(22,n,"var(--default-bg-panel-color)","var(--default-red-color)",e)}</div>
<div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${te(22,0,"var(--default-red-color)","var(--default-bg-panel-color)",o)}</div>
</div>`)}}let e=new MutationObserver(function(t,e){!function(){const t=ue("div#money-user-cont").find("li.ui-custom-item");!ue("input#money-user")||"."!=ue("input#money-user").val()&&" "!=ue("input#money-user").val()||(ue("input#money-user").val(x()).addClass("chosen"),console.log(x()),v(t.children(),x())),0<t.length&&!t.children().text().includes("$")&&!t.hasClass("empty")&&t.each(function(){var t=ue(this).children().text();v(ue(this).children(),t)})}(),w(),function(){ue("div.input-money-group").attr("class","input-money-group no-max-value");const t=ue("ul.money-depositors").children("li.depositor");if(0<ue("div.give-block").length&&ue("#faction_balance_li").length<=0&&0<t.length){var e=Bt(ue(".money-wrap").children(".balance-message").children(".sum-of-deposit").text()),o=Bt(ue(".money-wrap").children(".balance-message").children(".faction-balance").text());let a=0,n=0;t.each((t,e)=>{e=parseInt(ue(e).find("span.money").attr("data-value"));0<e?a+=e:n+=e});var i=parseInt(o)+parseInt(e),r=Math.max(Math.abs(e),Math.abs(o),Math.abs(a),Math.abs(n),Math.abs(i));ue("#money").children(".balance-message").after(`
<div id="faction_balance_li" style="width:290px; border:4px solid gray; padding:5px 2px; margin:0px 0px 5px 5px; background-image: linear-gradient(rgba(209,73,78,0.2),rgba(209,73,78,0.1));"></div>
`),_("帮派余额",i,r),_("所有存款总和",e,r),_("帮派公共资金",o,r),_("正存款总和",a,r),_("负存款总和",n,r),_("准备金率",parseFloat(i/a),r)}}(),function(){const t=ue(".money-wrap").children(".give-block");0<t.length&&ue(".rest-money-wrap").length<1&&t.after(`
<div class= "rest-money-wrap" style="width:290px; border:4px solid gray; padding:5px 2px; margin:0px 0px 5px 5px; background-image: linear-gradient(rgba(209,73,78,0.2),rgba(209,73,78,0.1));">
<div style="overflow:hidden; margin:7px; border:1px solid gray;">
<div id="username-title" style="width:87px; height:22px; float:left; color: var(--default-blue-color); background-color: var(--default-bg-panel-color); text-align:center;"><div style="padding: 3px 0px;">收款人</div></div>
<div id="username-value" style="width:187px; height:22px; float:left; color: var(--default-bg-panel-color); background-color: var(--default-blue-color); text-align:center;"></div>
</div>
<div style="overflow:hidden; margin:7px; border:1px solid gray;">
<div id="before-title" style="width:137px; height:22px; float:left; color: var(--default-green-color); background-color: var(--default-bg-panel-color); text-align:center;"><div style="padding: 3px 0px;">取款前余额</div></div>
<div id="before-value" style="width:137px; height:22px; float:left; color: var(--default-bg-panel-color); background-color: var(--default-green-color); text-align:center;"></div>
</div>
<div style="overflow:hidden; margin:7px; border:1px solid gray;">
<div id="after-title" style="width:137px; height:22px; float:left; color: var(--default-green-color); background-color: var(--default-bg-panel-color); text-align:center;"><div style="padding: 3px 0px;">取款后余额</div></div>
<div id="after-value" style="width:137px; height:22px; float:left; color: var(--default-bg-panel-color); background-color: var(--default-green-color); text-align:center;"><div style="padding: 3px 0px;"></div></div>
</div>
<div style="overflow:hidden; margin:7px; border:1px solid gray;">
<div id="loan-title" style="width:137px; height:22px; float:left; color: var(--default-green-color); background-color: var(--default-bg-panel-color); text-align:center;"><div style="padding: 3px 0px;">贷款额度</div></div>
<div id="loan-value" style="width:137px; min-height:22px; float:left; color: var(--default-bg-panel-color); background-color: var(--default-green-color); text-align:center;"><div style="padding: 3px 0px;"></div></div>
</div>
</div>`)}(),function(){const t=ue(".money-wrap .give-block .action-confirm");0===t.length||0<ue("#bw-check-loan").length||(t.append('<a id="bw-check-loan" class="t-blue" style="margin-left: 10px" href="https://bingwa-api.tornsmth.website/faction-loan/view" target="_blank">手工检查贷款</a>'),ue("#bw-check-loan").click(function(){var t=ue(this).attr("data-uid");t&&we.whitelist.add(t)}))}(),ue(".inputs-wrap .radio-wp input").removeAttr("disabled")});e.observe(document.getElementById("faction-controls"),{childList:!0,subtree:!0})}if(jailView&&0<=window.location.href.indexOf("jailview.php")){const _e="bingwa_bust";class t{constructor(t){this.refresh_callback=t;t=Jt(_e);t&&"3.0.5"===t.version?(this.info=t.info,this.conf=t.conf):(this.info={timestamp:0},this.conf={hidden:!1,prob_min:null,prob_max:null,order:"ASC",friend:"PIN",quick_bust:"ON"}),this.refreshInfo()}getBustSkill(){return this.info.level*(1+this.info.faction_perk/100)*(1+this.info.edu_perk/100)}getBustProb(t){let e=this.info.penalty;return this.info.job_perk&&(e/=2),276.536-(.73643*t+5309.59*e)/this.getBustSkill()}save(){Vt(_e,{info:this.info,conf:this.conf,version:"3.0.5"})}refreshInfo(){var t=Math.floor((new Date).getTime()/1e3),e=this.info.error?5:60;t-this.info.timestamp<e||(this.info={timestamp:t,error:"loading"},this.save(),new Promise(async()=>{await this.fetchInfo(),this.save(),this.refresh_callback&&this.refresh_callback()}))}increasePenalty(){"penalty"in this.info&&(this.info.penalty+=1,this.save()),"today_busts"in this.info&&(this.info.today_busts+=1,this.save())}async fetchInfo(){var t=Math.floor((new Date).getTime()/1e3),e=`https://api.torn.com/user/?selections=basic,perks,log&log=5360&to=${t+10}&key=${u}`;const a=await fetch(e);if(a.ok){const n=await a.json();if("error"in n)this.info={timestamp:t,error:n.error.error};else{this.info={timestamp:t},this.info.level=n.level;const o=n.faction_perks.find(t=>t.match(/bust success chance/i));this.info.faction_perk=o?parseInt(o.match(/\d+/)[0]):0,this.info.job_perk=0<=n.job_perks.indexOf("+ Easier to bust more people at once");const i=n.education_perks.find(t=>t.match(/Busting skill/i));this.info.edu_perk=i?parseInt(i.match(/\d+/)[0]):0,this.info.penalty=0,this.info.today_busts=0;for(const r of Object.values(n.log))t-r.timestamp<=259200&&(this.info.penalty+=1/(1+(t-r.timestamp)/36e3)),Math.floor(t/24/3600)==Math.floor(r.timestamp/24/3600)&&(this.info.today_busts+=1)}}else this.info={timestamp:t,error:a.statusText}}}const ke=new t(I),$e=new MutationObserver(async function(t){let e=!1;for(const a of t)for(const n of a.addedNodes)"LI"===n.tagName?e=function(t){if(ue(t).find("b.bust-score").attr("bust-score"))return!1;var e=(function(t){t=t.find("span.time").text().match(/\d+/g),t=t||[0];return t[1]?60*parseInt(t[0])+parseInt(t[1]):parseInt(t[0])}(ue(t))+180)*function(t){t=t.find("span.level").text().match(/\d+/g);return t?parseInt(t[0]):0}(ue(t));if(0==e)return!1;e=`<b class="bust-score t-red" style="margin-left: 0em" bust-score=${e}></b>`;return ue(t).find("span.reason").append(e),ue(t).removeClass("gray"),!0}(n)||e:ue(n).text().match(/You busted .* out of jail/i)&&(e=!0,ke.increasePenalty());e&&I()});function k(t){const e=t.find("a.faction").attr("href");return e?e.substring(30):0}function $(){const t=ue("ul.user-info-list-wrap").children("li");t.each(function(){if(0!==ue(this).find("b.bust-score").length){var e=parseFloat(ue(this).find("b.bust-score").attr("bust-prob"));let t=!1;isNaN(e)||(null!==ke.conf.prob_min&&e<ke.conf.prob_min&&(t=!0),null!==ke.conf.prob_max&&e>ke.conf.prob_max&&(t=!0));e=k(ue(this))in xe;"PIN"===ke.conf.friend&&e&&(t=!1),t?ue(this).addClass("bw-hidden"):ue(this).removeClass("bw-hidden"),ke.conf.friend&&e?ue(this).css("background-color","rgba(110, 160, 55, 0.15)"):ue(this).css("background-color","");const a=ue(this).children("a.bust");"ON"===ke.conf.quick_bust||"ON_BOTH"===ke.conf.quick_bust?a.attr("href",a.attr("href").replace(/\bstep=breakout\b/,"step=breakout1&")):a.attr("href",a.attr("href").replace(/\bstep=breakout1\b/,"step=breakout"));const n=ue(this).children("a.bye");"ON_BAIL"===ke.conf.quick_bust||"ON_BOTH"===ke.conf.quick_bust?n.attr("href",n.attr("href").replace(/\bstep=buy\b/,"step=buy1&")):n.attr("href",n.attr("href").replace(/\bstep=buy1\b/,"step=buy"))}}),ke.conf.order&&(t.sort(function(t,e){var a=parseInt(ue(t).find("b.bust-score").attr("bust-score")),n=parseInt(ue(e).find("b.bust-score").attr("bust-score")),t=k(ue(t))in xe,e=k(ue(e))in xe;return"PIN"===ke.conf.friend&&t!=e?Number(e)-Number(t):"ASC"===ke.conf.order?a-n:n-a}),t.detach().appendTo("ul.user-info-list-wrap"))}function I(){const n=ke.info,t=ue(".info-msg-cont").first();var e;t.css("background","var(--default-bg-panel-color)"),t.css("font-size","12px"),t.html(`
<div id="bust-info" style="display: flex; flex-wrap: wrap; gap: 10px 20px; padding: 10px;"></div>
<div id="bust-conf" class="small-select-menu-wrap">
<hr />
<div style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px 20px; padding: 10px;">
<label style="width: 10em; display: flex; gap: 4px">
<b style="margin: auto 0">最低成功率</b>
<input id="bust-conf-prob-min" type="text" inputmode="numeric" maxlength="3" placeholder="-"
style="width: 3em; flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; padding: 2px; text-align: center;">
</label>
<label style="width: 10em; display: flex; gap: 4px">
<b style="margin: auto 0">最高成功率</b>
<input id="bust-conf-prob-max" type="text" inputmode="numeric" maxlength="3" placeholder="-"
style="width: 3em; flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; padding: 2px; text-align: center;">
</label>
<label style="width: 10em; display: flex; gap: 4px">
<b style="margin: auto 0">排序</b>
<div class="select-wrap dropdown-new dropdown-default" style="flex-grow: 1">
<select id="bust-conf-order">
<option value="ASC">由易到难</option>
<option value="DESC">由难到易</option>
<option value="">系统顺序</option>
</select>
<div id="bust-conf-order-list" class="select-list dropdown-content"></div>
</div>
</label>
<label style="width: 10em; display: flex; gap: 4px">
<b style="margin: auto 0">友军</b>
<div class="select-wrap dropdown-new dropdown-default" style="flex-grow: 1">
<select id="bust-conf-friend">
<option value="PIN">高亮置顶</option>
<option value="HIGHLIGHT">高亮</option>
<option value="">不高亮</option>
</select>
<div id="bust-conf-friend-list" class="select-list dropdown-content"></div>
</div>
</label>
<label style="width: 10em; display: flex; gap: 4px">
<b style="margin: auto 0">免确认</b>
<div class="select-wrap dropdown-new dropdown-default" style="flex-grow: 1">
<select id="bust-conf-quick-bust">
<option value="ON">Bust</option>
<option value="ON_BAIL">Bail</option>
<option value="ON_BOTH">全部</option>
<option value="">无</option>
</select>
<div id="bust-conf-quick-bust-list" class="select-list dropdown-content"></div>
</div>
</label>
</div>
</div>
`),null!==ke.conf.prob_min&&ue("#bust-conf-prob-min").val(ke.conf.prob_min),null!==ke.conf.prob_max&&ue("#bust-conf-prob-max").val(ke.conf.prob_max),ue("#bust-conf-order").val(ke.conf.order),ue("#bust-conf-friend").val(ke.conf.friend),ue("#bust-conf-quick-bust").val(ke.conf.quick_bust),ee(ue("#bust-conf-prob-min"),t=>/^\d*$/.test(t)),ee(ue("#bust-conf-prob-max"),t=>/^\d*$/.test(t)),ue("#bust-conf input").change(D),ue("#bust-conf select").change(D),"loading"===n.error?ue("#bust-info").html("<span>正在读取 Bust 历史，请稍等。若 5 秒内未出结果，请刷新页面重试。</span>"):"Access level of this key is not high enough"===n.error?ue("#bust-info").html(`
<span class="t-red">权限不足，无法读取 Bust 惩罚！</span>
<a href="/preferences.php#tab=api">请使用 Full Access 类型的 API Key</a>
`):n.error?ue("#bust-info").html(`<span class="t-red">出错啦！${n.error}</span>`):(e=n.job_perk?"惩罚效果减半":"无",ue("#bust-info").html(`
<span style="width: 10em"><b>Bust 惩罚</b>: ${n.penalty.toFixed(2)}</span>
<span style="width: 10em" title><b>Bust 技能</b>: ${ke.getBustSkill().toFixed(2)}</span>
<span style="width: 10em"><b>工作特技</b>: ${e}</span>
<span style="width: 10em"><b>今日人数</b>: ${n.today_busts}</span>
`),ue("#bust-info").tooltip({tooltipClass:"white-tooltip",content:function(){var t=50===n.faction_perk?"50%":`<span class="t-red">${n.faction_perk}%</span>`,e=65===n.edu_perk?"65%":`<span class="t-red">${n.edu_perk}%</span>`;return`个人等级: ${n.level}<br>帮派加成: ${t}<br>教育加成: ${e}`}})),ue("#bust-info").append('<a id="bust-info-toggle-conf" style="margin-left: auto" href="javascript: void">显示选项</a>'),S(ke.conf.hidden),ue("#bust-info-toggle-conf").click(function(){ke.conf.hidden=!ke.conf.hidden,ke.save(),S(ke.conf.hidden)}),ue("b.bust-score").each(function(){var e=ue(this).attr("bust-score");if(e){let t="t-red";if(n.error)ue(this).text(` ${e}`),ue(this).removeAttr("bust-prob");else{const a=ke.getBustProb(e);t=120<=a?"t-gray-9":100<=a?"t-green":80<=a?"t-yellow":0<=a?"t-red":"t-red bg-red active",ue(this).html(` ${e}&nbsp;&nbsp;${a.toFixed(1)}%`),ue(this).attr("bust-prob",a.toFixed(1))}ue(this).attr("class",`bust-score ${t}`)}}),$()}function S(t){t?(ue("#bust-info-toggle-conf").text("显示选项"),ue("#bust-conf").hide()):(ue("#bust-info-toggle-conf").text("隐藏选项"),ue("#bust-conf").show())}function D(){var t=ue("#bust-conf-prob-min").val();ke.conf.prob_min=t?parseInt(t):null;t=ue("#bust-conf-prob-max").val();ke.conf.prob_max=t?parseInt(t):null,ke.conf.order=ue("#bust-conf-order").val(),ke.conf.friend=ue("#bust-conf-friend").val(),ke.conf.quick_bust=ue("#bust-conf-quick-bust").val(),ke.save(),$()}$e.observe(document.getElementsByClassName("userlist-wrapper")[0],{childList:!0,characterData:!0,subtree:!0})}if(crimeView&&0<=window.location.href.indexOf("loader.php?sid=crimes")&&setInterval(function(){window.location.href.endsWith("#/")?function(){if(!(0<ue(".bw-crime1-prob").length)){const t=ue('.crimes-hub-crime[href="#/searchforcash"] path.CircularProgressbar-path');if(0<t.length){let a=-1,n;if(t.each(function(){var t=(ue(this).css("stroke-dasharray")||"").match(/([\d.]+)px/),e=(ue(this).css("stroke-dashoffset")||"").match(/([\d.]+)px/),t=100-Math.round(parseFloat(e[1])/parseFloat(t[1])*100);t>a&&t<=100&&(a=t,n=this)}),n){const e=ue(n).closest("svg").parent();e.append(`<div class="bw-crime1-prob t-green" style="font-size: 0.8em; background: white; text-align: center">${a}%</div>`),e.css("overflow","visible")}}}}():window.location.href.endsWith("#/searchforcash")&&function(){if(!(0<ue(".bw-crime1-prob").length)){const o=ue("div[class*='crimeOption___']");let n=-1;const i=[];o.each(function(){if(!(0<ue(this).find("button[disabled]").length)){const e=ue(this).find("div[class*='densityTooltipTrigger___']").attr("aria-label")||"";var t=e.match(/\((\d+)%\)$/);if(t){t=parseInt(t[1]);const a=ue(this).find("div").filter(function(){var t=this.childNodes[0];return t&&3===t.nodeType});i.push({$ele:a.first().contents().first(),prob:t}),t>n&&(n=t)}}});for(var{$ele:t,prob:e}of i){var a=e===n?"t-green":"t-gray-c";t.after(`<span class="bw-crime1-prob ${a}" style="margin-left: auto">${e}%<span>`)}}}()},1e3),gym_show_ratio&&0<=window.location.href.indexOf("gym.php")){const Ie={0:{name:"balanced",description:"平衡比例",str:100,def:100,spd:100,dex:100},1:{name:"hank-str",description:"Hank比例-Str最高",str:100,def:80,spd:28,dex:80},2:{name:"hank-def",description:"Hank比例-Def最高",str:80,def:100,spd:80,dex:28},3:{name:"hank-spd",description:"Hank比例-Spd最高",str:28,def:80,spd:100,dex:80},4:{name:"hank-dex",description:"Hank比例-Dex最高",str:80,def:28,spd:80,dex:100},5:{name:"baldr-str",description:"Baldr比例-Str最高",str:100,def:72,spd:80,dex:72},6:{name:"baldr-def",description:"Baldr比例-Def最高",str:72,def:100,spd:72,dex:80},7:{name:"baldr-spd",description:"Baldr比例-Spd最高",str:80,def:72,spd:100,dex:72},8:{name:"baldr-dex",description:"Baldr比例-Dex最高",str:72,def:80,spd:72,dex:100}},Se={1:{name:"Premier Fitness",stage:1,cost:10,energy:5,strength:20,speed:20,defense:20,dexterity:20,note:""},2:{name:"Average Joes",stage:1,cost:100,energy:5,strength:24,speed:24,defense:27,dexterity:24,note:""},3:{name:"Woody's Workout Club",stage:1,cost:250,energy:5,strength:27,speed:32,defense:30,dexterity:27,note:""},4:{name:"Beach Bods",stage:1,cost:500,energy:5,strength:32,speed:32,defense:32,dexterity:0,note:""},5:{name:"Silver Gym",stage:1,cost:1e3,energy:5,strength:34,speed:36,defense:34,dexterity:32,note:""},6:{name:"Pour Femme",stage:1,cost:2500,energy:5,strength:34,speed:36,defense:36,dexterity:38,note:""},7:{name:"Davies Den",stage:1,cost:5e3,energy:5,strength:37,speed:0,defense:37,dexterity:37,note:""},8:{name:"Global Gym",stage:1,cost:1e4,energy:5,strength:40,speed:40,defense:40,dexterity:40,note:""},9:{name:"Knuckle Heads",stage:2,cost:5e4,energy:10,strength:48,speed:44,defense:40,dexterity:42,note:""},10:{name:"Pioneer Fitness",stage:2,cost:1e5,energy:10,strength:44,speed:46,defense:48,dexterity:44,note:""},11:{name:"Anabolic Anomalies",stage:2,cost:25e4,energy:10,strength:50,speed:46,defense:52,dexterity:46,note:""},12:{name:"Core",stage:2,cost:5e5,energy:10,strength:50,speed:52,defense:50,dexterity:50,note:""},13:{name:"Racing Fitness",stage:2,cost:1e6,energy:10,strength:50,speed:54,defense:48,dexterity:52,note:""},14:{name:"Complete Cardio",stage:2,cost:2e6,energy:10,strength:55,speed:57,defense:55,dexterity:52,note:""},15:{name:"Legs, Bums and Tums",stage:2,cost:3e6,energy:10,strength:0,speed:55,defense:55,dexterity:57,note:""},16:{name:"Deep Burn",stage:2,cost:5e6,energy:10,strength:60,speed:60,defense:60,dexterity:60,note:""},17:{name:"Apollo Gym",stage:3,cost:75e5,energy:10,strength:60,speed:62,defense:64,dexterity:62,note:""},18:{name:"Gun Shop",stage:3,cost:1e7,energy:10,strength:65,speed:64,defense:62,dexterity:62,note:""},19:{name:"Force Training",stage:3,cost:15e6,energy:10,strength:64,speed:65,defense:64,dexterity:68,note:""},20:{name:"Cha Cha's",stage:3,cost:2e7,energy:10,strength:64,speed:64,defense:68,dexterity:70,note:""},21:{name:"Atlas",stage:3,cost:3e7,energy:10,strength:70,speed:64,defense:64,dexterity:65,note:""},22:{name:"Last Round",stage:3,cost:5e7,energy:10,strength:68,speed:65,defense:70,dexterity:65,note:""},23:{name:"The Edge",stage:3,cost:75e6,energy:10,strength:68,speed:70,defense:70,dexterity:68,note:""},24:{name:"George's",stage:3,cost:1e8,energy:10,strength:73,speed:73,defense:73,dexterity:73,note:""},25:{name:"Balboas Gym",stage:4,cost:5e7,energy:25,strength:0,speed:0,defense:75,dexterity:75,note:"Requirements must be maintained to preserve access to this gym"},26:{name:"Frontline Fitness",stage:4,cost:5e7,energy:25,strength:75,speed:75,defense:0,dexterity:0,note:"Requirements must be maintained to preserve access to this gym"},27:{name:"Gym 3000",stage:4,cost:1e8,energy:50,strength:80,speed:0,defense:0,dexterity:0,note:"Requirements must be maintained to preserve access to this gym"},28:{name:"Mr. Isoyamas",stage:4,cost:1e8,energy:50,strength:0,speed:0,defense:80,dexterity:0,note:"Requirements must be maintained to preserve access to this gym"},29:{name:"Total Rebound",stage:4,cost:1e8,energy:50,strength:0,speed:80,defense:0,dexterity:0,note:"Requirements must be maintained to preserve access to this gym"},30:{name:"Elites",stage:4,cost:1e8,energy:50,strength:0,speed:0,defense:0,dexterity:80,note:"Requirements must be maintained to preserve access to this gym"},31:{name:"The Sports Science Lab",stage:4,cost:5e8,energy:25,strength:90,speed:90,defense:90,dexterity:90,note:"The use of drugs may result in the loss of membership without refunds"},32:{name:"Unknown",stage:4,cost:2147483647,energy:10,strength:100,speed:100,defense:100,dexterity:100,note:"Membership by invite only"},33:{name:"The Jail Gym",stage:0,cost:0,energy:5,strength:34,speed:34,defense:46,dexterity:0,note:""}};for(var C in ue("#gymroot").after(`
<div>
<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">锻炼比例推荐
</div>
<div class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
<div class="select-wrap" style="margin:5px; float:left">
<select id="gym-ratio" style="height:24px">
</select>
</div>
<div class="select-wrap" style="margin:5px 1px; float:left">
<p id="gym-ratio-info" style="height:12px; padding:6px 1px;">
</p>
</div>
</div>
<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">按照当前健身房效果一枪25E超过多少钱可以放弃GYM吃SE
</div>
<div class="cont-gray bottom-rounded content" style="margin-bottom:10px;padding:4px;">
<table id="se-table" style="">
<tr><td>Strength</td><td class="value">$0</td></tr>
<tr><td>Defense</td><td class="value">$0</td></tr>
<tr><td>Speed</td><td class="value">$0</td></tr>
<tr><td>Dexterity</td><td class="value">$0</td></tr>
</table>
</div>
</div>`),ue("#se-table").find("td").attr("style","font-size: 18px; border: 4px solid darkgray; padding:6px; text-align:center;"),Ie)ue("#gym-ratio").append(`<option value="${C}">${Ie[C].description}</option>`);function A(t,e,a,n){const o=ue("[class^='gymContent___']").children("[class^='properties___']").children("li");var i=ue("#strength-val").text().split(",").join(""),r=ue("#defense-val").text().split(",").join(""),s=ue("#speed-val").text().split(",").join(""),l=ue("#dexterity-val").text().split(",").join(""),d=Math.max(i/t,r/e,s/a,l/n),t=Math.abs(d*t-i)<=1?i:parseInt(d*t),e=Math.abs(d*e-r)<=1?r:parseInt(d*e),a=Math.abs(d*a-s)<=1?s:parseInt(d*a),n=Math.abs(d*n-l)<=1?l:parseInt(d*n);const c=[t,e,a,n],p=[t-i,e-r,a-s,n-l];let h=0;ue(".gym-goal").remove(),o.each(function(){const t=ue(this).children("[class^='propertyContent___']").children("[class^=description___]").children("p:first");0==t.children(".gym-perks").length?t.html(`<span class="t-red gym-goal" title="目标:${Bt(c[h])}">还差:${Gt(p[h])} </span>`):t.prepend(`<span class="t-red gym-goal" title="目标:${Bt(c[h])}">还差:${Gt(p[h])} </span>`),h++})}setInterval(function(){const e=ue("[class^='gymContent___']").children("[class^='properties___']").children("li");"1"!=e.first().attr("hasdone")&&0<e.length&&(e.first().attr("hasdone","1"),new Promise((d,a)=>{var t=`https://api.torn.com/user/?selections=perks&key=${u}`;fetch(t).then(t=>t.ok?t.json():void console.log("---探测失败---"),t=>{console.log("---网络异常---")}).then(t=>{if(null!=t)if("error"in t)a(t.error);else{let a=[{},{},{},{}];for(var e in t){const l=t[e];var n,o,i,r=e.split("_")[0];for(let t=0;t<l.length;t++)0<=l[t].search(/strength gym gains/i)?(n=parseInt(/\d+%/.exec(l[t])[0].replace("%","")),a[0][r]=a[0].hasOwnProperty(r)?a[0][r]+n:n):0<=l[t].search(/defense gym gains/i)?(o=parseInt(/\d+%/.exec(l[t])[0].replace("%","")),a[1][r]=a[1].hasOwnProperty(r)?a[1][r]+o:o):0<=l[t].search(/speed gym gains/i)?(o=parseInt(/\d+%/.exec(l[t])[0].replace("%","")),a[2][r]=a[2].hasOwnProperty(r)?a[2][r]+o:o):0<=l[t].search(/dexterity gym gains/i)?(i=parseInt(/\d+%/.exec(l[t])[0].replace("%","")),a[3][r]=a[3].hasOwnProperty(r)?a[3][r]+i:i):0<=l[t].search(/gym gains/i)&&(i=parseInt(/\d+%/.exec(l[t])[0].replace("%","")),a[0][r]=a[0].hasOwnProperty(r)?a[0][r]+i:i,a[1][r]=a[1].hasOwnProperty(r)?a[1][r]+i:i,a[2][r]=a[2].hasOwnProperty(r)?a[2][r]+i:i,a[3][r]=a[3].hasOwnProperty(r)?a[3][r]+i:i)}for(let e=0;e<a.length;e++){let t=1;for(var s in a[e])t*=(a[e][s]+100)/100;a[e].total=t}d(a),console.log("perks API fetched")}else a()}).catch(t=>a(t))}).then(function(o){var t=Se[function(){const t=ue("[class^='gymButton___'],[class*=' gymButton___']"),e=t.filter("[class^='active___'],[class*=' active___']"),a=e.find("[class^='gymIcon___'],[class*=' gymIcon___']");if(0===a.length)return"33";for(const o of a[0].classList){var n=o.match(/^gym-(\d+)___/);if(n)return n[1]}return"33"}()];const i=[(t.strength/10).toFixed(1),(t.defense/10).toFixed(1),(t.speed/10).toFixed(1),(t.dexterity/10).toFixed(1)];let r=0;e.each(function(){var t,e=(100*(o[r].total-1)).toFixed(2),a=(o[r].total*i[r]).toFixed(3);let n="<strong>健身房系数:</strong> +"+i[r];for(t in n+="<br><strong>系数外总加成:</strong> +"+e+"%",o[r])"total"!=t&&(n+="<br><strong>"+t+":</strong> +"+o[r][t]+"%");ue(this).children("[class^='propertyContent___']").children("[class^=description___]").children("p:first").append(`<span class="t-green gym-perks" title="${n}">实际系数: ${a} </span>`);a=function(t,e,a,n,o){let i=5e7;t<5e7&&(i=t);n=a*o*((3.480061091e-7*Math.log(n+250)+3091619094e-15)*i+682775184551527e-19*(n+250)-.0301431777),t*=.01;return e/t*n}(ue(this).children("[class^='propertyTitle___']").children("[class^='propertyValue___']").text().split(",").join(""),45e7,a,5025,25);ue("#se-table").children().children(":eq("+r+")").children(".value").text(Lt(parseInt(a))),r++})}).catch(t=>console.log("getGymPerks "+t)))},2e3);const De=Kt("gym-ratio","ratio_number");null!==De&&void 0!==De&&(ue("#gym-ratio").children("[value="+De+"]").attr("selected","true"),ue("#gym-ratio-info").text(`Str : Def : Spd : Dex = ${Ie[De].str} : ${Ie[De].def} : ${Ie[De].spd} : ${Ie[De].dex}`),setInterval(()=>{0<ue("[class^='gymContent___']").length&&A(Ie[De].str,Ie[De].def,Ie[De].spd,Ie[De].dex)},2e3)),ue("#gym-ratio").change(function(){console.log("ratio changed");var t=ue("#gym-ratio").val();Yt("gym-ratio","ratio_number",t),ue("#gym-ratio-info").text(`Str : Def : Spd : Dex = ${Ie[t].str} : ${Ie[t].def} : ${Ie[t].spd} : ${Ie[t].dex}`),A(Ie[t].str,Ie[t].def,Ie[t].spd,Ie[t].dex)})}if(noAssisting&&0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){let e=Math.floor(30*Math.random()+1),a=300;const Ce=setInterval(function(){const t=ue("[class^='btn_']");t.text().includes("Start fight")&&(t.prop("hidden",!0),t.parent().parent().children(":first").text("Wait ("+(e/10).toFixed(1)+")s To Start fight"),0==e&&(clearInterval(Ce),t.parent().parent().children(":first").text(""),t.removeAttr("hidden")),e--)},100),Ae=setInterval(function(){const t=ue("[class^='btn_']");t.text().includes("Join fight")&&(t.prop("hidden",!0),t.parent().parent().children(":first").text("Wait ("+(a/10).toFixed(1)+")s To Join fight 已有其他人进入此战斗"),0==a&&(clearInterval(Ae),t.parent().parent().children(":first").text(""),t.removeAttr("hidden")),a--)},100)}if(0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){let o=100;setInterval(function(){{var t,e,a,n;0<ue("[class^=level]").length&&0<ue("#log-header").length&&(n=ue("[class^=level]").attr("style").replace("height: ","").replace("%",""),(t=parseFloat(n))>o||(e=66<=(o=t)?"green":"red",a=66<=t?"高":"低",ue("#stealth-value").remove(),n=ue("#log-header").children(":first").attr("class"),ue("#log-header").children(":first").after(`
<span id="stealth-value" class="${n}">隐身几率:&nbsp;
<span class="t-${e}">${a}</span>
&nbsp;Stealth:&nbsp;
<span class="t-${e}">${t}%</span>
</span>`)))}},500)}{function M(){const t=ue("#defender_Primary").siblings().last(),e=ue("#defender_Secondary").siblings().last(),a=ue("#defender_Melee").siblings().last();0<t.length&&(clearInterval(n),T(t,0),T(e,100),T(a,200))}function T(e,a){const t=e.children().children();t.each(function(){var t=ue(this).attr("title");0<t.length&&e.parent().parent().parent().parent().append(`
<div style="position: absolute; z-index: 1; top: ${a}px; right: -420px; width: 400px; height: 42px; margin: 2px; border: 2px solid #000; background-color: ${ve.purple}; color: #eee; text-align: center;line-height: 20px;">${t}</div>`),a+=50})}0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")&&(n=setInterval(M,1e3))}{function M(){const t=ue("[class^='playersModelWrap___']").find("[class^='topWrap___']");2==t.length&&(clearInterval(a),t.each(function(){ue(this).children(":first").after('<span class="bw-hp-percent"></span>')}))}0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")&&(a=setInterval(M,1e3),setInterval(function(){const t=ue(".bw-hp-percent");2==t.length&&t.each(function(){var t=ue(this).siblings("span[class^='userName___']").text();const e=ue(this).siblings("div[class^='textEntries___']").find("[id^='player-health-value_']").text();var a=(e.split("/")[0].replace(",","").trim()/e.split("/")[1].replace(",","").trim()*100).toFixed(2);t&&a&&ue(this).text(` (${a}%)`)})},1e3))}if(0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){const Me=setInterval(function(){0<ue("[class^=playerWindow___]").length&&ue("#lower-layer").length<1&&(function(t,a){const e=window.location.href.substring(51),n=ue("[class^=modal___]").css("background-color");t.last().append(`
<div id="${a}" class="border-round" style="overflow: hidden; width:228px; height:26px; position: absolute; right: 0px; top: -2px; z-index: 9; color: #fff ;background-image: linear-gradient(${n},#888 25%,${n}); border: 1px solid #000; margin: 5px; text-align: center;">
<div id="${a}-online" style="float: left; width:44px; height:16px; background-color: ${ve.blue}; border: 1px solid #000; margin: 4px 2px 4px 4px; text-align: center;"><div style="padding: 2px 0px">检测中</div></div>
<div id="${a}-last" style="float: left; width:126px; height:16px; background-color: ${ve.blue}; border: 1px solid #000; margin: 4px 2px; text-align: center;"><div style="padding: 2px 0px">检测中</div></div>
<div id="${a}-refresh-btn" style="cursor: pointer; float: left; width:36px; height:16px; background-color: ${ve.red}; border: 1px solid #000; margin: 4px 4px 4px 2px; text-align: center;"><div style="padding: 2px 0px">刷新</div></div>
</div>`),ue("#"+a+"-refresh-btn").click(()=>{location.reload()}),ae(e,function(t){var e;null!=t&&"last_action"in t?("Online"==(e=t.last_action.status)?ue("#"+a+"-online").css("background-color",ve.green):"Idle"==e?ue("#"+a+"-online").css("background-color",ve.yellow):ue("#"+a+"-online").css("background-color",ve.gray),ue("#"+a+"-online").children().text(e),ue("#"+a+"-last").children().text(t.last_action_details)):"error"in t&&ue("#"+a+"-last").children().text("API读取失败")},function(t){ue("#"+a+"-last").children().text("蛙蛙探测 "+e+" 失败 "+t)})}(ue("[class^=playerWindow___]"),"lower-layer"),clearInterval(Me))},500)}if(nurse_suggestion&&0<=window.location.href.indexOf("item.php")&&ge(".tutorial-cont"),0<=window.location.href.indexOf("factions.php?step=your")){class t{constructor(){this.sharedData=null,this.lastActions=null,this.factionId=null,this.error=null,this.load().then(()=>{fe(this)})}async load(){try{var t,e,a=await ne("https://bingwa-api.tornsmth.website/faction-armory/armory.json"),n=await(await fetch(`https://api.torn.com/faction/?selections=basic&key=${u}`)).json(),o=JSON.parse(a),i=o.expire,r=Math.floor((new Date).getTime()/1e3);!i||i<r?this.error="数据过期":this.sharedData=o.armory,this.lastActions={};for([t,e]of Object.entries(n.members))this.lastActions[t]=e.last_action.timestamp;this.factionId=n.ID}catch(t){this.sharedData=null,this.lastActions=null,this.error=t.toString(),console.log("Fail to load faction armory data:",t)}}}const Te=new t;let e=new MutationObserver(function(t,e){console.log("changed"),ge("#faction-armoury-tabs"),fe(Te)});e.observe(document.getElementById("faction-armoury"),{childList:!0,subtree:!0})}if(taking_off_reminder&&0<=window.location.href.indexOf("travelagency.php")&&(0<ue("li[class^=icon86__]").length&&(ue("#tab-menu4").after(`<div><div id='oc-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
background-color:NavajoWhite;text-align:center;'>OC准备就绪 点击前往执行</div></div>`),ue("#oc-btn").click(function(){ue(this).text("蛙蛙正在前往……"),window.location.href="https://www.torn.com/factions.php?step=your#/tab=crimes"})),0<ue("li[class^=icon49__]").length?ue("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
background-color:#c0542f;text-align:center;'>DRUG CD 小于10分钟 先不要飞了哦</div></div>`):0<ue("li[class^=icon50__]").length?ue("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
background-color:#DAA520;text-align:center;'>DRUG CD 不足1小时 先不要飞了哦</div></div>`):0<ue("li[class^=icon51__]").length?ue("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
background-color:#5d9525;text-align:center;'>DRUG CD 为1-2小时之间 可尽情飞翔</div></div>`):0<ue("li[class^=icon52__]").length?ue("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
background-color:#5d9525;text-align:center;'>DRUG CD 为2-5小时之间 可尽情飞翔</div></div>`):0<ue("li[class^=icon53__]").length?ue("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
background-color:#5d9525;text-align:center;'>DRUG CD 大于5小时 可尽情飞翔</div></div>`):ue("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
background-color:#5d9525;text-align:center;'>DRUG CD 为零 是不是忘吃药了</div></div>`),async function(){try{var t=await(await fetch(`https://api.torn.com/user/?selections=icons&key=${u}`)).json();const e=t.icons.icon85||t.icons.icon86;if(!e)return;const[,a,n]=e.split("-").map(t=>t.trim());if(a.match(/Blackmail|Kidnapping|Bomb Threat/i))return;const i=function(t){var e={day:86400,hour:3600,minute:60,second:1};let a=0;for(const o of Object.keys(e)){var n=t.match(new RegExp(`(\\d+) *${o}`,"i"));n&&(a+=parseInt(n[1])*e[o])}return a}(n);ue(".travel-wrap").each(function(){if(0!==ue(this).find(".flight-time").length){const a=ue(this).find(".flight-time").text().split("-")[1];var[t,e]=a.trim().split(":"),t=3600*parseInt(t)+60*parseInt(e),e=i-2*t;if(!(7200<=e)){const n=ue(this).find(".travel-confirm .travel-info-btn");t=0<e?"OC 即将结束，请注意飞行时间，及时返程":0<i?"OC 即将结束，现在起飞将无法及时返程。还要坚持起飞吗？":"OC 已经结束，建议与队友沟通并在城中等待 OC 完成。即使耽误 OC 也要坚持起飞吗？";const o=ue(`<button class="bw-oc-reminder-btn torn-btn btn-dark-bg"
style="border: solid red" data-msg="${t}">注意 OC</button>`);e<=0&&o.attr("data-confirm",!0),n.hide(),o.insertBefore(n).click(be)}}});const o=new MutationObserver(async function(t){for(const e of t)ue(e.addedNodes).find("button.bw-oc-reminder-btn").click(be)});o.observe(ue(".travel-agency")[0],{childList:!0,subtree:!0})}catch(t){console.trace("Error in rendering OC reminder",t)}}()),0<=window.location.href.indexOf("factions.php?step=")){setInterval(function(){ue("div.title").children("div.id").text("BS");const t=ue("li.enemy,li.your").children("div.id");0<t.length&&t.each(function(t,e){const a=ue(this).siblings("span").children("div.member").children("a.user.name"),n=a?a.attr("href"):void 0;var o=n?n.substr(18):void 0;o&&((o=Fe.get(o))?ue(this).text(O(o)):ue(this).text("nil"))});const e=ue(".faction-war li[class^='enemy']").parent(),a=ue(".faction-war li[class^='enemy']").children("div.attack").children();0<a.length&&a.each(function(){if("1"!=ue(this).attr("detected")){const e=ue(this).closest("li[class^='enemy']").find('div.member a[href^="/profiles.php?XID="]'),a=e?e.attr("href"):void 0;var t=a?a.substr(18):void 0;console.log(t),t&&((t=Fe.get(t))?(ue(this).text(O(t)),ue(this).attr("bs",t)):ue(this).attr("bs",0))}ue(this).attr("detected","1")});0<e.length&&"1"!=e.attr("hasdone")&&(e.attr("hasdone","1"),function(t,a){const e=t.parent().siblings(),n=t.parent().siblings().children();t.click(function(){"decend"==ue(this).attr("sort")?(n.sort(function(t,e){return a(t)-a(e)}),n.detach().appendTo(e),ue(this).attr("sort","ascend")):(n.sort(function(t,e){return a(e)-a(t)}),n.detach().appendTo(e),ue(this).attr("sort","decend"))})}(e.siblings().children("div[class^='attack left attack___']"),F))},3e3);class t{constructor(){this.wawa_cache=Jt("battlestats")||{};const t=Jt("BINGWA_TARGET")||[];this.bw_target_cache=Object.assign({},...t.map(t=>({[parseInt(t.ID)]:t.TOTAL})))}get(t){return this.bw_target_cache[t]||this.wawa_cache[t]}}const Fe=new t;function F(t){return ue(t).find("[bs]").attr("bs")}function O(t){return 1e15<=t?"max":1e13<=t?parseInt(t/1e12)+"t":1e12<=t?(t/1e12).toFixed(1)+"t":1e10<=t?parseInt(t/1e9)+"b":1e9<=t?(t/1e9).toFixed(1)+"b":1e7<=t?parseInt(t/1e6)+"m":1e6<=t?(t/1e6).toFixed(1)+"m":1e4<=t?parseInt(t/1e3)+"k":1e3<=t?(t/1e3).toFixed(1)+"k":t}let a=setInterval(E,3e3);setInterval(function(){const t=ue("[class^='status-wrap territoryBoxWp___']"),e=t.children(".ttwar-time");0<t.length&&0<e.length&&t.each(function(){var t=ue(this).find(".timer").text().split("(")[0],e=parseInt(ue(this).find(".swords-icon").parent().text()),a=parseInt(ue(this).find(".shield-icon").parent().text());const n=ue(this).find(".score").text();var o,i,r=Rt(n.split("/")[0]),s=Rt(n.split("/")[1]),l=s/5e4,d=parseInt((new Date).getTime()/1e3),i=(c=t,o=parseInt(c.split(":")[0]),i=parseInt(c.split(":")[1]),t=parseInt(c.split(":")[2]),c=parseInt(c.split(":")[3]),86400*o+3600*i+60*t+c),t=d+i,c=Math.abs(e-a);let p="",h="";if(a<=e){e=Math.ceil((s-r)/l);p=e<=i?(h=`最快: ${new Date(1e3*(d+e)).format("dd日hh:mm")}`,(e=Math.ceil((s-r)/c))<=i?`攻: ${N(e)} (${new Date(1e3*(d+e)).format("dd日hh:mm")})`:"当前进攻速度不足"):"防守成功"}else{let t=Math.ceil((r+i*l-s)/(c+l));c=Math.ceil(r/c);t>c&&(t=i-5e4),0<t?(p=`守: ${N(t)} (${new Date(1e3*(d+t)).format("dd日hh:mm")})`,0<c&&c<=i&&(h=`${N(c)} 后清零`)):p="防守成功"}ue(this).children(".ttwar-time").html(`
<div style="float: left; padding: 4px 0px; margin-left: 4px;">${p}</div>
<div style="float: right; padding: 4px 0px; margin-right: 4px;">${h}</div>
`),ue(this).find(".ttwar-end").text(`(${new Date(1e3*t).format("dd日hh:mm")})`)})},1e3);let n=0;function E(){const t=ue("[class^='status-wrap territoryBoxWp___']");if(0<t.length){console.log("war page detected"),clearInterval(a),n=setInterval(P,3e3);const e=t.width()-6;t.each(function(){ue(this).find(".timer").css("margin-left","-14px").css("margin-right","-14px").append('<span class="ttwar-end" style="width: auto; margin-left: 4px"></span>'),0<ue(this).parent("[class~='red']").length?ue(this).append(`<div class="ttwar-time border-round" style="width:${e}px; line-height:0.8; position: relative; left: 2px; top: -10px; z-index: 1;
color: #fff ;background-image: linear-gradient(#ff7373,#fda8a8 25%,#ff7373); border: 1px solid #000; overflow: hidden;"></div>`):ue(this).append(`<div class="ttwar-time border-round" style="width:${e}px; line-height:0.8; position: relative; left: 2px; top: -10px; z-index: 1;
color: #fff ;background-image: linear-gradient(#83a000,#abc170 25%,#83a000); border: 1px solid #000; overflow: hidden;"></div>`)})}}function P(){0===ue("[class^='status-wrap territoryBoxWp___']").length&&(console.log("war page closed"),clearInterval(n),a=setInterval(E,3e3))}function N(t){var e=parseInt(t/86400),a=e?e+"天":"",n=parseInt(t%86400/3600),e=parseInt(t%3600/60),t=t%60;return a+z(n,2)+":"+z(e,2)+":"+z(t,2)}function z(t,e){return t.toString().length>=e?t.toString():z(t="0"+t,e)}}if(extra_recent_attacks&&0<=window.location.href.indexOf("factions.php?step=")){function j(t,e){const a=t.split(" ");let n=0;return"s"==a[1]?n=e-parseInt(a[0]):"m"==a[1]?n=e-parseInt(60*a[0]):"h"==a[1]&&(n=e-parseInt(3600*a[0])),n}let s=[],l=[];setInterval(function(){const n=ue(".recent-attacks"),o=parseInt((new Date).getTime()/1e3);if(0<n.length){const r=Array.from(n.children("li")).slice(0,10);let e=[];for(let t=9;0<=t;t--)s.indexOf(r[t])<0&&e.push(r[t]);e.forEach(function(t,e){const a=ue(t).children(".time").text();var n;(0<a.indexOf("s")||"1 m"==a||"2 m"==a||"3 m"==a||"4 m"==a)&&(n=j(a,o),l.push(n),s.push(t))});let a=0;l.forEach(function(t,e){300<o-t&&(a=e+1)}),l=l.slice(a,l.length),s=s.slice(a,s.length),ue(".extra-attacks").remove();for(let t=s.length-1;0<=t;t--){var i;r.indexOf(s[t])<0&&(ue(s[t]).addClass("extra-attacks"),i=function(t,e){t=e-t;let a="";return a=t<60?t+" s*":t<3600?parseInt(t/60)+" m*":t<86400?parseInt(t/3600)+" h*":"Inf",a}(l[t],o),ue(s[t]).children(".time").text(i),n.append(s[t]))}}else s=[],l=[]},6e3)}if(0<=window.location.href.indexOf("page.php?sid=events")&&setInterval(function(){const t=ue("ul[class^=eventsList___]"),e=t.children("li[data-bw-updated]").last();if(!e.is(":last-child")){const a=0<e.length?e.nextAll("li"):t.children("li");a.last().attr("data-bw-updated",!0),a.each(function(){!function(t){const e=t.find("[class^=message___]");(t=e.text().match(/ balance from \$([\d,]*) to \$([\d,]*)/i))&&(t=Rt(t[2])-Rt(t[1]),e.append(` (<span class="${0<=t?"t-green":"t-red"}">${0<=t?"+":""}${Bt(t)}</span>)`))}(ue(this))})}},1e3),0<=window.location.href.indexOf("page.php?sid=log")){const Oe=setInterval(function(){const t=ue(".panel > div[class^=title]");0!==t.length&&(clearInterval(Oe),t.prepend('<button id="log-export-btn" class="torn-btn" style="margin:5px;">导出所选日志</button>'),ue("#log-export-btn").click(async function(){const t=new Proxy(new URLSearchParams(window.location.search),{get:(t,e)=>t.get(e)});var a=t.cat?t.cat.split(","):[];const n=t.log&&0===a.length?t.log.split(","):[];if(0!==a.length||0!==n.length){alert("注意：\n* 请勿同时使用其他频繁请求 API 的功能（例如：冰蛙目标、阅兵、犯罪经验）\n* 导出需要很长时间，请耐心等待\n* 若要取消，请刷新或关闭页面\n");try{ue(this).prop("disabled",!0),ue(this).text("正在导出，请耐心等待");var e=await(await fetch(`https://api.torn.com/user/?selections=basic&key=${u}`)).json();if("error"in e)throw new Error(e.error.error);const s=Math.max(Math.ceil(n.length/10),1),l=[];for(let e=0;e<s;e++){var o=t=>{ue(this).text(`正在导出，请耐心等待 (第 ${e+1}/${s} 批 ${new Date(1e3*t).format("yyyy-MM-dd")})`)};for await(const d of oe(a,n.slice(10*e,10*(e+1)),t.from,t.to,o))l.push(d)}l.sort((t,e)=>e.timestamp-t.timestamp);var i={user_id:e.player_id,user_name:e.name,timestamp:Math.floor((new Date).getTime()/1e3),categories:a,types:n,logs:l},r=`data:application/json;charset=utf-8,${encodeURIComponent(JSON.stringify(i))}`;ue(this).replaceWith(`<a download="torn-log-${i.user_id}-${i.timestamp}.json" href="${r}"
class="torn-btn" style="color: #333; margin:5px; display:inline-block;">导出完毕，点击保存</a>`)}catch(t){console.trace(t),"Access level of this key is not high enough"===t.message?ue(this).replaceWith('<a href="/preferences.php#tab=api">权限不足！请使用 Full Access 类型的 API Key</a>'):(ue(this).text("出错啦！请刷新重试"),alert(`出错啦！${t}`))}}else alert("请选择日志类型")}))},1e3)}if(0<=window.location.href.indexOf("preferences.php")){let o=setInterval(B,2e3),i=0;function R(){var t=ue("[class^=api___]"),e=ue("#name").attr("aria-expanded"),a=ue("#name").attr("aria-hidden");0<t.length&&"false"==e&&"false"==a?console.log("apikey node heartbeat"):(console.log("apikey node closed"),clearInterval(i),ue("#bingwa-apikey-setting").remove(),o=setInterval(B,2e3))}function B(){var t=ue("[class^=api___]"),e=ue("#name").attr("aria-expanded"),a=ue("#name").attr("aria-hidden");if(0<t.length&&"false"==e&&"false"==a){console.log("apikey node detected"),clearInterval(o),i=setInterval(R,2e3),ue(".content-title").after(`
<div id="bingwa-apikey-setting">
<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">冰蛙APIKey设置</div>
<div id="bingwa-apikey-setting-wrapper" class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
<div style="margin:5px;padding:5px;">你拥有的APIKey个数为 <span id="apikey-number" style="padding:3px;color:${ve.yellowgreen};font-size:18px;"></span> 个</div>
<div style="margin:5px;padding:5px;">冰蛙当前使用的APIKey为 <span id="apikey-current" style="padding:3px;color:${ve.yellowgreen};font-size:18px;"></span></div>
<div id= "apikey-wrapper"style="margin:5px;padding:5px;text-align:center;"></div>
</div>
</div>`);const n=ue("[class^=keyRow]");ue("#apikey-number").text(`${n.length}`),ue("#apikey-current").text(`${window.localStorage.getItem("APIKey")}`),0<n.length?(n.each(function(){var t=ue(this).children("[class^=key]").val(),e=ue(this).children("[class^=blockTablet]").children("[class^=type]").val();ue("#apikey-wrapper").append(`
<div id="${t}" style="overflow:hidden;color:white;margin-top:5px;">
<button class="key-btn torn-btn" style="float: left; line-height: 22px;">未使用</button>
<div class="key-level border-round" style="float: left; width: 50px; height: 30px; margin: 0px 5px; background-color: #333; border: 1px solid #fff"></div>
<div class="key-value border-round" style="float: left; width: 180px; height: 30px; background-color: #333; border: 1px solid #fff"></div>
</div>
`),t==window.localStorage.getItem("APIKey")?(ue("#"+t).children("button").text("已使用").attr("disabled","true"),ue("#"+t).children(".key-level").html(`<div style="padding: 3px 0px;">${e}</div>`).css("background-color",ve.red),ue("#"+t).children(".key-value").html(`<div style="padding: 6px 0px; font-size: 18px;">${t}</div>`).css("background-color",ve.red)):(ue("#"+t).children(".key-level").html(`<div style="padding: 3px;">${e}</div>`),ue("#"+t).children(".key-value").html(`<div style="padding: 6px; font-size: 18px;">${t}</div>`))}),ue(".key-btn").click(function(){ue(".key-btn").each(function(){ue(this).text("未使用").removeAttr("disabled"),ue(this).siblings().css("background-color","#333")}),window.localStorage.setItem("APIKey",ue(this).parent().attr("id")),ue(this).text("已使用").attr("disabled","true"),ue(this).siblings().css("background-color",ve.red),ue("#apikey-current").text(`${window.localStorage.getItem("APIKey")}`)})):ue("#apikey-wrapper").text("没有已存在的APIKEY，请先创建一个然后刷新页面")}else console.log("apikey node heartbeat")}}else if(null==u||""==u)ue("body").prepend(`<div style="position: relative; z-index: 999; font-size: 16px; line-height: 1.6; padding: 10px; text-align: center; background: lightyellow;">
<a href="/preferences.php#tab=api">宝鉴需要一个有效的 APIKey<br/>点击前往设置页面进行选择</a>
</div>`);else{const Ee=ue("#sidebarroot").find("[class^='status-icons___']"),Pe=ue("#top-page-links-list").children("a");if(0<Pe.length||0<Ee.length){console.log("当前页面有按钮，可以宝鉴");let n={user:["ammo","attacks","attacksfull","bars","basic","battlestats","bazaar","cooldowns","crimes","criminalrecord","discord","display","education","equipment","events","gym","hof","honors","icons","inventory","jobpoints","log","medals","merits","messages","missions","money","networth","newevents","newmessages","notifications","perks","personalstats","profile","properties","refills","reports","revives","revivesfull","skills","stocks","timestamp","travel","weaponexp","workstats"],property:["property","timestamp"],faction:["applications","armor","armorynews","attacknews","attacks","attacksfull","basic","boosters","caches","cesium","chain","chainreport","chains","checkPermissions","contributors","crimeexp","crimenews","crimes","currency","donations","drugs","fundsnews","mainnews","medical","membershipnews","positions","rankedwars","reports","revives","revivesfull","stats","temporary","territory","territorynews","timestamp","upgrades","weapons"],company:["applications","companies","detailed","employees","news","profile","stock","timestamp"],market:["bazaar","itemmarket","pointsmarket","timestamp"],torn:["bank","cards","chainreport","cityshops","companies","competition","dirtybombs","education","factiontree","getCards","getDirtyBombs","gyms","honors","itemdetails","items","itemstats","logcategories","logtypes","medals","organisedcrimes","pawnshop","pokertables","properties","rackets","raidreport","raids","rankedwarreport","rankedwars","rockpaperscissors","searchforcash","shoplifting","stats","stocks","territory","territorynames","territorywarreport","territorywars","timestamp"],key:["info"]},s="",d="",c="";shows_bingwa_icon&&Ee.prepend('<li class="a_click_view_api_info icon6___XChW2" title="冰蛙宝鉴 呱" style="cursor: pointer; background-image:url(/images/v2/editor/emoticons.svg); background-position: -470px -42px;"></li>');Pe.last().after('<a role="button" style="cursor: pointer" aria-labelledby="events" class="a_click_view_api_info events t-clear h c-pointer  m-icon line-h24 right last"><span class="icon-wrap svg-icon-wrap"><span class="link-icon-svg events "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17"><defs><style>.cls-1{opacity:0.35;}.cls-2{fill:#fff;}.cls-3{fill:#777;}</style></defs><g id="Ð¡Ð»Ð¾Ð¹_2" data-name="Ð¡Ð»Ð¾Ð¹ 2"><g id="icons"><g class="cls-1"><path class="cls-2" d="M8,1a8,8,0,1,0,8,8A8,8,0,0,0,8,1ZM6.47,3.87H9.53l-.77,7.18H7.24ZM8,14.55A1.15,1.15,0,1,1,9.15,13.4,1.14,1.14,0,0,1,8,14.55Z"></path></g><path class="cls-3" d="M8,0a8,8,0,1,0,8,8A8,8,0,0,0,8,0ZM6.47,2.87H9.53l-.77,7.18H7.24ZM8,13.55A1.15,1.15,0,1,1,9.15,12.4,1.14,1.14,0,0,1,8,13.55Z"></path></g></g></svg></span></span><span id="a_click_view_api_info_text">宝鉴</span></a>'),ue(".a_click_view_api_info").click(function(){if(ue("#bwm").length<1){var e=ue("#mainContainer")[0].clientWidth;let t=985;e<985&&(t=e);e=`
<div id="bwm" style="width:${t}px; margin: auto;">
<div id="bwm-nav">
<ul style="list-style-type: none;margin: 10px 0px;padding: 0;overflow: hidden;background-color: #333;">
<li style="float: left">
<a id="bwm-version" role="button" style="cursor: pointer;display: block;color: black;background-color: #4CAF50;text-align: center;padding: 14px 16px;text-decoration: none;" >版本记录</a>
</li>
<li style="float: left">
<a id="bwm-api" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >查看API</a>
</li>
<li style="float: left">
<a id="bwm-company" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >我的公司</a>
</li>
<li style="float: left">
<a id="bwm-faction" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >帮派详情</a>
</li>
<li style="float: left">
<a id="bwm-target" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >冰蛙目标</a>
</li>
<li style="float: left">
<a id="bwm-chatlog" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >聊天记录</a>
</li>
<li style="float: left">
<a id="bwm-addiction" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >毒瘾</a>
</li>
<li style="float: left">
<a id="bwm-settings" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >设置</a>
</li>
<li style="float: right">
<a id="bwm-return" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >返回</a>
</li>
</ul>
</div>
</div>`;ue("#sidebarroot").hide(),ue(".content-wrapper").hide(),ue("#mainContainer").prepend(e);function l(t){const e=ue("#bwm-nav [id^=bwm-]");e.attr("style","cursor: pointer; display: block; color: white; text-align: center; padding: 14px 16px; text-decoration: none;"),ue(t).attr("style","cursor: pointer; display: block; color: black; background-color: #4CAF50; text-align: center; padding: 14px 16px; text-decoration: none;")}function a(){var t=getVersion();return`
<div id="version_container" style="width: inherit">
<div style="text-align:center; margin-bottom: 10px;">
<a role="button" style="cursor: pointer; font-size: large; color: #777;">冰蛙当前版本为 ${t[0]}</a>
</div>
<div style="text-align:center;">
<textarea  style="height:800px;width:100%;background-color: lightgray; font-family:\'Lucida Console\', Monaco, monospace; font-size: 0.8rem;line-height: 1.3;" readonly="readonly">${t[1]}</textarea>
</div>
</div>`}ue("#bwm").append(a()),ue("#bwm-version").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(a()),l("#bwm-version")}),ue("#bwm-api").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(function(){let t="";for(var e in n)t+='<a role="button" style="cursor: pointer; font-size: large; color: #777;" class="a_click_api_type">'+e+"</a>&nbsp;&nbsp;";t+='<br /><br /><input type="text" id="api_input_id" name="api_input_id" placeholder="ID (当前用户不用填)" size="25" style="font-size: larger; padding: 3px;" />&nbsp;&nbsp;<input type="text" id="api_input_from_time" name="api_input_from_time" placeholder="From (Eg: 2019/10/25 23:00:00)" size="29" style="font-size: larger; padding: 3px;" />&nbsp;&nbsp;<input type="text" id="api_input_to_time" name="api_input_to_time" placeholder="To (Eg: 2019/10/26 08:00:00)" size="28" style="font-size: larger; padding: 3px;" />';let a='<div id="api_container"><div id="api_types_container" style="text-align:center; margin-bottom: 10px;">'+t+'</div><div id="api_fields_container" style="text-align:center; margin-bottom: 10px;"></div><div id="api_result_header" style="text-align:center; margin-bottom: 3px; font-size: large;"></div><div style="text-align:center;"><textarea id="api_result_container" rows="40" style="width:100%; background-color: lightgray; font-family:\'Lucida Console\', Monaco, monospace; font-size: 0.8rem;line-height: 1.3;" readonly="readonly" /><br /><a id="api_result_download_csv" role="button" style="cursor: pointer; font-size: large; color: #777;">导出为CSV文件</a>';return foo?a+='&nbsp;&nbsp;&nbsp;&nbsp;<a id="a_faction_parade" role="button" style="cursor: pointer; font-size: large; color: #777;">帮派大阅兵</a><a id="a_faction_parade_download" role="button" style="display:none">帮派大阅兵下载</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id="a_faction_attacks" role="button" style="cursor: pointer; font-size: large; color: #777;">帮战统计</a><a id="a_faction_attacks_download" role="button" style="display:none">帮战统计下载</a></div></div>':a+="</div></div>",a}()),l("#bwm-api"),ue(".a_click_api_type").click(function(){ue("#api_fields_container").empty(),s=ue(this).text(),console.log("click: "+s);var t,e=n[s].sort();for(t in e){var a=e[t];ue("#api_fields_container").append('<a role="button" style="cursor: pointer; font-size: large; color: #777; margin-right: 4px" class="a_click_api_field">'+a+"</a> ")}ue(".a_click_api_field").click(function(){ue("#api_result_container").val("");var t=ue(this).text(),e=ue("#api_input_id").val(),a=ue("#api_input_from_time").val(),n=new Date(a).getTime()/1e3,o=ue("#api_input_to_time").val(),i=new Date(o).getTime()/1e3;let r=`https://api.torn.com/${s}/${e}?selections=${t}&key=${u}&from=${n}&to=${i}`;(isNaN(n)||isNaN(i))&&(r=`https://api.torn.com/${s}/${e}?selections=${t}&key=${u}`),console.log(`Request: ${r}`),c=s+" - "+e+" - "+t+" - "+a+" - "+o,ue("#api_result_header").text(`探测中: ${c}`),ue("#api_result_download_csv").removeAttr("href"),ue("#api_result_download_csv").removeAttr("download"),d="",fetch(r).then(t=>t.ok?t.json():void ue("#api_result_header").text(`探测失败: ${c}`),t=>{ue("#api_result_header").text(`网络异常: ${c}`)}).then(t=>{console.log(`Response: ${r}`),console.log(t),void 0!==t&&(ue("#api_result_header").text(`探测完成: ${c}`),d=t,ue("#api_result_container").val(JSON.stringify(t,null,4)))})})}),ue("#api_result_download_csv").click(function(){var t;null==d||""==d||null==c||""==c||"object"!=typeof d||d.length<1?alert("没有可导出的数据"):null!=(t=qt(d))?(t=Xt(t),ue(this).attr("href","data:text/csv;charset=utf-8,\ufeff"+t),ue(this).attr("download",c+".csv")):alert("没找到有效的数据集")}),ue("#a_faction_parade").click(function(){ue("#api_result_container").val("");const l=ue("#api_input_id").val();ie("开始帮派大阅兵，将拉取帮派成员列表，然后逐个查询该成员的详细信息，再使用蛙蛙探测器增加分析结果，最后导出为csv文件。"),ie("请注意："),ie("1、此功能会调用很多次API接口，所以不要太频繁使用。"),ie("2、为了避免太频繁被封接口，每次查询做了延时，所以运行时间较久，请耐心等待。"),ie("3、如果想中途放弃，请直接关掉本网页窗口。");let a=`https://api.torn.com/faction/${l}?selections=basic&key=${u}`;ue("#api_result_header").text(`帮派大阅兵 ${l}`),console.log(`Request: ${a}`),ie("\n开始获取帮派成员列表"),fetch(a).then(t=>t.ok?t.json():void ie("阅兵失败"),t=>{ie("阅兵失败，网络异常")}).then(t=>{console.log(`Response: ${a}`),console.log(t);const n=Object.keys(t.members),e=n.length;ie(`获取帮派成员列表完成，共有 ${e} 个成员`);let o=new Array,i=0;function r(){const e=n[i];let a=t.members[e];a.userId=e,o.push(a),ae(e,function(t){ie(`蛙蛙探测 userId: ${e} 成功`),Object.assign(a,t),s()},function(t){ie(`蛙蛙探测 userId: ${e} 失败`),s()})}function s(){if(i<e-1)++i,setTimeout(r,1e3);else{ie("蛙蛙探测完成"),ie("\n开始转换为csv格式...");var a=Xt(o);const n=ue("#a_faction_parade_download");n.attr("href","data:text/csv;charset=utf-8,\ufeff"+a);let t=new Date;n.attr("download",`FactionParade_${l}_${t.format("yyyyMMdd_hhmm")}.csv`),ie("转换为csv格式完成"),ie("\n开始下载");let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),document.getElementById("a_faction_parade_download").dispatchEvent(e)}}ie("\n开始启动蛙蛙探测..."),r()})}),ue("#a_faction_attacks").click(function(){var t=ue("#api_input_from_time").val();const d=new Date(t);let c=d.getTime()/1e3;var e=ue("#api_input_to_time").val();const p=new Date(e),h=p.getTime()/1e3;if(isNaN(c)||isNaN(c))alert("此功能必须输入起止时间（你的电脑本地时间，不要转为TCT）");else{ue("#api_result_container").val(""),ie("开始帮战统计，将自动切分时间段，拉取帮派attacks记录（每次最多100条），然后拼接，最后导出为csv文件。"),ie("请注意："),ie("1、此功能需要帮派API权限。"),ie("2、此功能会调用很多次API接口，所以不要太频繁使用。"),ie("3、每30秒才访问一次（因为测试发现数据有缓存），所以运行时间较久，请耐心等待。"),ie("4、如果想中途放弃，请直接关掉本网页窗口。"),ie(`\n开始时间：${t} 时间戳 ${c} ，结束时间：${e} 时间戳 ${h} \n`);let l=new Object;!function r(){const s=`https://api.torn.com/faction/?selections=attacks&key=${u}&from=${c}&to=${h}`;console.log(`Request: ${s}`),ue("#api_result_header").text("帮战统计"),fetch(s).then(t=>t.ok?t.json():(ie("抓取失败，将1秒后重试"),void setTimeout(r,1e3)),t=>{ie("抓取失败，将1秒后重试"),setTimeout(r,1e3)}).then(t=>{function e(){ie("\n攻击记录抓取完成，开始转换为csv格式...");var t=Xt(Ht(l));const e=ue("#a_faction_attacks_download");e.attr("href","data:text/csv;charset=utf-8,\ufeff"+t),e.attr("download",`FactionAttacks_${d.format("yyyyMMddhhmmss")}_${p.format("yyyyMMddhhmmss")}.csv`),ie("转换为csv格式完成"),ie("\n开始下载");let a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0),document.getElementById("a_faction_attacks_download").dispatchEvent(a)}console.log(`Response: ${s}`),console.log(t),Object.assign(l,t.attacks);var a=Ht(t.attacks);if(0<a.length){var n=a[0].timestamp_started;const o=new Date(1e3*n);t=a[a.length-1].timestamp_started;const i=new Date(1e3*t);ie(`抓取 ${c} - ${h} 有 ${a.length} 条，第一条 ${n} ${o.format("yyyy/MM/dd hh:mm:ss")}，最后一条 ${t} ${i.format("yyyy/MM/dd hh:mm:ss")}，累计 ${Object.keys(l).length} 条`),t<c||t>h?1<a.length?(ie("抓取的数据没有更新，准备重试"),setTimeout(r,1e4)):(ie("系统会莫名其妙的卡在最后一条，直接完成"),e()):(c=t+2,setTimeout(r,30500))}else e()})}()}})}),ue("#bwm-company").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(`
<div id="mycompany_container" style="width: inherit">
<div id="mycompany-head" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
<span id="companyname" role="button" style="font-size: large; color:#777;" >我的公司</span>
</div>
<div id="tips-view-company" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
<div id="mycompany-content" style="min-height:400px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
</div>`),l("#bwm-company");var t=de();console.log("userId "+t),wt(t).then(function(t){console.log(t);t=t[3];"Employee"===t?nt(ue("#mycompany-content")):"Director"===t&&ot(ue("#mycompany-content"))}).catch(t=>console.log("userId2otherIds "+t))}),ue("#bwm-faction").click(function(){function r(){var t=window.localStorage.getItem("faction_compare_history");if(null!=t){var e,a=JSON.parse(t);for(e in a)ue("#bwm_faction_history").append(`
<div class="wrapper-history" style="width:135px;float:left;border:1px solid darkgray;margin:5px 10px;">
<div class="head-history" style="background-color:black;color:white;padding:5px;overflow:hidden;">
<div class="id-history" style="width:30%;float:left;margin-left:50%;position:relative;left:-15%;">${e}</div>
<div style="float:right;cursor:pointer;background-color:white;color:black;padding:0px 2px;">
<a class="delete-history" role="button" >X</a>
</div>
</div>
<div class="content-history" style="background-color:var(--default-bg-panel-color);padding:5px;">
<a style="width:100%;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;" class="user faction" href="/factions.php?step=profile&amp;ID=${e}" target="_blank">${a[e]}</a>
</div>
</div>`);ue(".delete-history").click(function(){var t=ue(this).parent().parent().children(".id-history").text();Zt("faction_compare_history",t),ue(this).parent().parent().parent().remove(),console.log("删除成功: "+t)}),ue(".head-history").click(function(){const t=ue(this).siblings(".content-history");var e;"selected"==t.attr("selected")?(t.css("background-color","white"),t.removeAttr("selected"),ue("#faction-input-id").val("")):(ue(".content-history").css("background-color","white"),ue(".content-history").removeAttr("selected"),t.css("background-color","var(--default-bg-red-hover-color)"),t.attr("selected","selected"),e=ue(this).children(".id-history").text(),ue("#faction-input-id").val(e))})}}function n(o,t){t.empty(),t.append(`
<div id="name-faction" style="font-size: 20px; margin: 4px;"><img id="tag-faction" style="margin-right: 4px;"><span></span></div>
<div id="rank-faction" style="margin: 2px;"></div>
<div id="detail-faction" style="margin: 2px;"></div>
<div id="table-faction">
<table class="table-faction-table" style="margin:auto;background-color:var(--default-bg-panel-color);font-size:12px;">
<tr class="head">
<th class="table-online"></th>
<th class="table-level">Lv</th>
<th>Name</th>
<th class="table-last">Last</th>
<th class="table-status">Status</th>
<th class="table-bs">BS</th>
<th class="table-revivable">Revivable</th>
<th>ID</th>
<th class="table-position">Position</th>
<th class="table-days">Days</th>
<th>Description</th>
</tr>
</table>
</div>`),ue("#table-faction").find(".table-faction-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;");t=`https://api.torn.com/faction/${o}?selections=basic&key=${u}`;const i=ue("#bmw_faction_tips");return i.text("---探测中 "+o+"---"),fetch(t).then(t=>t.ok?t.json():void i.text("---探测失败 "+o+"---"),t=>{i.text("---网络异常 "+o+"---")}).then(t=>{console.log("API fetched: "+o),null!=t&&i.text("---探测完成 "+o+"---"),ue("#name-faction").children("span").text(`${t.name} - ${o}`),ue("#tag-faction").attr("src",`https://factiontags.torn.com/${t.tag_image}`),ue("#rank-faction").text(`Rank: ${t.rank.name} - ${t.rank.division}`),Yt("faction_compare_history",o,t.name),ue("#bwm_faction_history").empty(),r(),ue(".id-history").each(function(){ue(this).text()==o&&ue(this).parent().parent().children(".content-history").css("background-color","var(--default-bg-red-hover-color)")});var e=Object.keys(t.members).length;const a=t.respect;var n=a.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","});ue("#detail-faction").text(`Members: ${e} | Resp: ${n} | Best Chain: ${t.best_chain}`),ue.each(t.members,function(t,e){var a=t,n=Y(a),o=Z(e.last_action.timestamp),i=e.status.state,r=e.status.description,s=e.status.until,t=e.status.color;const l=Q(r,i,s);i=l[0].startsWith("海")?Ne[l[2]].name+l[0].slice(1):l[0],s=function(t){let e=Kt("revivable",t),a="unknown";null!=e&&null!=e&&(a=e);return a}(a);let d="var(--default-color)";"Leader"!=e.position&&"Co-leader"!=e.position||(d="var(--default-red-color)");let c="grey",p=1;"Online"==e.last_action.status?(c="DarkSeaGreen",p=3):"Idle"==e.last_action.status&&(c="Orange",p=2);e=`
<tr class="content">
<td class="table-online" code="${p}" style="border: 1px solid darkgray; min-width: 20px; background-color:${c}"></td>
<td class="table-level" style="border: 1px solid darkgray;padding:5px;color:var(--default-color);">${e.level}</td>
<td style="border: 1px solid darkgray;padding:5px;"><a class="user name" href="/profiles.php?XID=${a}" target="_blank">${e.name}</a></td>
<td class="table-last" style="border: 1px solid darkgray;padding:5px;color:var(--default-color);" last-action-minutes="${o[0]}">${o[1]}</td>
<td class="table-status t-${t}" style="border: 1px solid darkgray;padding:5px;" hospital-seconds="${l[1]}" hospital-location="${l[2]}">${i}</td>
<td class="table-bs t-blue" style="border: 1px solid darkgray;padding:5px" estimate-bs="${n[0]}">
<a style="text-decoration:none;" href="/loader.php?sid=attack&user2ID=${a}" target="_blank">${n[2]||"Attack"}</a>
</td>
<td class="table-revivable" style="border: 1px solid darkgray;padding:5px;color:var(--default-color);">${s}</td>
<td style="border: 1px solid darkgray;padding:5px;text-align:right;color:var(--default-color);">${a}</td>
<td class="table-position" style="border:1px solid darkgray;padding:5px;color:${d};">${e.position}</td>
<td class="table-days" style="border: 1px solid darkgray;padding:5px;color:var(--default-color);">${e.days_in_faction}</td>
<td style="border: 1px solid darkgray;padding:5px;color:var(--default-color);">${e.status.details}</td>
</tr>`;ue("#table-faction").children(".table-faction-table").children().append(e)})}).catch(t=>console.log("fetch error",t))}ue("#bwm").children(":last").remove(),ue("#bwm").append(`
<div id="bwm_faction_container" style="width: inherit">
<div id="bwm_faction_header" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
<input type="text" id="faction-input-id" name="faction-input-id" placeholder="帮派 ID" size="10" style="font-size: larger; padding: 5px; margin: 5px;" />
<button id="faction-load-btn" class="torn-btn" style="margin:5px;">读取帮派</button>
<button id="faction-parade-start-btn" class="torn-btn" style="margin:5px;">开始阅兵</button>
<button id="faction-parade-stop-btn" class="torn-btn" style="margin:5px;" disabled>停止阅兵</button>
</div>
<div id="bmw_faction_tips" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
<div id="bwm_faction_history" style="margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;"></div>
<div id="bmw_faction_wrapper" style="min-height:700px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
</div>`),l("#bwm-faction"),r();let o=window.localStorage.getItem("MY_FACTION_ID");void 0!==o&&null!==o||(o="20465"),ue("#faction-load-btn").click(function(){ue("#faction-input-id").val()||ue("#faction-input-id").val(o);const t=ue("#bmw_faction_wrapper").find("table.table-faction-table th[sort]"),e=t.index(),a=t.attr("sort");n(ue("#faction-input-id").val(),ue("#bmw_faction_wrapper")).then(function(){if(Qt(ue("th.table-bs"),V),Qt(ue("th.table-last"),J),Qt(ue("th.table-status"),K),Qt(ue("th.table-online"),H),Qt(ue("th.table-level"),W),Qt(ue("th.table-position"),U),Qt(ue("th.table-days"),X),Qt(ue("th.table-revivable"),q),0<=e){const t=ue("#bmw_faction_wrapper").find(`table.table-faction-table th:nth-child(${e+1})`);t.attr("sort","ascend"===a?"descend":"ascend"),t.click()}})});let i=!0;ue("#faction-parade-start-btn").click(function(){i=!0,ue("#faction-load-btn").prop("disabled",!0),ue("#faction-parade-start-btn").prop("disabled",!0),ue("#faction-parade-stop-btn").removeAttr("disabled"),ue("tr.head").attr("style","pointer-events: none;");const t=ue(".table-faction-table").children().children("tr.content").first();t.length<=0?(ue("#bmw_faction_tips").text("未找到用户列表"),ue("#faction-load-btn").removeAttr("disabled"),ue("#faction-parade-start-btn").removeAttr("disabled"),ue("#faction-parade-stop-btn").prop("disabled",!0),ue("tr.head").removeAttr("style")):(ue("#bmw_faction_tips").text("阅兵开始"),setTimeout(()=>{!function e(a){if("1"==a.attr("detected"))ue("#bmw_faction_tips").text("用户已完成"),setTimeout(()=>{e(a.next())},0);else if(a.length<=0||0==i)ue("#bmw_faction_tips").text("阅兵已结束"),ue("#faction-load-btn").removeAttr("disabled"),ue("#faction-parade-start-btn").removeAttr("disabled"),ue("#faction-parade-stop-btn").prop("disabled",!0),ue("tr.head").removeAttr("style");else{a.attr("detected","1");const n=a.find("a.user.name").attr("href").replace(/[^0-9|-]/gi,"");ue("#bmw_faction_tips").text("正在阅兵: "+n),ae(n,function(t){a.children("td.table-bs").text(Gt(t.estimate_bs)),a.children("td.table-bs").attr("estimate-bs",t.estimate_bs),Yt("battlestats",n,t.estimate_bs),a.children("td.table-revivable").text(t.revivable),Yt("revivable",n,t.revivable),setTimeout(()=>{e(a.next())},1e3)},function(t){ue("#bmw_faction_tips").text("蛙蛙探测 "+n+" 失败 "+t),setTimeout(()=>{e(a.next())},1e3)})}}(t)},1e3))}),ue("#faction-parade-stop-btn").click(function(){i=!1})}),ue("#bwm-target").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(`
<div id="bwm_target_container" style="width: inherit">
<div id="bwm_target_header" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
<button id="target-load-excel" class="torn-btn" style="margin:5px;">加载本地excel文件</button>
<button id="target-clear-cache" class="torn-btn" style="margin:5px;" disabled>清除缓存</button>
</div>
<input type="file" id="file" style="display: none;" accept=".csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"/>
<div id="bmw_target_tips" style="text-align:center; margin-bottom: 3px; font-size: 4px;">请按以下模板来导入表格 仅限xlsx或csv格式</div>
<div id="bmw_target_wrapper" style="min-height:700px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;">
<table style="margin: auto;">
<tr>
<th style="border: 1px solid darkgray; padding: 5px; background-color: white;"></th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">A</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">B</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">C</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">D</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">E</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">F</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">G</th>
</tr>
<tr>
<td style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">1</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">Name</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">ID</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">STR</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">DEF</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">SPD</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">DEX</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">TOTAL</td>
</tr>
<tr>
<td style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">2</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">GoodLuck</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">2356929</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
<td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">800,000,000</td>
</tr>
</table>
</div>

</div>`),l("#bwm-target");let n=0;window.localStorage.setItem("BINGWA_TARGET_FLAG","");var t=window.localStorage.getItem("BINGWA_TARGET");let o=t?JSON.parse(t):{};function e(t,e){function a(t,e){"off"==e?t.parent().addClass("hide"):"on"==e&&t.parent().removeClass("hide")}ue("."+{Online:"target-online",Idle:"target-online",Offline:"target-online","在城内":"target-status","在城外":"target-status","住院时间<=5m":"target-status","住院时间>5m":"target-status","FF>=2.0":"target-fairfight","FF<2.0":"target-fairfight"}[t]).each(function(){ue(this).text()==t?a(ue(this),e):"在城内"==t?"town"==ue(this).attr("hospital-location")&&a(ue(this),e):"在城外"==t?"town"!==ue(this).attr("hospital-location")&&a(ue(this),e):"住院时间<=5m"==t?ue(this).attr("hospital-seconds")<=300&&a(ue(this),e):"住院时间>5m"==t?300<ue(this).attr("hospital-seconds")&&a(ue(this),e):"FF>=2.0"==t?2<=ue(this).text()&&a(ue(this),e):"FF<2.0"==t&&ue(this).text()<2&&a(ue(this),e)})}function i(t){0==t.length||"ID"in(t=Object.values(t)[0])&&(t=t.ID,console.log(t),wt(t).then(function(t){console.log("arr "+t),n=setInterval(()=>{!function(e){if(o.length<=0||ue(".target-id").length<=0)window.localStorage.setItem("BINGWA_TARGET_FLAG",""),clearInterval(n),console.log("faction api refreshing ended");else{window.localStorage.setItem("BINGWA_TARGET_FLAG","refreshing");var t=`https://api.torn.com/faction/${e}?selections=basic&key=${u}`;const a=ue("#bmw_target_tips");a.text("---刷新中---"),fetch(t).then(t=>t.ok?t.json():void a.text("---探测失败 "+e+"---"),t=>{a.text("---网络异常 "+e+"---")}).then(t=>{console.log("faction api refreshed"),ue.each(t.members,function(t,l){ue(".target-id").each(function(){if(t==ue(this).text()){var n=l.last_action.status;let t=ve.yellow;"Online"==n?t=ve.yellowgreen:"Offline"==n&&(t=ve.gray),ue(this).siblings(".target-online").css({"background-color":t,color:"white"}).text(n);var o=Z(l.last_action.timestamp);ue(this).siblings(".target-last").attr("last-action-seconds",o[0]).attr("timestamp",l.last_action.timestamp).text(o[1]);var i=Q(l.status.description,l.status.state,l.status.until);let e="var(--default-bg-green-hover-color)";"red"==l.status.color?e="var(--default-bg-red-hover-color)":"blue"==l.status.color&&(e="var(--default-bg-blue-hover-color)"),ue(this).siblings(".target-status").attr("hospital-seconds",i[1]).attr("hospital-location",i[2]).attr("description",l.status.description).attr("state",l.status.state).attr("until",l.status.until).css({"background-color":e,color:"var(--default-color)"}).text(i[0]),ue(this).siblings(".target-level").text(l.level);o=ue(this).siblings(".target-fairfight").text();if(o!=isNaN){const s=.25*o*(Math.log(l.level)+1);ue(this).siblings(".target-flatrespect").text(s.toFixed(2))}let a=[];const r=ue("#filters").find("[status='on']");r.each(function(){a.push(ue(this).text())});o=function(t,e,a,n,o){let i=1,r=1,s=1,l=1;i=t.includes(e)?1:0;r=t.includes("在城内")&&"town"==a||t.includes("在城外")&&"town"!==a?1:0;s=t.includes("住院时间<=5m")&&n<=300||t.includes("住院时间>5m")&&300<n?1:0;l=t.includes("FF>=2.0")&&2<=o||t.includes("FF<2.0")&&o<2?1:0;return i*r*s*l}(a,n,i[2],i[1],o);0==o?ue(this).parent().addClass("hide"):1==o&&ue(this).parent().removeClass("hide")}})})}).then(function(){return new Promise(function(t,e){setTimeout(function(){t()},1e3)})}).then(function(){0<ue(".target-last").length&&(console.log("fake refresh 1"),ue(".target-last").each(function(){var t=ue(this).attr("timestamp");if(null==t)return!0;t=Z(t);ue(this).attr("last-action-seconds",t[0]).text(t[1]);t=Q(ue(this).siblings(".target-status").attr("description"),ue(this).siblings(".target-status").attr("state"),ue(this).siblings(".target-status").attr("until"));ue(this).siblings(".target-status").attr("hospital-seconds",t[1]).text(t[0])}))}).then(function(){return new Promise(function(t,e){setTimeout(function(){t()},1e3)})}).then(function(){0<ue(".target-last").length&&(console.log("fake refresh 2"),ue(".target-last").each(function(){var t=ue(this).attr("timestamp");if(null==t)return!0;t=Z(t);ue(this).attr("last-action-seconds",t[0]).text(t[1]);t=Q(ue(this).siblings(".target-status").attr("description"),ue(this).siblings(".target-status").attr("state"),ue(this).siblings(".target-status").attr("until"));ue(this).siblings(".target-status").attr("hospital-seconds",t[1]).text(t[0])}))}).catch(t=>console.log("fetch error",t))}}(t[0])},3e3)}).catch(t=>console.log("startRefreshing "+t)))}function r(){var t=`https://api.torn.com/user/?selections=battlestats&key=${u}`;const e=ue("#bmw_target_tips");e.text("---BS探测中---"),fetch(t).then(t=>t.ok?t.json():void e.text("---BS探测失败---"),t=>{e.text("---BS网络异常---")}).then(l=>{if(null!=l)if("error"in l)e.text(l.error);else{const d=Math.sqrt(l.strength)+Math.sqrt(l.defense)+Math.sqrt(l.speed)+Math.sqrt(l.dexterity);console.log("My score:"+d),ue(".target-fairfight").each(function(){var t=Bt(ue(this).siblings(".target-str").text()),e=Bt(ue(this).siblings(".target-def").text()),a=Bt(ue(this).siblings(".target-spd").text()),n=Bt(ue(this).siblings(".target-dex").text()),o=Bt(ue(this).siblings(".target-total").text());let i=((Math.sqrt(t)+Math.sqrt(e)+Math.sqrt(a)+Math.sqrt(n))/d*8/3+1).toFixed(2);3<=i&&(i=3..toFixed(2)),ue(this).text(i);const r=o/l.total;o=r.toFixed(2);const s=ue(this).siblings(".target-total");(1.3<=r?s.css("color","var(--default-base-important-color)"):1.1<=r?s.css("color","var(--default-red-color)"):.9<=r?s.css("color","var(--default-base-brown-color)"):.7<=r?s.css("color","var(--default-base-gold-color)"):.5<=r?s.css("color","var(--default-base-green-color)"):.3<=r?s.css("color","var(--default-green-color)"):s.css("color","var(--default-base-grey1-color)")).attr("title","是你属性的"+o+"倍")})}else e.text("error")}).catch(t=>console.log("fetch error",t))}function s(t){let e=`
<div id="filters" style="overflow:hidden;">
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #83a000; color: white; font-weight: bold;">Online</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #F39826; color: white; font-weight: bold;">Idle</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #ADADAD; color: white; font-weight: bold;">Offline</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #8FBC8F; color: white; font-weight: bold;">在城内</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #65A5D1; color: white; font-weight: bold;">在城外</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #8FBC8F; color: white; font-weight: bold;">住院时间<=5m</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #FF7373; color: white; font-weight: bold;">住院时间>5m</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #8FBC8F; color: white; font-weight: bold;">FF>=2.0</div>
<div status="on" class="filter-button" style="cursor:pointer; margin:5px 0px 5px 20px; padding:6px; border:6px double #CFCFCF; float:left; background-color: #FF7373; color: white; font-weight: bold;">FF<2.0</div>
</div>
<table style="margin: auto; background-color: var(--default-bg-panel-color)">
<tr>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">Online</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">Name</th>
<th class="head-last" style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">Last</th>
<th class="head-status" style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">Status</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;">Attack</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;" title="Fair fight 系数">FF</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;">TOTAL</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;">ID</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;">Lvl</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;" title="基础面子系数">FR</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;">Hint</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;">STR</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;">DEF</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;">SPD</th>
<th style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;">DEX</th>
</tr>
`;for(var a in t){var n=function(t,e,a){var n=["var(--default-bg-panel-color)","var(--default-color)"],o=["#008196","#eee"];let i="",r=[n,n,n,n];return e+a<.33*t?(i="脆",r[0]=o,r[2]=o):.15*t<e-a?(i="防",r[1]=o):.15*t<a-e?(i="闪",r[3]=o):.67*t<e+a&&(i="龟",r[1]=o,r[3]=o),[i].concat(r)}(t[a].TOTAL,t[a].DEF,t[a].DEX);e+=`
<tr>
<td class="target-online" style="border: 1px solid darkgray; padding: 5px; text-align: center;"></td>
<td class="target-name" style="border: 1px solid darkgray; padding: 5px; text-align: center;">
<a class="user name" href="/profiles.php?XID=${t[a].ID}" target="_blank">${t[a].Name}</a>
</td>
<td class="target-last" style="border: 1px solid darkgray; padding: 5px; color: var(--default-color); text-align: center;"></td>
<td class="target-status" style="border: 1px solid darkgray; padding: 5px; color: black; text-align: center;"></td>
<td class="target-attack t-blue" style="border: 1px solid darkgray; padding: 5px; color: black; text-align: center;">
<a href="/loader.php?sid=attack&user2ID=${t[a].ID}" style="text-decoration: none;" target="_blank">Attack</a>
</td>
<td class="target-fairfight" style="border: 1px solid darkgray; padding: 5px; color: var(--default-color); text-align: center;"></td>
<td class="target-total" style="border: 1px solid darkgray; padding: 5px; color: var(--default-color); text-align: center;">${Bt(t[a].TOTAL)||0}</td>
<td class="target-id" style="border: 1px solid darkgray; padding: 5px; color: var(--default-color); text-align: right;">${t[a].ID||""}</td>
<td class="target-level" style="border: 1px solid darkgray; padding: 5px; color: var(--default-color); text-align: center;"></td>
<td class="target-flatrespect" style="border: 1px solid darkgray; padding: 5px; color: var(--default-color); text-align: center;"></td>
<td class="target-hint" style="border: 1px solid darkgray; padding: 5px; color: var(--default-color); text-align: center;">${n[0]}</td>
<td class="target-str" style="border: 1px solid darkgray; padding: 5px; background-color: ${n[1][0]}; color: ${n[1][1]}; text-align: center;">${Bt(t[a].STR)||0}</td>
<td class="target-def" style="border: 1px solid darkgray; padding: 5px; background-color: ${n[2][0]}; color: ${n[2][1]}; text-align: center;">${Bt(t[a].DEF)||0}</td>
<td class="target-spd" style="border: 1px solid darkgray; padding: 5px; background-color: ${n[3][0]}; color: ${n[3][1]}; text-align: center;">${Bt(t[a].SPD)||0}</td>
<td class="target-dex" style="border: 1px solid darkgray; padding: 5px; background-color: ${n[4][0]}; color: ${n[4][1]}; text-align: center;">${Bt(t[a].DEX)||0}</td>
</tr>
`}return e+="</table>",e}0<o.length?(console.log("target cache detected"),ue("#target-load-excel").prop("disabled",!0),ue("#file").prop("disabled",!0),ue("#target-clear-cache").removeAttr("disabled"),ue("#bmw_target_tips").text("加载成功"),ue("#bmw_target_wrapper").html(s(o)),new Promise(function(t,e){setTimeout(function(){console.log("3 Seconds"),t()},3100)}).then(function(){r(),"refreshing"!=window.localStorage.getItem("BINGWA_TARGET_FLAG")?i(o):alert("已存在另外的冰蛙目标页面正在刷新中")}).catch(t=>console.log("First Refresh "+t))):console.log("target cache not available"),ue(".filter-button").click(function(){"on"==ue(this).attr("status")?(ue(this).css({border:"6px solid #CFCFCF","font-weight":"normal"}).attr("status","off"),e(ue(this).text(),"off")):(ue(this).css({border:"6px double #CFCFCF","font-weight":"bold"}).attr("status","on"),e(ue(this).text(),"on"))}),ue("#target-load-excel").click(function(){"undefined"!=typeof XLSX||1==confirm("未检测到xlsx支持组件，只支持导入csv格式，是否继续？")?document.getElementById("file").click():console.log("load cancelled")}),ue("#file").change(function(a){var t,e=a.target.files;0!=e.length&&(t=e[0],(e=/\.(xlsx|csv)$/g.exec(t.name))?function(t,i,r){const e=new FileReader;e.onload=function(t){var e,a=t.target.result;let n;if("xlsx"===i){if("undefined"==typeof XLSX)return void alert("不支持导入xlsx格式文件");n=(e=(t=XLSX.read(e=a,{type:"binary"})).SheetNames,e=t.Sheets[e[0]],XLSX.utils.sheet_to_json(e))}else{function o(t){return"string"==typeof t?Bt(t):t}"csv"===i&&(n=function(t,e){function a(t){let e=0,a="";for(const n of t)'"'===n&&0===e?e=1:'"'===n&&1==e&&(e=0),","===n&&0===e?a+="|":'"'!==n&&(a+=n);return a.split("|")}const n=t.split(/\r?\n/),o=a(n[0]),i=[];for(let t=1;t<n.length-1;t++){var r=a(n[t]);const l={};for(const d in o){var s=o[d];e[s]?l[s]=e[s].call(null,r[d]):l[s]=r[d]}i.push(l)}return i}(a,{STR:o,DEF:o,SPD:o,DEX:o,TOTAL:o}))}r&&r(n)},e.readAsBinaryString(t)}(t,e[1],function(t){if(0<t.length)if(t[0].hasOwnProperty("Name"))if(t[0].hasOwnProperty("ID"))if(t[0].hasOwnProperty("STR"))if(t[0].hasOwnProperty("SPD"))if(t[0].hasOwnProperty("DEF"))if(t[0].hasOwnProperty("DEX"))if(t[0].hasOwnProperty("TOTAL")){for(var e in t)t[e].Name&&"string"!=typeof t[e].Name&&(t[e].Name=t[e].Name.toString());ue("#target-load-excel").prop("disabled",!0),ue("#file").prop("disabled",!0),ue("#target-clear-cache").removeAttr("disabled"),console.log(t),a.target.value="",ue("#bmw_target_tips").text("加载成功"),ue("#bmw_target_wrapper").html(s(t)),window.localStorage.setItem("BINGWA_TARGET",JSON.stringify(t)),new Promise(function(t,e){setTimeout(function(){console.log("3 Seconds"),t()},3100)}).then(function(){r(),"refreshing"!=window.localStorage.getItem("BINGWA_TARGET_FLAG")?i(t):alert("已存在另外的冰蛙目标页面正在刷新中")}).catch(t=>console.log("First Refresh "+t))}else alert("表格中没有TOTAL，修改表格并刷新网页后再试");else alert("表格中没有DEX，修改表格并刷新网页后再试");else alert("表格中没有DEF，修改表格并刷新网页后再试");else alert("表格中没有SPD，修改表格并刷新网页后再试");else alert("表格中没有STR，修改表格并刷新网页后再试");else alert("表格中没有ID，修改表格并刷新网页后再试");else alert("表格中没有Name，修改表格并刷新网页后再试");else alert("表格中没有数据，修改表格并刷新网页后再试")}):alert("仅支持读取xlsx或csv格式！"))}),ue("#target-clear-cache").click(function(){1==confirm("确定清除缓存吗？")?(ue("#target-load-excel").removeAttr("disabled"),ue("#file").removeAttr("disabled"),ue("#target-clear-cache").prop("disabled",!0),ue("#bmw_target_wrapper").empty(),ue("#bmw_target_tips").text("无数据"),window.localStorage.removeItem("BINGWA_TARGET"),o={},window.localStorage.setItem("BINGWA_TARGET_FLAG",""),clearInterval(n),console.log("faction api refreshing ended")):console.log("clear cancelled")})}),ue("#bwm-settings").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(function(){let e="";return ye.forEach(t=>{e+=`
<tr style="height: 32px;">
<td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">${t.title}</td>
<td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">${t.desc}</td>
<td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">
<select id="bwm_settings_${t.name}">
<option value="false">关闭</option>
<option value="true">打开</option>
</select>
</td>
</tr>
`}),`
<div id="bwm_settings_container" style="width: inherit">
<div id="bwm_settings_header" style="text-align:center; margin-bottom: 10px;">
<table style="margin: auto">
<tr>
<td style="padding: 10px;">
<span class="border-round" style="font-size: large; color: #333; background-color:#ccc; padding:5px;border:3px solid #333;">设置</span>
</td>
</tr>
</table>
</div>
<div id="bwm_settings_table" style="text-align:center; margin-bottom: 10px;">
<table style="border:1px solid darkgray; padding: 5px; margin: auto">
<tr style="height: 32px;">
<th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能名称</th>
<th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能描述</th>
<th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能状态</th>
</tr>
${e}
</table>
</div>
</div>
`}()),l("#bwm-settings"),ye.forEach(t=>{ue(`#bwm_settings_${t.name}`).val(Kt("BWM_SETTINGS",t.name)),ue(`#bwm_settings_${t.name}`).change(function(){Yt("BWM_SETTINGS",t.name,ue(this).val())}),window[t.name]="true"==Kt("BWM_SETTINGS",t.name)})}),ue("#bwm-chatlog").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(`
<div id="chatlog_container" style="width: inherit">
<div id="chatlog_header" style="margin: 10px 0px; border: 1px solid darkgray; text-align: center;">
<span style="font-size: large;">聊天记录</span>
</div>
<div id="chatlog" style="min-height:400px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
</div>`),l("#bwm-chatlog");const t=function(){var t=window.localStorage.getItem("CHAT_LAST_MESSAGE");if(null!=t){var i=JSON.parse(t);let o=[];for(const d in i){const c=i[d];let t="",e="";0<=c.indexOf("|||")?(t=c.split("|||")[0],e=c.split("|||")[1]):t=c;var r=re(t),s=new Date(1e3*r).toLocaleString(),l=parseInt((new Date).getTime()/1e3)-r;let a="",n="";l<3600?(a=parseInt(l/60)+"m",n="#5d9525"):3600<=l&&l<86400?(a=parseInt(l/3600)+"h",n="#DAA520"):86400<=l&&l<3024e3?(a=parseInt(l/86400)+"d",n="#c0542f"):3024e3<=l&&(a=parseInt(l/86400)+"d",n="#777"),o.push({chat_ts:r,chat_beijing:s,username:d,diff_ts_format:a,diff_ts_color:n,last_message:e})}return o}}();if(void 0!==t){var e=t.sort(function(t,e){return e.chat_ts-t.chat_ts});let a=`
<table id="chatlog-table" style=" background-color: white; font-size:12px; margin: auto;">
<tr class=chatlog-table-head">
<th class="chatlog-time">最后聊天时间</th>
<th class="chatlog-name">玩家</th>
<th class="chatlog-last">距今</th>
<th class="chatlog-message">最后5条消息</th>
</tr>`;ue.each(e,function(t,e){a+=`
<tr class=chatlog-table-content">
<td class="chatlog-time">${e.chat_beijing}</td>
<td class="chatlog-name">${e.username}</td>
<td class="chatlog-last" style="color:white;background-color:${e.diff_ts_color}">${e.diff_ts_format}</td>
<td class="chatlog-message">${e.last_message}</td>
</tr>`}),a+="</table>",ue("#chatlog").append(a),ue("#chatlog-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;"),ue("#chatlog-table").find("td").css({border:"1px solid darkgray",padding:"5px","text-align":"center"})}}),ue("#bwm-mug").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(`
<div id="mug_container" style="width: inherit">
<div id="mug-head" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
<input type="text" id="mug-watchlist-id-input" placeholder="肥羊 ID" size="10" style="font-size: larger; padding: 5px; margin: 5px;" />
<button id="mug-watchlist-add-input" class="torn-btn" style="margin: 5px;">加入监视</button>
</div>
<div id="mug-watchlist" style="margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;"></div>
<div id="mug-loglist" style="min-height:400px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
</div>`),l("#bwm-mug");let i={};function a(){var t=window.localStorage.getItem("muglog-watchlist");if(null!=t){var a,n=JSON.parse(t);let e=`
<table id="mug-watchlist-table" style=" background-color: white; font-size:12px; margin:auto;"><tr class="mug-watchlist-table-head"><th>Victim ID</th><th>Victim Name</th><th>Total Mugged</th><th>删除</th></tr>`;for(a in n){let t="$0";a in i&&(t=Lt(i[a].amount)),e+=`
<tr class="mug-watchlist-table-content">
<td class="mug-watchlsit-victimid">${a}</td>
<td><a class="user name" href="/profiles.php?XID=${a}" target="_blank">${n[a].name}</a></td>
<td>${t}</td>
<td><a class="mug-watchlist-delete" role="button" style="cursor: pointer; color: darkblue;">删除</a></td>
</tr>`}e+="</table>",ue("#mug-watchlist").append(e),ue("#mug-watchlist-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;"),ue("#mug-watchlist-table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;")}ue(".mug-watchlist-delete").click(function(){var t=ue(this).parent().parent().children(".mug-watchlsit-victimid").text();Zt("muglog-watchlist",t),ue(this).parent().parent().remove(),console.log("删除成功 "+t)})}!function(){var e=window.localStorage.getItem("muglog");if(null!=e){var a,n=JSON.parse(e);let t="</table>";for(a in n){var o=n[a].victim_id;o in i?i[o].amount+=Lt(n[a].money_mugged):i[o]={name:n[a].victim_name,amount:Lt(n[a].money_mugged)},t=`
<tr class="mug-loglist-table-content">
<td class="mug-loglist-ts">${a}</td>
<td class="mug-loglist-time">${n[a].timestring}</td>
<td class="mug-loglist-victimid">${n[a].victim_id}</td>
<td class="mug-loglist-victimname"><a class="user name" href="/profiles.php?XID=${n[a].victim_id}" target="_blank">${n[a].victim_name}</a></td>
<td class="mug-loglist-amount" title="${n[a].timestring}">${n[a].money_mugged}</td>
<td><a class="mug-loglist-watch" role="button" style="cursor: pointer; color: darkblue;">监视</a></td>
<td><a class="mug-loglist-delete" role="button" style="cursor: pointer; color: darkblue;">删除</a></td>
</tr>`+t}t=`
<table id="mug-loglist-table" style=" background-color: white; font-size:12px; margin: auto;">
<tr class="mug-loglist-table-head">
<th class="mug-loglist-ts">Timestamp</th>
<th class="mug-loglist-time">Time</th>
<th class="mug-loglist-victimid">Victim ID</th>
<th class="mug-loglist-victimname">Victim Name</th>
<th class="mug-loglist-amount">Money Mugged</th>
<th>监视</th><th>删除</th>
</tr>`+t,ue("#mug-loglist").append(t)}ue("#mug-loglist-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;"),ue("#mug-loglist-table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),ue("#mug_container")[0].clientWidth<400&&(ue(".mug-loglist-ts").hide(),ue(".mug-loglist-victimid").hide(),ue(".mug-loglist-time").hide())}(),a(),ue(".mug-loglist-delete").click(function(){var t=ue(this).parent().parent().children(".mug-loglist-ts").text();Zt("muglog",t),ue(this).parent().parent().remove(),console.log("删除成功 "+t)}),ue(".mug-loglist-watch").click(function(){var t=ue(this).parent().parent().children(".mug-loglist-victimid").text();Yt("muglog-watchlist",t,{name:ue(this).parent().parent().children(".mug-loglist-victimname").text()}),ue("#mug-watchlist-table").remove(),a(),console.log("监视成功 "+t)}),ue("#mug-watchlist-add-input").click(function(){const e=ue("#mug-watchlist-id-input").val();var t;isNaN(e)||0==e||""==e?alert("无效ID"):(t=`https://api.torn.com/user/${e}?selections=profile&key=${u}`,fetch(t).then(t=>t.json()).then(t=>{if(console.log("API fetched"),null!=t.error&&6==t.error.code)throw alert("无效ID "+e),new Error("Incorrect ID");Yt("muglog-watchlist",e,{name:t.name}),ue("#mug-watchlist-table").remove(),a(),alert("监视成功 "+t.name+"["+e+"]"),console.log("监视成功 "+t.name+"["+e+"]")}).catch(t=>console.log("fetch error: ",t.message)))})}),ue("#bwm-return").click(function(){ue("#bwm").remove(),ue("#sidebarroot").show(),ue(".content-wrapper").show()}),ue("#bwm-addiction").click(function(){ue("#bwm").children(":last").remove(),ue("#bwm").append(function(){const t=ue(`
<div style="width: inherit">
<div style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
<button id="addiction-fast-btn" class="torn-btn addiction-analyze-btn" style="margin:5px;">快速分析</button>
<button id="addiction-full-btn" class="torn-btn addiction-analyze-btn" style="margin:5px;">完整分析</button>
<button id="addiction-faq-btn" class="torn-btn" style="margin:5px;">显示 FAQ</button>
</div>
<div id="addiction-faq" style="display: none; margin:10px 0px; padding: 10px; font-size: 100%; line-height: 1.6; color: #333; border:1px solid darkgray; overflow:hidden; overflow-x: auto;">
<p style="font-size: larger"><b>"自动衰减" 是什么？</b></p>
<p>毒瘾在每天 3:32 TCT 左右会自动减少 20 点。在临近这个时间点戒毒，或者长时间不能吃药时，最好留出一定量的毒瘾，避免浪费每天的自动衰减效果。</p>
<br />
<p style="font-size: larger"><b>"误差修正" 是什么？</b></p>
<p>由于各种原因，冰蛙可能在计算毒瘾的过程中出现误差。戒毒日志中的百分比可以帮助修正这些误差，从而保证后续毒瘾数据的正确性。如果你看到连续多次戒毒日志都伴随着误差修正，那么说明误差一直没有被完全修正。下边是一些可能导致误差的原因：</p>
<ul style="list-style: decimal inside">
<li>你在没有帮派加成的情况下吃了药（比如换帮或者 RW 切技能时）。</li>
<li>你某次戒毒时间与当日自然衰减比较接近。</li>
<li><s>冰蛙代码有 bug。</s></li>
</ul>
<br />
<p style="font-size: larger"><b>"找不到整数解" 和 "找不到计算起点" 是什么错误？</b></p>
<p>冰蛙会根据历史上的一些戒毒日志推算毒瘾，但这个过程有可能会失败。下边是一些可能的原因：</p>
<ul style="list-style: decimal inside">
<li>你戒毒经常拉满到 100%。请每次至少少戒 1 格，多次这样的戒毒才能修复这个错误。</li>
<li>你很久没有戒毒了。如果是这样，"快速分析" 有可能会失败，请尝试 "完整分析"。</li>
<li>你还小。冰蛙需要多次戒毒记录才能计算出毒瘾。</li>
<li><s>冰蛙代码有 bug。</s></li>
</ul>
<br />
<p style="font-size: larger"><b>如何帮助冰蛙改进毒瘾算法？</b></p>
<ul style="list-style: decimal inside">
<li><a href="/page.php?sid=log&log=2200,2210,2220,2230,2240,2250,2260,2270,2280,2290,2295,2201,2211,2221,2231,2241,2251,2261,2271,2281,2291,6005,6504,6253,6720,6722,6723">点这里跳转至日志页面</a></li>
<li>点击日志页面的 "<b>导出所选日志</b>" 按钮，并耐心等待，完成后再次点击该按钮，将数据保存至文件</li>
<li>将导出的文件通过 QQ 发送给 tobytorn [1617955]</li>
</ul>
<br />
<p style="font-size: larger"><b>这份日志里包含了哪些数据？</b></p>
<ul style="list-style: decimal inside">
<li title="日志类型: 2200, 2210, 2220, 2230, 2240, 2250, 2260, 2270, 2280, 2290, 2295, 2201, 2211, 2221, 2231, 2241, 2251, 2261, 2271, 2281, 2291">吃药记录</li>
<li title="日志类型: 6005">戒毒记录</li>
<li title="日志类型: 6504">使用 jp 减毒瘾的记录</li>
<li title="日志类型: 6253, 6720, 6722, 6723">帮派进出记录</li>
</ul>
</div>
<div style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
<table style="margin: 5px auto; max-width: 380px; background-color: white; font-size: 12px; line-height: 1.6; text-align: right;">
<tr><th>当前毒瘾</th><td id="addiction-curr-ap" style="text-align: left"></td></tr>
<tr><th style="white-space:nowrap">近期戒毒效率</th><td id="addiction-efficiency" style="text-align: left"></td></tr>
<tr><th>戒毒建议</th><td style="text-align: left"><ul id="addiction-suggestion" style="list-style: decimal inside"></ul></td></tr>
</table>
<div id="addiction-status" style="text-align: center; margin: 5px;"></div>
</div>
<div style="min-height:700px;margin:10px 0px; border:1px solid darkgray; text-align:center; overflow:hidden; overflow-x: auto;">
<table id="addiction-ap-records" style="margin: 5px auto; background-color: white; font-size:12px;">
<tr class="head">
<th>时间</th>
<th>操作</th>
<th>变化</th>
<th>操作后毒瘾</th>
<th>戒毒效率</th>
</tr>
</table>
</div>
</div>`);return t.find("th").css({border:"1px solid darkgray",padding:"2px 5px","font-weight":"bold"}),t.find("td").css({border:"1px solid darkgray",padding:"2px 5px","min-width":"6em"}),t[0]}()),l("#bwm-addiction");const c=6005,d="误差修正",s="自动衰减",e=12720,p=20;function h(t,e){ue("#addiction-status").text(t),ue("#addiction-status").css("color",e?"red":"")}function g(t){return 86400*Math.ceil((t-e)/86400)+e}function f(t,e,a){let n=g(e);const o=[];for(;n<a&&0<t;){var i=n<1618963200?21:p,i=Math.max(t-i,0);o.push({timestamp:n,title:s,ap_before:t,ap_after:i}),t=i,n+=86400}return o}function b(t,e,a,n){let o=e,i=a;const r=[];for(const l of t.slice().reverse()){var s=f(o,i,l.timestamp);0<s.length&&(r.push(...s),o=r[r.length-1].ap_after),i=l.timestamp;let t=[];t=(l.log===c?function(t,e){const a=[],n=[e];for(let t=1;t<100;t++)n.push(e+t);20<e&&n.push(e-20);let o;for(const s of n){var i=Math.round(s*t.data.addiction/100);if(Math.abs(Math.round(1e4*i/s)-Math.round(100*t.data.addiction))<=1){o=s;break}}if(!o)throw new Error("找不到整数解");o!==e&&(a.push({timestamp:t.timestamp,title:d,ap_before:e,ap_after:o}),e=o);var r=e-Math.round(e*t.data.addiction/100);return a.push({timestamp:t.timestamp,title:"Rehab",ap_before:e,ap_after:r,times:t.data.rehab_times,cost:t.data.cost}),a}:function(t,e){var a={2200:1,2210:10,2220:4,2230:10,2240:5,2250:13,2260:3,2270:7,2280:7,2290:18,2295:25,2201:2,2211:10,2221:25,2231:25,2241:14,2251:25,2261:25,2271:25,2281:25,2291:50};const n=[];return 6504===t.log?(t.data.new_addiction!==e-t.data.job_points_used&&n.push({timestamp:t.timestamp,title:d,ap_before:e,ap_after:t.data.new_addiction+t.data.job_points_used}),n.push({timestamp:t.timestamp,title:t.title,ap_before:t.data.new_addiction+t.data.job_points_used,ap_after:t.data.new_addiction})):t.log in a?n.push({timestamp:t.timestamp,title:t.title,ap_before:e,ap_after:e+a[t.log]}):console.warn("未知毒瘾日志",t),n})(l,o),0<t.length&&(r.push(...t),o=r[r.length-1].ap_after)}return r.push(...f(o,i,n)),r.reverse()}async function a(t){const e=[];let a=null,n=null,o=null,i=null,r=0;for await(const d of oe([126],[],null,null,t=>h(`正在分析日志 (${new Date(1e3*t).format("yyyy-MM-dd")})`))){if(e.push(d),d.log===c){r++;var s=function(t){if(t[0].log!==c||t[t.length-1].log!=c)return null;if(100===t[0].data.addiction||100===t[t.length-1].data.addiction)return null;var e=0===(n=b(t.slice(1,-1),1e4,t[t.length-1].timestamp,t[0].timestamp)).length?0:n[0].ap_after-1e4;if(e<=0)return null;var a=t[t.length-1].data.rehab_times,n=t[t.length-1].data.addiction/100;return e/(t[0].data.rehab_times/(t[0].data.addiction/100)-a/n+a)}(e.slice(n));if(a&&s&&Math.abs(s-a)/s<.001){if(o=Math.round(s*d.data.rehab_times*100/d.data.addiction),i=e.length,t)break}else if(100===d.data.addiction&&2<r&&(o=d.data.rehab_times,i=e.length,t))break;a=s,n=e.length-1}if(t&&450<=e.length)break;if(d.timestamp<1577836800)break}if(!i)throw new Error("找不到计算起点");e.length=i;var l=Math.floor((new Date).getTime()/1e3),l=b(e,o,e[e.length-1].timestamp,l);return[e,l]}function n(t,e){const a={ap:"",efficiency:"",suggestions:[]};if(0===t.length)return a;const n=t[0].ap_after;a.ap=n.toString();var o=t.find(t=>"Rehab"===t.title),i=t.slice(t.indexOf(o)+1).find(t=>"Rehab"===t.title);let r=(o.ap_before-o.ap_after)/o.times,s=r;Math.abs(i.ap_before-i.ap_after-r*i.times)<1?a.efficiency=r.toPrecision(3):(s=(i.ap_before-i.ap_after)/i.times,s<r&&([r,s]=[s,r]),a.efficiency=`${r.toPrecision(3)} ~ ${s.toPrecision(3)}`);let l=n;var d=Math.floor((new Date).getTime()/1e3),i=g(d);i<e||i<d+21600?(l-=p,a.suggestions.push(`<li>下次自动衰减之前大概率没有机会继续吃药，建议戒毒后至少留 ${p} 点毒瘾，若有计划在戒毒之前继续吃药，请吃完再重新计算毒瘾</li>`)):i<Math.max(e,d)+28800&&(l-=p-18,a.suggestions.push(`<li>下次自动衰减之前只能再吃一颗 xan 了，建议戒毒后至少留 ${p-18} 点毒瘾</li>`)),l<=r?a.suggestions.push("<li>毒瘾不足一格戒毒量，不建议戒毒</li>"):r===s?(i=Math.floor(l/r),e=o.cost/o.times*i/1e6,o=Math.floor(r*i),a.suggestions.push(`<li>建议戒毒 ${i} 格，花费 $${e}m，预计戒掉 ${(o/n*100).toFixed(2)}%，剩余 ${n-o} 点毒瘾</li>`)):a.suggestions.push("<li>最近两次戒毒效率差异较大，无法估计下次戒毒次数</li>"),a.suggestions.push("<li>目前关于毒瘾的计算并不准确，上述建议可能存在误差</li>");const c=t.find(t=>t.title.startsWith("Item use"));return(!c||c.title.indexOf("xanax")<0||c.timestamp<d-86400)&&a.suggestions.push("<li>你似乎近期没有在坚持吃 xan，上述建议可能并不准确</li>"),a}function o(t,e){ue("#addiction-curr-ap").text(e.ap),ue("#addiction-efficiency").text(e.efficiency);const a=ue("#addiction-suggestion");a.find("li").remove(),a.append(e.suggestions);const n=ue("#addiction-ap-records");if(n.find("tr").slice(1).remove(),0!==t.length){for(const r of t){let t=r.title,e="";"Rehab"===t?t=`戒毒 ${r.times} 格`:t===s?r.ap_before-r.ap_after<20&&(e="t-red"):t===d?e="t-red":t.startsWith("Item use")&&(t=t.slice("Item use ".length),t=t[0].toUpperCase()+t.slice(1));var o=r.ap_after-r.ap_before,i=0<=o?"t-red":"t-green",o=ue(`<tr>
<td>${new Date(1e3*r.timestamp).format("yyyy-MM-dd hh:mm")}</td>
<td class="${e}">${t}</td>
<td class="${i}">${0<=o?"+":""}${o}</td>
<td>${r.ap_after}</td>
<td>${"Rehab"===r.title?(-o/r.times).toPrecision(3):""}</td>
</tr>`);n.append(o)}n.find("td").attr("style","border: 1px solid darkgray; padding: 5px")}}async function t(t){ue(".addiction-analyze-btn").prop("disabled",!0);try{o([],n([],0));var[,e]=await a(t);o(e,n(e,await async function(){var t=Math.floor((new Date).getTime()/1e3),e=await(await fetch(`https://api.torn.com/user/?selections=cooldowns&key=${u}`)).json();if("error"in e)throw new Error(e.error.error);return t+e.cooldowns.drug}())),h("完成！")}catch(t){console.trace(t),"Access level of this key is not high enough"===t.message?(h("权限不足！",!0),ue("#addiction-status").append('<a href="/preferences.php#tab=api">请使用 Full Access 类型的 API Key</a>')):h(`出错啦！${t}`,!0)}ue(".addiction-analyze-btn").prop("disabled",!1)}ue("#addiction-fast-btn").click(()=>t(!0)),ue("#addiction-full-btn").click(()=>t(!1)),ue("#addiction-faq-btn").click(function(){ue(this).prop("disabled",!0),ue("#addiction-faq").show()})})}})}{function L(){const c=ue("div.profile-buttons div.profile-container div.empty-block");if(0<c.length){c.hasClass("profile-container-description")||c.addClass("profile-container-description"),clearInterval(d),c.css({height:"75","padding-top":"5px","overflow-x":"auto"}),c.siblings(".buttons-wrap").css("padding","0px"),c.html("蛙蛙探测器工作中...");const t=ue(".basic-information").find(".info-table").children(":first").children(".user-info-value").children().text();console.log(`user: ${t}`);const e=t?t.split("[")[0].trim():"",a=t?t.split("[")[1].replace("]","").trim():"",nn=`/personalstats.php?ID=2508936,${a}&stats=activestreak&from=1%20month`;ue(".profile-status").children().children(".title-black").empty().append(`
<span class="border-round" style="color:white;background-color:#DAA520;padding:3px;text-shadow:none;">
<a href="${n}" style="color: white; text-decoration: none;">活跃</a></span>`);const o=function(n){const o=Kt("CHAT_LAST_MESSAGE",n);if(o){let t="";t=0<=o.indexOf("|||")?o.split("|||")[0]:o;n=re(t),n=parseInt((new Date).getTime()/1e3)-n;let e="",a="";return n<3600?(e=parseInt(n/60)+"m",a="#5d9525"):3600<=n&&n<86400?(e=parseInt(n/3600)+"h",a="#DAA520"):86400<=n&&n<3024e3?(e=parseInt(n/86400)+"d",a="#c0542f"):3024e3<=n&&(e=parseInt(n/86400)+"d",a="#777"),[a,e]}}(e);o?ue(".profile-status").children().children(".title-black").append(`
<span class="border-round" style="color:white;background-color:${o[0]};padding:3px;margin-left:5px;">上次唠嗑: ${o[1]}</span>`):console.log("没唠过");const i=le(a);if(console.log("mug_display_arr "+i),i){const r=i.split(",")[0],s=i.split(",")[1],l=i.split(",")[2];ue(".profile-status").children().children(".title-black").append(`
<span class="border-round" style="color:white;background-color:${r};padding:3px;margin-left:5px;">上次mug: ${l} - ${s}</span>`)}else console.log("没mug过");ae(a,function(t){let e=parseInt(100*t.life.current/t.life.maximum);const a=t.life.current+"/"+t.life.maximum+" ("+e+"%)";let n="";n=e<=66?`
<div style="height:20px; overflow:hidden;">
${te(20,e,"#c0542f","#FFF5F7",a)}
</div>`:(100<e&&(e=100),`
<div style="height:20px; overflow:hidden;">
${te(20,e,"#5d9525","#FFF5F7",a)}
</div>`),c.html(`
<table style="width:100%; background-color: #FFF5F7;">
<tr>
<td class="bw-bs">战力</td>
<td>${t.estimate_bs_display}</td>
<td class="bw-stat">XAN</td>
<td>${t.personalstats.xantaken||0}</td>
<td class="bw-other">活跃天数</td>
<td>${parseInt(t.estimate_active_days)||0}</td>
</tr>
<tr>
<td class="bw-bs">血量</td>
<td class="bw-hp">${n}</td>
<td class="bw-stat">LSD</td>
<td>${t.personalstats.lsdtaken||0}</td>
<td class="bw-other">估算WS</td>
<td>${Gt(t.estimate_ws)||0}</td>
</tr>
<tr>
<td class="bw-nw">资产</td>
<td>${Gt(t.personalstats.networth)}</td>
<td class="bw-stat">SE</td>
<td>${t.personalstats.statenhancersused||0}</td>
<td colspan="2"><a class="t-blue" role="button" id="a_click_start_wawa" style="cursor: pointer">更多&gt;&gt;</a></td>
</tr>
</table>
`),c.find("td").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;"),c.find(".bw-bs").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #033649;color: white;font-weight: bold;"),c.find(".bw-nw").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #757947;color: white;font-weight: bold;"),c.find(".bw-other").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #725334;color: white;font-weight: bold;"),c.find(".bw-stat").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #458994;color: white;font-weight: bold;"),c.find(".bw-hp").attr("style","border: 2px solid darkgray; text-align:center;"),ue("div.user-information-section:contains('Last action')").next().children("span").text(t.last_action_details);const o=ue("div.profile-buttons.profile-action").html(),i=`
<div>
<div class="title-black top-round">蛙蛙探测器&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a class="t-white" role="button" id="a_click_start_wawa_back" style="cursor: pointer">返回</a>
</div>
<div class="cont bottom-round ">
<div class="profile-container basic-info bottom-round">
<table style="width:100%; min-height: 320px;">
<tr>
<td style="vertical-align:middle"><span class="bold">估算战力</span></td>
<td style="vertical-align:middle"><span class="bold">${t.estimate_bs_display}</span></td>
<td style="vertical-align:middle"><span class="bold">Xanax数量</span></td>
<td style="vertical-align:middle"><span class="bold">${t.personalstats.xantaken||0}</span></td>
<td style="vertical-align:middle"><span class="bold">SE数量</span></td>
<td style="vertical-align:middle"><span class="bold">${t.personalstats.statenhancersused||0}</span></td>
</tr>
<tr>
<td style="vertical-align:middle"><span class="bold">攻击胜率</span></td>
<td style="vertical-align:middle"><span class="bold">${Gt(t.attackWinRatio)||0}</span></td>
<td style="vertical-align:middle"><span class="bold">防守胜率</td>
<td style="vertical-align:middle"><span class="bold">${Gt(t.defendWinRatio)||0}</span></td>
<td style="vertical-align:middle"><span class="bold">防守胜场</span></td>
<td style="vertical-align:middle"><span class="bold">${t.personalstats.defendswon||0}</span></td>
</tr>
<tr>
<td style="vertical-align:middle"><span class="bold">能量续满</span></td>
<td style="vertical-align:middle"><span class="bold">${t.personalstats.refills||0}</span></td>
<td style="vertical-align:middle"><span class="bold">LSD数量</span></td>
<td style="vertical-align:middle"><span class="bold">${t.personalstats.lsdtaken||0}</span></td>
<td style="vertical-align:middle"><span class="bold">DP占比</span></td>
<td style="vertical-align:middle"><span class="bold">${Gt(t.donator_percent)}</span></td>
</tr>
<tr>
<td style="vertical-align:middle"><span class="bold">活跃天数</span></td>
<td style="vertical-align:middle"><span class="bold">${t.estimate_active_days}</span></td>
<td style="vertical-align:middle"><span class="bold">日均嗑药</span></td>
<td style="vertical-align:middle"><span class="bold">${t.average_drugs}</span></td>
<td style="vertical-align:middle"><span class="bold">Booster</span></td>
<td style="vertical-align:middle"><span class="bold">${Gt(t.personalstats.boostersused)}</span></td>
</tr>
<tr>
<td style="vertical-align:middle"><span class="bold">估算ACE</span></td>
<td style="vertical-align:middle"><span class="bold">${t.estimate_ace}</span></td>
<td style="vertical-align:middle"><strike>估算NNB</strike></td>
<td style="vertical-align:middle"><strike>${t.estimate_nnb}</strike></td>
<td style="vertical-align:middle"><span class="bold">总资产</span></td>
<td style="vertical-align:middle"><span class="bold">${Gt(t.personalstats.networth)}</span></td>
</tr>
</table>
</div>
</div>`,r=function(){ue("div.profile-buttons.profile-action").html(i),ue("div.profile-status").hide(),ue("#a_click_start_wawa_back").click(function(){ue("div.profile-buttons.profile-action").html(o),ue("div.profile-status").show(),ue("#a_click_start_wawa").click(r)})};ue("#a_click_start_wawa").click(r);let s=0;s+=t.enemies/10,s-=t.friends/20,s+=t.personalstats.moneymugged/2e8,s+=t.personalstats.bountiesreceived/50,s=parseInt(s);let l="",d="";d=s<=0?(l="大善人",ve.yellowgreen):s<=10?(l="好人",ve.blue):s<=100?(l="坏人",ve.yellow):(l="大恶人",ve.red),ue("div.basic-information").find("ul.info-table").children("li:eq(9)").children("div.user-info-value").append(`
&nbsp;<span class="border-round" style="padding:2px;background-color:${d};color:white;" title="0分及以下：大善人<br>1-10分：好人<br>11-100分：坏人<br>100分以上：大恶人">${l}</span>
&nbsp;<span title="每有10个敌人加1分<br>每有20个朋友减1分<br>每mug200m加1分<br>每收到50次悬赏加1分"><b>坏比指数: ${s}</b></span>
`)},function(t){c.html(t)})}}0<=window.location.href.indexOf("profiles.php")&&(d=setInterval(L,500))}function G(n,t){let o=!0;if(ue("#parade_filter").length<=0){ue(n).before('<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">阅兵</div><div id="parade_filter" class="cont-gray bottom-rounded content" style="overflow:hidden"><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Level" checked="checked">Level</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="BS" checked="checked">BS</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Mugged" checked="checked">Mugged</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Rehab" checked="checked">Rehab</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Rank" checked="checked">Rank</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Job" checked="checked">Job</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Networth" checked="checked">Networth</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Bazaar">Bazaar</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Defendslost">Defendslost</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Property">Property</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Elimination">Elimination</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Signup">Signup</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Last" checked="checked">Last</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Status" checked="checked">Status</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Life">Life</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="input-wrap" style="margin:5px 10px;"><label for="nw">Bazaar价值 大于 </label><input id="parade_bazaar_value" type="text" style="margin:1px 5px; width:50px" value="10">M</div><div class="btn-wrap" style="margin:5px 10px;"><span class="btn"><button id="parade_start" class="torn-btn" style="margin:1px 5px;">开始阅兵</button></span><span class="btn"><button id="parade_stop" class="torn-btn" style="margin:1px 5px;">暂停阅兵</button></span></div></div></div>'),ue("#parade_stop").prop("disabled",!0);const a=Kt("parade_option","checkbox_vals");var e=Kt("parade_option","text_vals");null!=a&&null!=a&&(ue("#parade_bazaar_value").val(e),ue("#parade_filter input:checkbox").removeAttr("checked"),ue("#parade_filter input:checkbox").each(function(t,e){0<=a.indexOf(ue(this).val())&&ue(this).attr("checked","checked")}))}ue("#parade_start").click(function(){o=!0;let e=ue(t).children("li").first();if(e.length<=0)alert("未找到用户列表");else{const h=ue("#parade_bazaar_value").val().replace(/[^\d]/g,"");let c=[];ue("#parade_filter input:checkbox:checked").each(function(t,e){c.push(ue(this).val())}),console.log(c),ue("#parade_filter input[type='checkbox']").prop("disabled",!0),ue("#parade_filter input[type='text']").prop("disabled",!0),ue(this).prop("disabled",!0),ue("#parade_stop").removeAttr("disabled"),ue("#parade_filter").css("background-color",ve.blue);let t={};if(t.checkbox_vals=c,t.text_vals=h,window.localStorage.setItem("parade_option",JSON.stringify(t)),ue("#search_parade_table").length<1){let e='<p id="search_parade_progress">阅兵进度</p><table id="search_parade_table" style="width:100%;background-color: white;font-size:12px;"><tr><th>Name</th>';for(let t=0;t<c.length;t++)e+=`<th>${c[t]}</th>`;e+="<th>Attack</th></tr></table>",ue(n).before(e),ue("#search_parade_table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;")}function a(){if("1"==e.attr("detected"))console.log("user detected"),p(0);else{e.attr("detected","1");const d=e.find("a[href^='/profiles.php?XID=']").attr("href").replace(/[^0-9|-]/gi,"");ue("#search_parade_progress").text(`正在阅兵：${d}`),ae(d,function(t){let n="Closed",o=0,i=0;if(t.basicicons.icon35){n="Opened";const e=t.bazaar;null!=e&&e.map(function(t,e,a){o+=t.quantity*t.market_price,i+=t.quantity*t.price})}if("Federal"==t.status.state||"Fallen"==t.status.state)console.log("被封/去世，跳过"),ue("#search_parade_progress").text(`阅兵：${d} 被封/去世，跳过`),p(1e3);else if(h&&o<1e6*h)console.log("太穷，跳过"),ue("#search_parade_progress").text(`阅兵：${d} 太穷，跳过`),Yt("battlestats",d,t.estimate_bs),p(1e3);else{let e={};e.Level=t.level,e.BS=Gt(t.estimate_bs),e.Mugged=Gt(t.personalstats.moneymugged),e.Rehab=Gt(t.personalstats.rehabcost||0),e.Rank=t.rank_title,e.Networth=Gt(t.personalstats.networth),e.Defendslost=t.personalstats.defendslost,e.Property=t.property,e.Signup=t.signup,e.Last=t.last_action_brief,e.Status=t.status.state,e.Elimination=null==t.competition?"":t.competition.team;const l=t.job.company_type;var r,s=t.job.job;0==l?e.Job=s:null!=(r=Kt("APICache_companies","companies"))&&null!=r?(e.Job=r[l.toString()].name,e.Job+="Director"==s?"(D)":"(E)"):e.Job=l,e.Life=parseInt(t.life.current/t.life.maximum*100)+"%",e.Bazaar='<span class="t-red">Closed</span>',"Opened"==n&&(e.Bazaar=`<a href="/bazaar.php?userId=${d}"><span class="t-green">${Gt(o)}</span><span class="t-red">/${Gt(i)}</span></a>`);let a=`<tr><td><a class="user name" href="/profiles.php?XID=${d}" target="_blank">${t.name}</a></td>`;for(let t=0;t<c.length;t++)a+=`<td>${e[c[t]]}</td>`;a+=`<td><a class="t-blue c-pointer h attack-act" href="/loader2.php?sid=getInAttack&user2ID=${d}" target="_blank">Attack</a></td></tr>`,console.log(`蛙蛙探测 userId ${d} 成功: ${a}`),ue("#search_parade_table").append(a),ue("#search_parade_table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),Yt("battlestats",d,t.estimate_bs),p(1e3)}},function(t){console.log(`蛙蛙探测 userId: ${d} 失败`),p(1e3)})}}function p(t){e=ue(e.nextAll(e[0].tagName)[0]),0<e.length&&1==o?(console.log(o),setTimeout(a,t)):(console.log("阅兵完成"),ue("#search_parade_progress").text("阅兵完成"),ue("#parade_filter input[type='checkbox']").removeAttr("disabled"),ue("#parade_filter input[type='text']").removeAttr("disabled"),ue("#parade_start").removeAttr("disabled"),ue("#parade_stop").prop("disabled",!0),ue("#parade_start").text("继续阅兵"),ue("#parade_filter").css("background-color","#f2f2f2"))}console.log("阅兵开始"),a()}}),ue("#parade_stop").click(function(){o=!1,console.log("阅兵暂停"),ue("#search_parade_progress").text("阅兵暂停"),ue("#parade_filter input[type='checkbox']").removeAttr("disabled"),ue("#parade_filter input[type='text']").removeAttr("disabled"),ue("#parade_start").removeAttr("disabled"),ue("#parade_filter").css("background-color","#f2f2f2")})}0<=window.location.href.indexOf("page.php?sid=UserList")&&(G("div.userlist-wrapper","ul.user-info-list-wrap"),setInterval(function(){const t=ue(".user-info-list-wrap").find(".expander");0<t.length&&t.each(function(){if("1"!=ue(this).attr("hasdone")){ue(this).attr("hasdone","1");const e=ue(this).children(".user.name").attr("title");var t=se(e.split("[")[0].trim());t&&(console.log(t),ue(this).children(".user.name").append(`
<div class= "border-round" title="<strong>上次唠嗑: </strong>${t[1]}"
style="position: absolute; z-index: 1; top: 0px; right: 30px; width: 44px; height: 20px; margin: 3px; border: 3px solid #000; background-color: ${t[0]}; color: #eee; text-align: center;line-height: 20px;">${t[1]}
</div>`))}})},1e3));{function k(t){const e=t.find("a.faction").attr("href");return e?e.substring(30):0}function L(){const t=ue("ul.users-list").children("li");0<t.length&&t.each(function(t,e){if("1"!=ue(this).attr("oversea")){const a=k(ue(this)),n=ue(this).find("a.name").attr("href").substring(18).trim();a in h&&ue(this).css("background-color","NavajoWhite"),a in xe&&ue(this).css("background-color","DarkSeaGreen"),n in i&&ue(this).css("background-color",ve.purple),ue(this).attr("oversea","1")}})}foo&&0<=window.location.href.indexOf("index.php?page=people")&&(G("div.travel-people","ul.users-list"),i={},null!=(t=window.localStorage.getItem("muglog-watchlist"))&&(i=JSON.parse(t)),setInterval(L,1e3))}const Ne={Mexico:{name:"墨西",time:18},Cayman:{name:"开曼",time:25},Canada:{name:"加拿",time:29},Hawaii:{name:"夏威",time:94},Argentina:{name:"阿根",time:117},United:{name:"英国",time:111},Switzerland:{name:"瑞士",time:123},Japan:{name:"日本",time:158},China:{name:"中国",time:169},UAE:{name:"迪拜",time:190},South:{name:"南非",time:208},Unknown:{name:"剧院",time:1}},ze={Mexican:"Mexico",Caymanian:"Cayman",Canadian:"Canada",Hawaiian:"Hawaii",Argentinian:"Argentina",British:"United",Swiss:"Switzerland",Japanese:"Japan",Chinese:"China",Emirati:"UAE",South:"South"};function W(t){return ue(t).find("td.table-level").text()}function H(t){return ue(t).find("td.table-online").attr("code")}function q(t){return ue(t).find("td.table-revivable").text()}function U(t){return ue(t).find("td.table-position").text()}function X(t){return ue(t).find("td.table-days").text()}function J(t){return ue(t).find("td.table-last").attr("last-action-minutes")}function K(t){var e=ue(t).find("td.table-status").attr("hospital-seconds"),t=ue(t).find("td.table-status").attr("hospital-location"),t=Ne[t];return t?-1e6*t.time+Math.max(e,0):e}function V(t){return ue(t).find("td.table-bs").attr("estimate-bs")}function Y(t){let e=Kt("battlestats",t),a="",n="";return null!=e&&null!=e?(a=Bt(e),n=Gt(e)):e=0,[e,a,n]}function Z(t){const e=new Date;t=parseInt(parseInt(e.getTime()/1e3)-t);let a="";return a=60<=t&&t<3600?parseInt(t/60)+"m":3600<=t&&t<86400?parseInt(t/3600)+"h":86400<=t?parseInt(t/86400)+"d":t+"s",[t,a]}function Q(o,i,r){let s=0,l="town";const d=new Date;o=o.split(" ");if("Abroad"==i)i="="+Ne[o[1]].name,s=0-Ne[o[1]].time,l=o[1];else if("Traveling"==i)1<o.length?"Traveling"==o[0]?(i=">"+Ne[o[2]].name,s=0-Ne[o[2]].time,l=o[2]):"Returning"==o[0]&&(i="<"+Ne[o[4]].name,s=0-Ne[o[4]].time,l=o[4]):(i="剧院",s=-1,l="Unknown");else if("Hospital"==i){let t=parseInt(r-parseInt(d.getTime()/1e3));t<0&&(t=0);let e=parseInt(t/3600);e=e<10?"0"+e:e;let a=parseInt(t%3600/60);a=a<10?"0"+a:a;let n=t%60;n=n<10?"0"+n:n,l="hospital"==o[1]?(i=e+":"+a+":"+n,"town"):(i="海"+e+":"+a+":"+n,ze[o[2]]||"Unknown"),s=t}return[i,s,l]}function tt(t){ue("li.days").text("Last"),ue("li.position").text("BattleStats");let i=200;0<ue("li.position").length&&(i=window.getComputedStyle(ue("li.position")[0]).width.replace(/px$/g,""),console.log(i));var e=`https://api.torn.com/faction/${t}?selections=basic&key=${u}`;fetch(e).then(t=>t.json()).then(o=>{console.log("facPageEnhanced "+t),ue("li.table-row").each(function(){var t=ue(ue(this).find("[class^=userWrap]")).children().attr("href").substring(18),e=Y(t);100<Number(i)?ue(ue(this).find("div.position")).attr("estimate-bs",e[0]).children(":first").text(e[1]):ue(ue(this).find("div.position")).attr("estimate-bs",e[0]).children(":first").text(e[2]);var a=Z(o.members[t].last_action.timestamp);ue(ue(this).find("div.days")).attr("last-action-minutes",a[0]).text(a[1]);var n=o.members[t].status.state,e=o.members[t].status.description,a=o.members[t].status.until,t=o.members[t].status.color,a=Q(e,n,a);ue(ue(this).find("div.status")).attr("sort_score",a[1]).html(`<span class="t-${t}">${a[0]}</span>`)})}).catch(t=>console.log("fetch error",t))}function et(t,e,a){let n=[0,0,0];var o=Kt("APICache_companies","companies");function i(t){return t[0]+t[1]<t[2]?2:t[0]>t[1]?0:1}function r(t){return 0<(t[0]-t[1])*(t[1]-t[2])?1:0<(t[0]-t[2])*(t[2]-t[1])?2:0}function s(t,e){return e/t<=1?e/t:1+(e-t)/t*.5}function l(t,e){if(0==t)return"";t=1.2*e/t;return t<1?"eff-red":t<2?"eff-yellow":"eff-green"}null==o||(c=o[t].positions[e])&&({man_required:p,int_required:h,end_required:g}=c,n=[p,h,g]);var d,c=n[i(n)],p=a[i(n)],h=n[r(n)],g=a[r(n)];const f=.67*s(c,p)+.33*s(h,g),b=(d=f)<1?"eff-red":d<1.5?"eff-yellow":"eff-green",u=l(n[0],a[0]),m=l(n[1],a[1]),y=l(n[2],a[2]);h=Math.floor(Math.min(45,p/c*45*1.2)+Math.floor(Math.min(45,g/h*45*1.2)+Math.floor(Math.max(0,5*Math.log2(1.2*p/c)))+Math.floor(Math.max(0,5*Math.log2(1.2*g/h)))));return[f,b,u,m,y].concat(n).concat(h)}function at(t){let e=0;t=Kt("EMPLOYEE_RANK",t);return null!=t&&null!=t&&(e=t),e}function nt(t){var e=`https://api.torn.com/company/?selections=profile,employees&key=${u}`;const a=ue("#tips-view-company");a.text("---探测中---"),fetch(e).then(t=>t.ok?t.json():void a.text("---探测失败---"),t=>{a.text("---网络异常---")}).then(c=>{if(a.text("---探测完成---"),"error"in c)a.text(`---错误代码：${c.error.code} 错误：${c.error.error}---`);else if("company_employees"in c){ue("#companyname").text(c.company.name),t.prepend(`
<table class="company-effectiveness" style="background-color: #FFF5F7;font-size:12px;margin:auto;">
<tr class="head">
<th class="employee-basic table-position">岗位</th>
<th class="employee-basic table-days">天</th>
<th class="employee-ws table-man">MAN</th>
<th class="employee-ws table-int">INT</th>
<th class="employee-ws table-end">END</th>
<th class="employee-effectiveness table-ws" title="Working Stats">属</th>
<th class="employee-effectiveness table-ep" title="Effectiveness Prediction">估</th>
<th class="employee-basic table-last">登</th>
<th class="employee-basic table-username">名字</th>
<th class="employee-effectiveness table-settled" title="Settled In">天</th>
<th class="employee-effectiveness table-merits" title="Merits">点</th>
<th class="employee-effectiveness table-education" title="Director Education">课</th>
<th class="employee-effectiveness table-management" title="Management">理</th>
<th class="employee-effectiveness table-addiction" title="Addiction">药</th>
<th class="employee-effectiveness table-total" title="Total">总</th>
<th class="employee-status table-tornstats">参</th>
</tr>
</table>`);const p=t.children(".company-effectiveness");p.find("th.employee-basic").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-ws").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-effectiveness").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-status").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #725334;color: white;font-weight: bold;text-align:center;");let a=[];ue.each(c.company_employees,function(t,e){e.userid=t,e.position_rank=at(t),a.push(e)}),a.sort(function(t,e){return t.position_rank-e.position_rank});const h={0:"",1:"eff-yellow",3:"eff-red"};ue.each(a,function(t,e){var a=Z(e.last_action.timestamp),n=172800<=a[0]?3:86400<=a[0]?1:0,o=e.effectiveness.addiction||0,i=o<=-10?3:o<=-5?1:0,r=e.effectiveness.merits||0,s=r<=2?3:r<=4?1:0,l=n+i+s,d=3<=l?3:1<=l?1:0,l=et(c.company.company_type,e.position,[e.manual_labor,e.intelligence,e.endurance]);p.children().append(`
<tr class="content">
<td class="table-position tleft" position-value="${e.position_rank}">${e.position}</td>
<td class="table-days">${e.days_in_company}</td>
<td class="table-man tright ${l[2]}" man="${e.manual_labor}" title="MAN Required: ${Bt(l[5])}">${vt(e.manual_labor)}</td>
<td class="table-int tright ${l[3]}" int="${e.intelligence}" title="INT Required: ${Bt(l[6])}">${vt(e.intelligence)}</td>
<td class="table-end tright ${l[4]}" end="${e.endurance}" title="END Required: ${Bt(l[7])}">${vt(e.endurance)}</td>
<td class="table-ws">${e.effectiveness.working_stats||0}</td>
<td class="table-ep">${l[8]}</td>
<td class="table-last ${h[n]}" last-action-minutes="${a[0]}">${a[1]}</td>
<td class="table-username ${h[d]}"><a class="user name" href="/profiles.php?XID=${e.userid}" target="_blank">${e.name}</a></td>
<td class="table-settled">${e.effectiveness.settled_in||0}</td>
<td class="table-merits ${h[s]}">${r}</td>
<td class="table-education">${e.effectiveness.director_education||0}</td>
<td class="table-management">${e.effectiveness.management||0}</td>
<td class="table-addiction ${h[i]}">${o}</td>
<td class="table-total"><b>${e.effectiveness.total||0}</b></td>
<td class="table-tornstats tright ${l[1]}" effectiveness="${l[0]}"><span>${(100*l[0]).toFixed(0)}%</span></td>
</tr>`)}),p.find("th").css("cursor","pointer"),p.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),p.find("td.tright").css("text-align","right"),p.find("td.tleft").css("text-align","left"),p.find("td.eff-green").css("background-color","#D0E9C6"),p.find("td.eff-yellow").css("background-color","#FAF2CC"),p.find("td.eff-red").css("background-color","#EBCCCC"),Qt(p.find("th.table-position"),it),Qt(p.find("th.table-days"),rt),Qt(p.find("th.table-man"),st),Qt(p.find("th.table-int"),lt),Qt(p.find("th.table-end"),dt),Qt(p.find("th.table-ws"),ct),Qt(p.find("th.table-settled"),pt),Qt(p.find("th.table-merits"),ht),Qt(p.find("th.table-education"),gt),Qt(p.find("th.table-management"),ft),Qt(p.find("th.table-addiction"),bt),Qt(p.find("th.table-total"),mt),Qt(p.find("th.table-last"),J),Qt(p.find("th.table-tornstats"),xt)}}).catch(t=>console.log("fetch error",t))}function ot(F){let O=Jt("company-history-items"),E=0;O&&(E=Object.keys(O).length);const t=new Date,P=new Date(new Date(t.setDate(t.getDate()-1)).setHours(t.getHours()-2)).format("yyyy-MM-dd"),N=Kt("company-history-items",P);const z=Kt("company-history-items",new Date(t.setDate(t.getDate()-1)).format("yyyy-MM-dd"));if(null===F){if(E<=0)return void console.log("没有历史数据，跳过自动获取公司产量数据");if(N)return void console.log("本次产量数据已存过，跳过自动获取公司产量数据");console.log("本次产量数据还没存过，将自动获取公司产量数据")}var e=`https://api.torn.com/company/?selections=profile,employees,stock,detailed,news&key=${u}`;const j=ue("#tips-view-company");j.text("---探测中---"),fetch(e).then(t=>t.ok?t.json():void j.text("---探测失败---"),t=>{j.text("---网络异常---")}).then(g=>{console.log(g);var t=g.company_detailed.trains_available,{rating:e,company_type:a}=g.company;let n=0;var o=Kt("APICache_companies","companies");if(o&&o[a]&&o[a].positions)for(const M in g.company_employees){var i=g.company_employees[M];"Trainer"===o[a].positions[i.position].special_ability&&n++}var r=t+e+3*n;let s=`${t}(当前)+${e}(星级)`;if(0<n&&(s+=`+0~${3*n}(Trainer)`),20<r&&ue("#bingwa-top-warn").append(`
<div class="info-msg border-round">
<i class="info-icon"></i>
<div class="delimiter">
<div class="msg right-round" tabindex="0" role="alert">
trains即将溢出。
${s}
</div>
</div>
</div>`),F){if(null!=g.error&&7==g.error.code)throw j.text("---员工无权限查看---"),new Error("not a director");null!=g&&j.text("---探测完成---"),ue("#companyname").text(g.company.name),F.append(`
<table class="company-effectiveness" style="width:100%;background-color: #FFF5F7;font-size:12px;">
<tr class="head">
<th class="employee-basic table-position">岗位</th>
<th class="employee-basic table-days">天</th>
<th class="employee-ws table-man">MAN</th>
<th class="employee-ws table-int">INT</th>
<th class="employee-ws table-end">END</th>
<th class="employee-effectiveness table-ws" title="Working Stats">属</th>
<th class="employee-effectiveness table-ep" title="Effectiveness Prediction">估</th>
<th class="employee-basic table-last">登</th>
<th class="employee-basic table-username">名字</th>
<th class="employee-effectiveness table-settled" title="Settled In">天</th>
<th class="employee-effectiveness table-merits" title="Merits">点</th>
<th class="employee-effectiveness table-education" title="Director Education">课</th>
<th class="employee-effectiveness table-management" title="Management">理</th>
<th class="employee-effectiveness table-addiction" title="Addiction">药</th>
<th class="employee-effectiveness table-inactivity" title="Inactivity">离</th>
<th class="employee-effectiveness table-total" title="Total">总</th>
<th class="employee-effectiveness table-wage" title="Wage">薪</th>
<th class="employee-status table-tornstats">参</th>
</tr>
</table><br /><br />
<table class="company-history" style="width:100%;background-color: #FFF5F7;font-size:12px;">
<tr class="head">
<th>日期</th>
<th>收入</th>
<th>工资</th>
<th>广告费</th>
<th>利润</th>
<th>总效率</th>
<th>产量</th>
<th>销量</th>
<th>库存</th>
<th>单价</th>
<th>成本</th>
<th>记录</th>
</tr>
</table>`);const $=F.find(".company-effectiveness");$.find("th.employee-basic").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),$.find("th.employee-ws").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),$.find("th.employee-effectiveness").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),$.find("th.employee-status").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #725334;color: white;font-weight: bold;text-align:center;")}let l='<br /><table class="company-stock" style="width:100%;background-color: #FFF5F7;font-size:12px;"><tr class="head"><th>库存种类</th>';ue.each(g.company_stock,function(t,e){l+=`<th>${t}</th>`}),l+='</tr><tr class="content"><td class="stock-title">单价</td>',ue.each(g.company_stock,function(t,e){l+=`<td class="stock-content">${Bt(e.price)}</td>`}),l+='</tr><tr class="content"><td class="stock-title">SOLD WORTH</td>',ue.each(g.company_stock,function(t,e){l+=`<td class="stock-content">${Bt(e.sold_worth)}</td>`}),l+='</tr><tr class="content"><td class="stock-title">SOLD AMOUNT</td>',ue.each(g.company_stock,function(t,e){l+=`<td class="stock-content">${Bt(e.sold_amount)}</td>`}),l+="</tr></table>",ue(".company-effectiveness").after(l),ue(".company-stock").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),ue(".company-stock").find("td.stock-content").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),ue(".company-stock").find("td.stock-title").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;");let d=[];ue.each(g.company_employees,function(t,e){e.userid=t,e.position_rank=at(t),d.push(e)}),d.sort(function(t,e){return t.position_rank-e.position_rank});const f={0:"",1:"eff-yellow",3:"eff-red"};let b=0,u=0;ue.each(d,function(t,e){if(b+=e.wage||0,u+=e.effectiveness.total||0,null===F)return!0;var a=Z(e.last_action.timestamp),n=172800<=a[0]?3:86400<=a[0]?1:0,o=e.effectiveness.addiction||0,i=o<=-10?3:o<=-5?1:0,r=e.effectiveness.inactivity||0,s=r<0?3:0,l=e.effectiveness.merits||0,d=l<=2?3:l<=4?1:0,c=n+i+d,p=3<=c?3:1<=c?1:0,c=et(g.company.company_type,e.position,[e.manual_labor,e.intelligence,e.endurance]),c=`
<tr class="content">
<td class="table-position tleft" position-value="${e.position_rank}">${e.position}</td>
<td class="table-days">${e.days_in_company}</td>
<td class="table-man tright ${c[2]}" man="${e.manual_labor}" title="MAN Required: ${Bt(c[5])}">${vt(e.manual_labor)}</td>
<td class="table-int tright ${c[3]}" int="${e.intelligence}" title="INT Required: ${Bt(c[6])}">${vt(e.intelligence)}</td>
<td class="table-end tright ${c[4]}" end="${e.endurance}" title="END Required: ${Bt(c[7])}">${vt(e.endurance)}</td>
<td class="table-ws">${e.effectiveness.working_stats||0}</td>
<td class="table-ep">${c[8]}</td>
<td class="table-last ${f[n]}" last-action-minutes="${a[0]}">${a[1]}</td>
<td class="table-username ${f[p]}"><a class="user name" href="/profiles.php?XID=${e.userid}" target="_blank">${e.name}</a></td>
<td class="table-settled">${e.effectiveness.settled_in||0}</td>
<td class="table-merits ${f[d]}">${l}</td>
<td class="table-education">${e.effectiveness.director_education||0}</td>
<td class="table-management">${e.effectiveness.management||0}</td>
<td class="table-addiction ${f[i]}">${o}</td>
<td class="table-inactivity ${f[s]}">${r}</td>
<td class="table-total"><b>${e.effectiveness.total||0}</b></td>
<td class="table-wage" wage="${e.wage}"><b>$${Bt(e.wage||0)}</b></td>
<td class="table-tornstats tright ${c[1]}" effectiveness="${c[0]}"><span>${(100*c[0]).toFixed(0)}%</span></td>
</tr>`;const h=F.find(".company-effectiveness");h.children().append(c)});var c=parseInt(g.company.daily_income||0),t=parseInt(g.company_detailed.advertising_budget||0);let p=0,h=0,m=0,y=0,x=0;ue.each(g.company_stock,function(t,e){p+=e.sold_amount*e.cost,h+=e.sold_amount,m+=e.in_stock,y+=e.sold_worth}),0<h&&(x=parseInt(y/h));let v=m;z?(console.log("有上一次的产量数据"),console.log(z),v=z.Stock||m):console.log("没有上一次的产量数据，本次的产量将设置为与销量相等");e=m+h-v,r=c-b-t-p,e={Date:P,Income:c,Wages:b,Ad:t,Profit:r,Effectiveness:u,Produced:e,Sold:h,Stock:m,Price:x,Cost:p,RecordTime:(new Date).format("hh:mm:ss")};console.log(e);let w=!1;var _,k=g.news;for(_ in k){const T=k[_];if(0<=T.news.indexOf("report"))if(new Date(1e3*(T.timestamp-86400)).format("yyyy-MM-dd")==P){w=!0;break}}if(N||!w?console.log("本次产量数据已存过，不再覆盖"):(console.log("本次产量数据未保存，现在保存"),Yt("company-history-items",P,e),O=Jt("company-history-items")),console.log(O),null===F)return!0;const $=F.find(".company-effectiveness");$.find("th").css("cursor","pointer"),$.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),$.find("td.tright").css("text-align","right"),$.find("td.tleft").css("text-align","left"),$.find("td.eff-green").css("background-color","#D0E9C6"),$.find("td.eff-yellow").css("background-color","#FAF2CC"),$.find("td.eff-red").css("background-color","#EBCCCC"),Qt($.find("th.table-position"),it),Qt($.find("th.table-days"),rt),Qt($.find("th.table-man"),st),Qt($.find("th.table-int"),lt),Qt($.find("th.table-end"),dt),Qt($.find("th.table-ws"),ct),Qt($.find("th.table-si"),pt),Qt($.find("th.table-me"),ht),Qt($.find("th.table-de"),gt),Qt($.find("th.table-ma"),ft),Qt($.find("th.table-ad"),bt),Qt($.find("th.table-ia"),ut),Qt($.find("th.table-to"),mt),Qt($.find("th.table-wg"),yt),Qt($.find("th.table-last"),J),Qt($.find("th.table-tornstats"),xt),$.after(`<br /><b>实时人数：${Object.keys(g.company_employees).length}，总工资：$${Bt(e.Wages)}，广告费：$${Bt(e.Ad)}，周销售：$${Bt(g.company.weekly_income)}</b><br />`);let I={Income:0,Wages:0,Ad:0,Profit:0,Effectiveness:0,Produced:0,Sold:0,Stock:0,Price:0,Cost:0};const S=F.find(".company-history");let D=0,C=0,A=0;ue.each(O,function(t,e){var a=parseInt(((new Date).getTime()-new Date(t).getTime())/864e5);if(31<a)return console.log(`删除过期数据：${t}`),Zt("company-history-items",t),delete O[t],!0;A++;t=new Date(t).format("dd");let n=e.RecordTime;0<=n.indexOf(" ")&&(n=n.substr(n.indexOf(" ")+1));t=`
<tr class="content">
<td>${t}</td>
<td>$${Bt(e.Income)}</td>
<td>$${Bt(e.Wages)}</td>
<td>$${Bt(e.Ad)}</td>
<td>$${Bt(e.Profit)}</td>
<td>${Bt(e.Effectiveness)}</td>
<td>${Bt(e.Produced)}</td>
<td>${Bt(e.Sold)}</td>
<td>${Bt(e.Stock)}</td>
<td>$${Bt(e.Price)}</td>
<td>$${Bt(e.Cost)}</td>
<td>${n||"-"}</td>
</tr>`;S.children().append(t),I.Income+=parseInt(e.Income),I.Wages+=parseInt(e.Wages),I.Ad+=parseInt(e.Ad),I.Profit+=parseInt(e.Profit),I.Effectiveness+=parseInt(e.Effectiveness),I.Produced+=parseInt(e.Produced),I.Sold+=parseInt(e.Sold),I.Stock+=parseInt(e.Stock),I.Price+=parseInt(e.Price),I.Cost+=parseInt(e.Cost||0),a<=7&&(D+=parseInt(e.Profit),C++)}),E=Object.keys(O).length;e=`
<tr class="content">
<td><b>平均</b></td>
<td>$${Bt((I.Income/E).toFixed(0))}</td>
<td>$${Bt((I.Wages/E).toFixed(0))}</td>
<td>$${Bt((I.Ad/E).toFixed(0))}</td>
<td>$${Bt((I.Profit/E).toFixed(0))}</td>
<td>${Bt((I.Effectiveness/E).toFixed(0))}</td>
<td>${Bt((I.Produced/E).toFixed(0))}</td>
<td>${Bt((I.Sold/E).toFixed(0))}</td>
<td>${Bt((I.Stock/E).toFixed(0))}</td>
<td>$${Bt((I.Price/E).toFixed(0))}</td>
<td>$${Bt((I.Cost/E).toFixed(0))}</td>
<td>${(new Date).format("hh:mm:ss")}</td>
</tr>`;S.children().append(e),S.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),S.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),S.after(`<br /><b>共 ${E} 天数据，总利润：$${Bt(I.Profit)}，近一周(${C}天)利润：$${Bt(D)}</b>`)}).catch(t=>console.log("fetch error: ",t.message))}function it(t){return ue(t).find("td.table-position").attr("position-value")}function rt(t){return ue(t).find("td.table-days").text()}function st(t){return ue(t).find("td.table-man").attr("man")}function lt(t){return ue(t).find("td.table-int").attr("int")}function dt(t){return ue(t).find("td.table-end").attr("end")}function ct(t){return ue(t).find("td.table-ws").text()}function pt(t){return ue(t).find("td.table-settled").text()}function ht(t){return ue(t).find("td.table-merits").text()}function gt(t){return ue(t).find("td.table-education").text()}function ft(t){return ue(t).find("td.table-management").text()}function bt(t){return ue(t).find("td.table-addiction").text()}function ut(t){return ue(t).find("td.table-inactivity").text()}function mt(t){return ue(t).find("td.table-total").text()}function yt(t){return ue(t).find("td.table-wage").attr("wage")}function xt(t){return ue(t).find("td.table-tornstats").attr("effectiveness")}function vt(t){return t<1e4?t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}):parseInt(t/1e3)+"k"}function wt(n){return new Promise((e,a)=>{var t=`https://api.torn.com/user/${n}?selections=profile&key=${u}`;fetch(t).then(t=>t.ok?t.json():void console.log("---探测失败 "+n+"---"),t=>{console.log("---网络异常 "+n+"---")}).then(t=>{null!=t?"error"in t?a(t.error):(console.log(`userId2otherIds: ${n} => (${t.faction.faction_id} - ${t.faction.position}) (${t.job.company_id} - ${t.job.job})`),e([t.faction.faction_id,t.faction.position,t.job.company_id,t.job.job])):a()}).catch(t=>a(t))})}function _t(i){return new Promise((e,n)=>{const o=ue("#mainContainer").find("div:contains('unavailable')").last();o.text("蛙蛙探测器工作中...");var t=`https://api.torn.com/faction/${i}?selections=basic,chain&key=${u}`;fetch(t).then(t=>t.ok?t.json():void o.text("---探测失败 "+i+"---"),t=>{o.text("---网络异常 "+i+"---")}).then(t=>{if(null!=t)if("error"in t)n(t.error);else{ue("#skip-to-content").text(`帮派: ${t.name}`),o.html(`<b>声望:</b> ${Bt(t.respect)}&nbsp;&nbsp;&nbsp;&nbsp;<b>天数:</b> ${Bt(t.age)}&nbsp;&nbsp;&nbsp;&nbsp;<b>最大连击:</b> ${Bt(t.best_chain)}&nbsp;&nbsp;&nbsp;&nbsp;<b>成员数:</b> ${Object.keys(t.members).length}`),0<t.chain.current&&o.append(`</br /></br /><b>正在连击:</b> ${Bt(t.chain.current)}/${Bt(t.chain.max)}&nbsp;&nbsp;&nbsp;&nbsp;<b>开始时间:</b> ${new Date(1e3*t.chain.start).format("yyyy-MM-dd hh:mm:ss")}&nbsp;&nbsp;&nbsp;&nbsp;<b>连击超时:</b> ${t.chain.timeout}(秒)&nbsp;&nbsp;&nbsp;&nbsp;<b>声望系数:</b> ${t.chain.modifier}&nbsp;&nbsp;&nbsp;&nbsp;<b>冷却时间:</b> ${t.chain.cooldown}`),t.territory_wars&&0<Object.keys(t.territory_wars).length&&(o.append("</br />"),ue.each(t.territory_wars,function(t,e){e.assaulting_faction==i?o.append(`</br /><b>正在进攻地盘:</b> ${e.territory}&nbsp;&nbsp;&nbsp;&nbsp;<b>防守方:</b> <a href='/factions.php?step=profile&ID=${e.defending_faction}' target='_blank'>${e.defending_faction}</a>`):o.append(`</br /><b>正在防守地盘:</b> ${e.territory}&nbsp;&nbsp;&nbsp;&nbsp;<b>进攻方:</b> <a href='/factions.php?step=profile&ID=${e.assaulting_faction}' target='_blank'>${e.assaulting_faction}</a>`),o.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>推墙进度:</b> ${Bt(e.score)}/${Bt(e.required_score)}&nbsp;&nbsp;&nbsp;&nbsp;<b>最迟结束时间:</b> ${new Date(1e3*e.end_time).format("yyyy-MM-dd hh:mm:ss")}`)})),t.peace&&0<Object.keys(t.peace).length&&(o.append("</br />"),ue.each(t.peace,function(t,e){o.append(`</br /><b>和平条约:</b> <a href='/factions.php?step=profile&ID=${t}' target='_blank'>${t}</a>&nbsp;&nbsp;&nbsp;&nbsp;<b>到期时间:</b> ${new Date(1e3*e).format("yyyy-MM-dd hh:mm:ss")}`)})),t.raid_wars&&0<Object.keys(t.raid_wars).length&&(o.append("</br />"),ue.each(t.raid_wars,function(t,e){e.raiding_faction==i?o.append(`</br /><b>正在突击:</b> <a href='/factions.php?step=profile&ID=${e.defending_faction}' target='_blank'>${e.defending_faction}</a>`):o.append(`</br /><b>正在被</b> <a href='/factions.php?step=profile&ID=${e.raiding_faction}' target='_blank'>${e.raiding_faction}</a> 突击`),o.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>突击进度(攻/守):</b> ${e.raider_score}/${e.defender_score}&nbsp;&nbsp;&nbsp;&nbsp;<b>开始时间:</b> ${new Date(1e3*e.start_time).format("yyyy-MM-dd hh:mm:ss")}`)})),ue(".content-wrapper").last().append(`
<table id="faction-members" style="width:100%;background-color: #FFF5F7;font-size:12px;">
<tr class="head">
<th>名字</th>
<th>天数</th>
<th>上次活动</th>
<th>状态</th>
<th>角色</th>
</tr>
</table>`);const a=ue("#faction-members");ue.each(t.members,function(t,e){e=`
<tr class="content">
<td><a href='/profiles.php?XID=${t}' target='_blank'>${e.name}</a></td>
<td>${e.days_in_faction}</td>
<td>${e.last_action.relative}</td>
<td>${e.status.description}</td>
<td>${e.position}</td>
</tr>`;a.children().append(e)}),a.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),a.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),e()}else n()}).catch(t=>o.text(t))})}function kt(r){return new Promise((t,o)=>{if(0<=ue("div.company-details").children("div.title-black").text().indexOf("Oil Rig")){var e,a=ue("div.company-details").find("li:contains('Daily income')").text().replace(/[^\d]/g,"");for(let t=250;120<=t;--t)a%t==0&&(e=parseInt(a/t),ue("div.company-details").children("div.title-black").append(`<span class="m-hide"> - 估算销售: ${t} x ${Bt(e)} </span>`))}const i=ue("#mainContainer").find("div:contains('unavailable')").last();i.text("蛙蛙探测器工作中...");var n=`https://api.torn.com/company/${r}?selections=profile&key=${u}`;fetch(n).then(t=>t.ok?t.json():void i.text("---探测失败 "+r+"---"),t=>{i.text("---网络异常 "+r+"---")}).then(e=>{if(null!=e)if("error"in e)o(e.error);else{var a,t={1:"Hair Salon",2:"Law Firm",3:"Flower Shop",4:"Car Dealership",5:"Clothing Store",6:"Gun Shop",7:"Game Shop",8:"Candle Shop",9:"Toy Shop",10:"Adult Novelties",11:"Cyber Cafe",12:"Grocery Store",13:"Theater",14:"Sweet Shop",15:"Cruise Line",16:"Television Network",18:"Zoo",19:"Firework Stand",20:"Property Broker",21:"Furniture Store",22:"Gas Station",23:"Music Store",24:"Nightclub",25:"Pub",26:"Gents Strip Club",27:"Restaurant",28:"Oil Rig",29:"Fitness Center",30:"Mechanic Shop",31:"Amusement Park",32:"Lingerie Store",33:"Meat Warehouse",34:"Farm",35:"Software Corporation",36:"Ladies Strip Club",37:"Private Security Firm",38:"Mining Corporation",39:"Detective Agency",40:"Logistics Management"};if(ue("#skip-to-content").html(`公司: ${e.company.name}`),i.html(`<b>类型:</b> ${t[e.company.company_type]}&nbsp;&nbsp;&nbsp;&nbsp;<b>星级:</b> ${e.company.rating}&nbsp;&nbsp;&nbsp;&nbsp;<b>员工数:</b> ${e.company.employees_hired}/${e.company.employees_capacity}&nbsp;&nbsp;&nbsp;&nbsp;<b>日销售:</b> $${Bt(e.company.daily_income)}&nbsp;&nbsp;&nbsp;&nbsp;<b>周销售:</b> $${Bt(e.company.weekly_income)}&nbsp;&nbsp;&nbsp;&nbsp;<b>天数:</b> ${Bt(e.company.days_old)}`),28==e.company.company_type){i.append("&nbsp;&nbsp;&nbsp;&nbsp;<b>估算单价x销量:</b>");for(let t=200;120<=t;--t)e.company.daily_income%t==0&&(a=parseInt(e.company.daily_income/t),i.append(` ${t}x${Bt(a)}`))}else 16==e.company.company_type&&(t=parseInt(e.company.daily_income/e.company.daily_customers),i.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>单价x销量:</b> ${Bt(t)}x${Bt(e.company.daily_customers)}`));ue(".content-wrapper").last().append(`
<table id="company-members" style="width:100%;background-color: #FFF5F7;font-size:12px;">
<tr class="head">
<th>名字</th>
<th>天数</th>
<th>上次活动</th>
<th>状态</th>
<th>职位</th>
</tr>
</table>`);const n=ue("#company-members");ue.each(e.company.employees,function(t,e){e=`
<tr class="content">
<td><a href='/profiles.php?XID=${t}' target='_blank'>${e.name}</a></td>
<td>${e.days_in_company}</td>
<td>${e.last_action.relative}</td>
<td>${e.status.description}</td>
<td>${e.position}</td>
</tr>`;n.children().append(e)}),n.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),n.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;")}else o()}).catch(t=>i.text(t))})}if(0<=window.location.href.indexOf("factions.php?step=your")){const je=ue("[href^='/forums.php#!p=forums&f=999&b=1&a=']").attr("href");var $t=0;if(null!=je&&($t=je.substring(34),window.localStorage.setItem("MY_FACTION_ID",$t)),foo){let e=setInterval(It,1e3),a=0;function It(){if(0<=window.location.href.indexOf("factions.php?step=your#/tab=info")&&0<ue("li.position").length){clearInterval(e),a=setInterval(St,1e3),console.log("li position"),G("div.f-war-list","ul.table-body");const t=ue("div[data-faction]").attr("data-faction");tt(t)}}function St(){console.log("faction info"),window.location.href.indexOf("factions.php?step=your#/tab=info")<0&&(clearInterval(a),e=setInterval(It,1e3))}}}if(0<=window.location.href.indexOf("factions.php?step=profile&"))if(0<ue("#mainContainer").find("div:contains('unavailable')").last().length)if(0<=window.location.href.indexOf("profile&ID=")){const fID=/profile&ID=(\d+)/.exec(window.location.href)[1];console.log("fID "+fID),_t(fID).catch(t=>console.log("factionPageRedraw "+t))}else 0<=window.location.href.indexOf("profile&userID=")&&($t=/userID=(\d+)/.exec(window.location.href)[1],console.log("userId "+$t),wt($t).then(function(t){console.log(t),_t(t[0]).catch(t=>console.log("factionPageRedraw "+t))}).catch(t=>console.log("userId2otherIds "+t)));else{function It(){if(0<ue("li.position").length){clearInterval(r),console.log("li position"),G("div.f-war-list","ul.table-body");const t=ue("div[data-faction]").attr("data-faction");tt(t)}}foo&&(r=setInterval(It,1e3))}if(0<=window.location.href.indexOf("p=corpinfo&"))if(0<=window.location.href.indexOf("corpinfo&ID=")){const Re=/corpinfo&ID=(\d+)/.exec(window.location.href)[1];console.log("companyID "+Re),new Promise(function(t,e){setTimeout(function(){console.log("2 Seconds"),t()},2e3)}).then(function(){kt(Re).catch(t=>console.log("companyPageRedraw "+t))}).catch(t=>console.log("companyPageRedraw "+t))}else 0<=window.location.href.indexOf("corpinfo&userID=")&&(s=/userID=(\d+)/.exec(window.location.href)[1],console.log("userId "+s),wt(s).then(function(a){return new Promise(function(t,e){setTimeout(function(){console.log("2 Seconds"),t(a)},2e3)})}).then(function(t){console.log(t),kt(t[2]).catch(t=>console.log("companyPageRedraw "+t))}).catch(t=>console.log("userId2otherIds "+t)));if("https://www.torn.com/competition.php"==window.location.href||"https://www.torn.com/competition.php#/p=main"==window.location.href){const Be=ue("#mainContainer").find("div:contains('access')").last();0<Be.length&&(Be.text("蛙蛙探测器工作中..."),s=`https://api.torn.com/torn/?selections=competition&key=${u}`,fetch(s).then(t=>t.ok?t.json():void Be.text("---探测失败 ---"),t=>{Be.text("---网络异常 ---")}).then(t=>{ue(".content-wrapper").last().append(`
<table id="elim-teams" style="margin-top:10px;width:100%;background-color: #FFF5F7;font-size:12px;">
<tr class="head">
<th>排名</th>
<th>队伍</th>
<th>状态</th>
<th>分数</th>
<th>生命</th>
<th>参与人数</th>
<th>攻击胜利</th>
<th>被攻击</th>
</tr>
</table>`);const e=ue("#elim-teams"),a=t.competition.teams;a.forEach(function(t){t=`
<tr class="content">
<td>${t.position}</td>
<td>${t.name}</td>
<td>${t.status}</td>
<td>${t.score}</td>
<td>${t.lives}</td>
<td>${t.participants}</td>
<td>${t.wins}</td>
<td>${t.losses}</td>
</tr>`;e.children().append(t)}),e.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),e.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;")}).catch(t=>Be.text(t)))}if(0<=window.location.href.indexOf("competition.php")&&setInterval(function(){ue(".description").next().remove(),ue(".description").remove();const t=ue("#e-showAvailable-targets").parent();if(0<t.length&&"1"!=t.attr("hasdone")){t.after(`
<div id="elim-parade">
<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">Elimination Parade
</div>
<div class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
<div class="button-wrap" style="margin:5px; float:left">
<button id="elim-parade-start-btn" class="torn-btn" style="margin:5px;">开始阅兵</button>
<button id="elim-parade-stop-btn"class="torn-btn" style="margin:5px;">暂停阅兵</button>
<p id="elim-parade-status" style="height:12px; padding:6px 1px;"></p>
</div>
</div>
</div>`),t.attr("hasdone","1");const e=ue("#competition-wrap").children(".team-list-wrap").children(".competition-list").children("li");e.each(function(){var t=Y(ue(this).find("a.user.name").attr("href").replace(/[^0-9|-]/gi,""));0!=t[0]&&ue(this).children("ul.list-cols").children("li.attack").children("a").text(t[2])});let o=!0;ue("#elim-parade-start-btn").click(function(){o=!0,ue("#elim-parade-start-btn").prop("disabled",!0),ue("#elim-parade-stop-btn").removeAttr("disabled");const t=e.first();t.length<=0?(ue("#elim-parade-status").text("未找到用户列表"),ue("#elim-parade-start-btn").removeAttr("disabled")):(ue("#elim-parade-status").text("阅兵开始"),setTimeout(()=>{!function e(a){if("1"==a.attr("detected"))ue("#elim-parade-status").text("用户已完成"),setTimeout(()=>{e(a.next())},0);else if(a.length<=0||0==o)ue("#elim-parade-status").text("阅兵已结束"),ue("#elim-parade-start-btn").removeAttr("disabled"),ue("#elim-parade-stop-btn").prop("disabled",!0);else{a.attr("detected","1");const n=a.find("a.user.name").attr("href").replace(/[^0-9|-]/gi,"");ue("#elim-parade-status").text("正在阅兵: "+n),ae(n,function(t){a.children("ul.list-cols").children("li.attack").children("a").text(Gt(t.estimate_bs)),Yt("battlestats",n,t.estimate_bs),Yt("networths",n,t.personalstats.networth),setTimeout(()=>{e(a.next())},1e3)},function(t){ue("#elim-parade-status").text("蛙蛙探测 "+n+" 失败 "+t),setTimeout(()=>{e(a.next())},1e3)})}}(t)},1e3))}),ue("#elim-parade-stop-btn").click(function(){o=!1})}},500),bounty_parade&&window.location.href.indexOf("bounties.php#!p=main")&&setInterval(function(){const t=ue("ul.bounties-list").children(),e=t.first();e.length<=0?ue("div.bounties-total").text("未找到用户列表"):"1"==e.attr("detected")||(ue("div.bounties-total").text("阅兵开始"),setTimeout(()=>{!function e(a){a.attr("detected","1");const n=a.find("div.status");if(0<n.children(".user-red-status").length||0<n.children(".user-blue-status").length)ue("div.bounties-total").text("本条已阅兵完毕"),setTimeout(()=>{e(a.next())},0);else if(null==a.attr("data-id"))ue("div.bounties-total").text("本页阅兵结束");else{const o=a.find("div.target").children("a"),i=o.attr("href").replace(/[^0-9]/gi,"");var t=o.text();ue("div.bounties-total").text("正在阅兵: "+i+" "+t),ae(i,function(t){n.children(".user-green-status").text(Gt(t.estimate_bs)),Yt("battlestats",i,t.estimate_bs),setTimeout(()=>{e(a.next())},0)},function(t){ue("div.bounties-total").text("蛙蛙探测 "+i+" 失败 "+t),setTimeout(()=>{e(a.next())},0)})}}(e)},0))},2e3),mugoo&&0<=window.location.href.indexOf("imarket.php")){let y=window.location.href,x=setInterval(L,500),v=0;var Dt=["Donator Pack","Xanax","Erotic DVD","Drug Pack","Feathery Hotel Coupon","Anti Tank","Large Suitcase","Six-Pack of Energy Drink","Colina Tanprice"],Ct=["Tribulus Omanense","Peony","African Violet","Cherry Blossom","Heather","Ceibo Flower","Edelweiss"],At=["Camel Plushie","Lion Plushie","Panda Plushie","Monkey Plushie","Chamois Plushie","Red Fox Plushie","Nessie Plushie"],Mt=["Can of X-MASS","Can of Taurine Elite","Can of Rockstar Rudolph","Can of Red Cow","Can of Munster","Can of Santa Shooters"],Tt=Kt("bazaar_bookmark","items")??[];async function L(){if(!(0===ue(".market-search").length||0<ue("#bw-bookmark-important").length)){const a=ue(".msg.right-round");a.html(`
<div id="bw-bookmark-important" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${ve.gray}; color:white;">重要</div></div>
<div id="bw-bookmark-flower" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${ve.gray}; color:white;">花花</div></div>
<div id="bw-bookmark-plushie" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${ve.gray}; color:white;">玩偶</div></div>
<div id="bw-bookmark-can" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${ve.gray}; color:white;">能饮</div></div>
<div id="bw-bookmark-favorite" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${ve.gray}; color:white;">其它</div></div>
`);for(let t=0;t<Dt.length;t++){const n=Dt[t].split(" ")[0];ue("#bw-bookmark-important").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${ve.yellowgreen}; color:white;" name="${Dt[t]}">${n}</div>`)}for(let t=0;t<Ct.length;t++){const r=Ct[t].split(" ")[0];ue("#bw-bookmark-flower").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${ve.pink}; color:white;" name="${Ct[t]}">${r}</div>`)}for(let t=0;t<At.length;t++){const s=At[t].replace(/ Plushie/g,"");ue("#bw-bookmark-plushie").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${ve.blue}; color:white;" name="${At[t]}">${s}</div>`)}for(let t=0;t<Mt.length;t++){const l=Mt[t].replace(/Can of /g,"");ue("#bw-bookmark-can").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${ve.yellow}; color:white;" name="${Mt[t]}">${l}</div>`)}for(let t=0;t<Tt.length;t++)ue("#bw-bookmark-favorite").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${ve.yellowgreen}; color:white;" name="${Tt[t]}">${Tt[t]}</div>`);0===Tt.length&&ue("#bw-bookmark-favorite").remove(),ue(".header-link").click(function(){const t=ue(this).attr("name"),e="/imarket.php#/p=shop&step=shop&type=&searchname="+t.replace(/ /g,"+");console.log(e),window.location.href=e});const o=ue(".guns-list.cont-gray"),i=window.location.href;if(o&&0<o.length){clearInterval(x),clearInterval(v),y=window.location.href,v=setInterval(Ft,500);let n=ue(".items").children(":first").find("[itemid]").attr("itemid");if(n=n||(o.children(":first").find("img.torn-item").attr("src")??"").replace(/[^\d]/g,""),""!==n){const d=o.children(":first").find(".name.t-gray-6").text(),c=Dt.concat(Ct).concat(At).concat(Mt).concat(Tt).includes(d),p=Tt.includes(d);if(p?(a.children().last().append(`<div id="bw-bookmark-remove" style="float:right; cursor:pointer; padding:2px; margin:3px; background-color:${ve.red}; color:white;">取消收藏</div>`),ue("#bw-bookmark-remove").click(function(){Yt("bazaar_bookmark","items",Tt.filter(t=>t!==d)),location.reload()})):c||(a.children().last().append(`<div id="bw-bookmark-add" style="float:right; cursor:pointer; padding:2px; margin:3px; background-color:${ve.green}; color:white;">收藏</div>`),ue("#bw-bookmark-add").click(function(){Tt.push(d),Yt("bazaar_bookmark","items",Tt),location.reload()})),c){const g=Math.floor(Date.now()/1e3),f={},b=ue(".desc.t-blue-cont.t-overflow");b.each(function(t,e){const a=ue(this).find(".price.t-gray-6"),n=ue(this).find(".user.t-overflow").children("a"),o=n.attr("href"),i=o?o.replace(/[^\d]/g,""):0,r=a.text().split("(")[0].trim(),s=Lt(r),l=parseInt(a.text().split("(")[1].replace(/\)/g,"").trim());f[i]={price:s,amount:l,ts:g}});const u=await Ot(n,d,f);if(i!==window.location.href)return;for(var[t,e]of Object.entries(u))if(void 0===f[t]){const m=`
<li>
<span class="item-desc">
<span class="item">
<img class="img___3jDmV" src="/images/items/${n}/large.png" alt="${d}">
<a class="item-hover" href="/bazaar.php?userID=${t}"></a>
</span>
<span class="desc t-blue-cont t-overflow">
<span class="user t-overflow">
<a href="/bazaar.php?userID=${t}">Loading...</a>
</span>
<span class="name t-gray-6">${d}</span>
<span class="price t-gray-6"> ${Lt(e.price)}
<span class="stock t-gray-9">(${e.amount})</span>
</span>
</span>
</span>
</li>`;o.children(":last").before(m)}}const h=ue(".desc.t-blue-cont.t-overflow");h.each(function(t,e){const m=ue(this).find(".price.t-gray-6"),y=ue(this).find(".user.t-overflow").children("a"),a=y.attr("href"),x=a?a.replace(/[^\d]/g,""):0;m.prev().remove(),ae(x,function(r){const s=Z(r.last_action.timestamp),l=r.status.color,d=Q(r.status.description,r.status.state,r.status.until),c=r.job.company_type,p=r.basicicons.icon72,h=r.last_action.status,g=r.bazaar,f=r.faction.faction_id;if(g.some(t=>t.ID.toString()===n)){f in xe&&y.parent().parent().css("background-color",ve.green);let t="";t="Online"==h?'<span title="<b>Online</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:0px 0; background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>':"Offline"==h?'<span title="<b>Offline</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:-18px 0;   background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>':'<span title="<b>Idle</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:-1098px 0;  background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>';let e="打",a=ve.purple;5==c&&(e="衣",a=ve.gray),null!=p&&(e="新",a=ve.gray),y.text("");const b=`${t}<a href="/profiles.php?XID=${x}">${r.name}</a>`,u=`<a class= "border-round" style="padding:1px 2px;background-color:${a};color:white;" href="/loader.php?sid=attack&user2ID=${x}">${e}</a>`;y.before(u),y.after(b);let n=0;null!=g&&g.map(function(t,e,a){n+=t.quantity*t.market_price}),m.parent().siblings(".item").css("margin","2px 10px"),m.parent().siblings(".item").append(`<div style="font-size: 13px; line-height: 17px; text-align: center;"><span class="border-round" style="background-color: ${ve.purple}; color: white; padding: 1px 3px;">全店 ${Gt(n)}</span></div>`);let o="";"blue"==l&&(o=ve.blue),"green"==l&&(o=ve.green),"red"==l&&(o=ve.red);let i=`
<span class="left" style="">
<span class= "border-round" style="padding: 1px 3px; background-color: ${o}; color: white;" title="Status: ${r.status.description}">${d[0]}</span>
<span style="padding: 1px 3px;" title="Last Action: ${r.last_action.relative}">${s[1]}</span>
<span style="padding: 1px 3px;" title="BattleStats: ${Gt(r.estimate_bs)}">${Gt(r.estimate_bs)}</span>
</span>`;m.after(i)}else m.parent().parent().parent().remove()})})}}}}function Ft(){y!=window.location.href&&(clearInterval(x),clearInterval(v),y=window.location.href,x=setInterval(L,500))}async function Ot(t,e,a){var n,o,i,r,s=Math.floor(Date.now()/1e3),l=Kt("bazaar_cache",e)??{};const d={};let c=0;for([n,o]of Object.entries(a))d[n]=o,c=Math.max(c,o.price);for([i,r]of Object.entries(l).sort(([,t],[,e])=>t.price-e.price))void 0!==a[i]||r.price<c||r.ts&&(r.ts<s-86400||(d[i]=r));l=`https://api.torn.com/market/${t}?selections=bazaar&key=${u}`;try{var p=await(await fetch(l)).json();console.log(t+" bazaar API fetched");var h,g,f=p.bazaar;for([h,g]of Object.entries(d))if(void 0===a[h]){let t=!1;for(const b of f){if(b.cost===g.price&&b.quantity===g.amount){t=!0;break}if(b.cost>g.price)break}t||delete d[h]}}catch(t){console.log("fetch error",t)}return Yt("bazaar_cache",e,d),d}}{function L(){const t=ue(".users-point-sell").children("li");if(t&&0<t.length){clearInterval(l);let r=[];ue("li.total-price").attr("id","total-price");const e=document.getElementById("total-price"),s=window.getComputedStyle(e).width.replace(/px$/g,"");t.each(function(t,e){const c=ue(this).find(".total-price"),a=ue(this).find(".user.name").attr("href"),n=a?a.replace(/[^\d]/g,""):0,o=ue(this).find(".user.faction").attr("href"),i=o?o.replace(/[^\d]/g,""):0;i in xe&&ue(this).css("background-color",ve.green),-1==r.indexOf(n)&&(r.push(n),Number(s)<200&&c.text(""),ae(n,function(t){const e=Z(t.last_action.timestamp),a=t.status.color,n=Q(t.status.description,t.status.state,t.status.until),o=t.job.company_type,i=t.basicicons.icon72;let r="打",s=ve.purple;5==o&&(r="衣",s=ve.gray),null!=i&&(r="新",s=ve.gray);let l="";"blue"==a&&(l=ve.blue),"green"==a&&(l=ve.green),"red"==a&&(l=ve.red);let d="<span class='left'>";d+=`<span style="padding:1px;margin:1px;background-color:${s};color:white;">${r}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${l};color:white;" title="Status: ${t.status.description}">${n[0]}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${ve.gray};color:white;" title="Last Action: ${t.last_action.relative}">${e[1]}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${ve.blue};color:white;" title="BattleStats: ${Gt(t.estimate_bs)}">${Gt(t.estimate_bs)}</span></span>`,c.prepend(d)}))})}}mugoo&&0<=window.location.href.indexOf("pmarket.php")&&(l=setInterval(L,500))}if(mugoo&&0<=window.location.href.indexOf("bazaar.php")){var Et={};const Le=ue("#mainContainer").find("div:contains('unavailable')").last();function j(){const e=Kt("ITEMS","last-updated");if(null!=e&&null!=e){const a=new Date;let t=new Date(e);t.setDate(t.getDate()+1),t<a&&Pt()}else Pt()}function Pt(){var t=`https://api.torn.com/torn/?selections=items&key=${u}`;fetch(t).then(t=>t.json()).then(t=>{console.log("API fetched");let e={};const a=new Date;for(var n in e["last-updated"]=a.toString(),t.items)e[n]=t.items[n].market_value;window.localStorage.setItem("ITEMS",JSON.stringify(e))}).catch(t=>console.log("fetch error",t))}function L(){const g=ue("[class*='messageContent___']");if("1"!=g.attr("hasdone")){g.attr("hasdone","1"),ue("#sum").remove();let t='<div id="sum">',e=0;for(var a in Et)t+=" (<span class='t-green'> "+Et[a].name+" "+Et[a].total_formal+" </span>) ",e+=Et[a].total;t+="<span class='t-red'><b> Total Selected: "+Gt(e)+" </b></span></div>",g.append(t)}const t=Kt("ITEMS","last-updated"),e=ue("[class^='rowItems___']").children();t&&e&&0<e.length&&e.each(function(t,e){const a=ue(this).find("[class^='name___']").text(),n=ue(this).find("[class^='price___']");let o=0;""!=n.text()&&(o=n.text().replace(/[^\d]/g,""));const i=ue(this).find("img").attr("src");let r=0,s=0;null!=i&&(s=i.split("/")[3],0<s&&(r=Kt("ITEMS",s)));const l=ue(this).find("[class^='amount___']");let d=0;if(""!=l.text()&&(d=l.text().replace(/[^\d]/g,"")),0<r&&0<o&&0<d&&"1"!=ue(this).attr("hasdone")){ue(this).attr("hasdone","1");const c=((o-r)/r*100).toFixed(1),p=Gt(o*d);l.append(`&nbsp;&nbsp;<span><span class="t-blue">${p}</span></span>`),0<=c?n.append(`&nbsp;&nbsp;<span class="change up"><i class="arrow-change-icon" role="img" aria-label="stock price is up"></i><span class="t-green">${c}%</span></span>`):n.append(`&nbsp;&nbsp;<span class="change down"><i class="arrow-change-icon" role="img" aria-label="stock price is down"></i><span class="t-red">${c}%</span></span>`);const h=ue(this).find("[class^='description___']");null!=Et[s]&&h.css("background-color","NavajoWhite"),h.click(function(){ue(this).attr("selected")?(delete Et[s],ue(this).removeAttr("selected"),g.removeAttr("hasdone"),ue(this).css("background-color","")):(Et[s]={name:a,price:o,amount:d,total:o*d,total_formal:Gt(o*d)},ue(this).attr("selected","selected"),g.removeAttr("hasdone"),ue(this).css("background-color","NavajoWhite"))})}})}0<Le.length?(Nt=window.location.href.replace(/[^\d]/g,""),Le.text("蛙蛙探测器工作中..."),Nt=`https://api.torn.com/user/${Nt}?selections=basic,bazaar&key=${u}`,fetch(Nt).then(t=>t.ok?t.json():void Le.text("---探测失败 "+fID+"---"),t=>{Le.text("---网络异常 "+fID+"---")}).then(a=>{if(Le.html(`蛙蛙探测成功^_^ [ <a class="t-blue" href="/profiles.php?XID=${a.player_id}">${a.name}</a>的小店 ]`),null==a.bazaar)Le.html(`货物卖光了:( [ <a class="t-blue" href="/profiles.php?XID=${a.player_id}">${a.name}</a>的小店 ]`),console.log("no item in bazaar");else{ue(".content-wrapper").last().append('<div class="bazaar-wrapper" style="margin-top:10px;"><div class="bazaar-content" style="width:inherit; overflow:hidden; background-color:white;"></div></div>');for(let e=0;e<a.bazaar.length;e++){var n=((a.bazaar[e].price-a.bazaar[e].market_price)/a.bazaar[e].market_price*100).toFixed(2);let t="";t=0<n?`&nbsp;&nbsp;<span class="change up"><i class="arrow-change-icon" role="img" aria-label="stock price is up"></i><span class="t-green">${n}%</span></span>`:`&nbsp;&nbsp;<span class="change down"><i class="arrow-change-icon" role="img" aria-label="stock price is down"></i><span class="t-red">${n}%</span></span>`,ue(".bazaar-content").append(`
<div class="item-wrapper" style="width:288px; float:left; overflow:hidden;">
<div style="width:100px; height:50px; margin:7px; padding:3px; float:left; border:1px solid darkgray;">
<img src="/images/items/${a.bazaar[e].ID}/large.png">
</div>
<div class="item-description" style="width:150px; margin:7px; float:left; border:1px solid darkgray;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
<p class="item-name" style="margin:5px">${a.bazaar[e].name}</p>
<p class="item-price" style="margin:5px">${Lt(a.bazaar[e].price)}${t}</p>
<p class="item-quantity" style="margin:5px">(${a.bazaar[e].quantity} in stock)
<span class="t-blue">&nbsp;&nbsp;${Gt(a.bazaar[e].price*a.bazaar[e].quantity)}</span>
</p>
</div>
</div>`)}}}).catch(t=>Le.text(t))):(j(),setInterval(L,500))}{function L(){const o=ue(".buy-item-info").find(".private-bazaar");0<o.length&&o.each(function(t,e){if("1"!=ue(this).attr("hasdone")){ue(this).attr("hasdone","1");const a=ue(this).find('[href^="bazaar"]').attr("href").replace(/[^\d]/g,""),n=ue(this);ae(a,function(t){n.attr("user_id",a),n.attr("user_name",t.name),n.attr("user_level",t.level),n.attr("user_bs",Gt(t.estimate_bs)),n.attr("user_last",t.last_action.relative),n.attr("user_stat",t.status.description),n.attr("user_job_type",t.job.company_type),n.attr("newbie",t.basicicons.icon72)})}});const t=ue(".buy-item-info-wrap").find(".private-bazaar");0<t.length&&t.each(function(t,e){if("1"!=ue(this).attr("hasdone")){const c=ue(this).find('[href^="bazaar"]').attr("href").replace(/[^\d]/g,""),a=ue(this).find(".user.faction").attr("href"),n=a?a.replace(/[^\d]/g,""):0;n in xe&&ue(this).css("background-color",ve.green);const p=ue(this);o.each(function(t,e){if(ue(this).attr("user_id")==c){console.log(ue(this).attr("user_name"));const a=ue(this).attr("user_name"),n=ue(this).attr("user_level"),o=ue(this).attr("user_bs"),i=ue(this).attr("user_last"),r=ue(this).attr("user_stat"),s=ue(this).attr("user_job_type"),l=ue(this).attr("newbie");let t="打";5==s?t="衣":null!=l&&(t="新");const d=`
<li class="private-bazaar wawa-bazaar" hasdone="1">
<ul class="item t-blue-cont h">
<li class="item-name">
<div class="item-t right t-gray-9">${r}</div>
<div class="name-t icons left">
<span class="t-gray-9">Lv:${n}</span>
<a class="user name" href="/profiles.php?XID=${c} ">
<span title="${a} [${c}]"><b>BS: ${o}</b><span></span></span>
</a>
</div>
<div class="name-t name-mobile left">
<span class="t-gray-9 italic">sold by</span>
<a class="t-blue" href="profiles.php?XID=${c}">BS: ${o}</a>
</div>
<div class="clear"></div>
</li>
<li class="cost">
<span class="t-gray-9" title="${r}">${i}</span>
</li>
<li class="view">
<a href="/loader.php?sid=attack&user2ID=${c}"><b>${t}</b></a>
</li>
<li class="clear"></li>
</ul>
</li>`;return p.after(d),p.attr("hasdone","1"),!1}})}})}mugoo&&0<=window.location.href.indexOf("imarket.php")&&setInterval(L,500)}{function L(){const t=ue("[class^='btn___']");if(0<t.length){const e=t[0];if(ue(e).text().includes("CONTINUE")){const a=ue(e).parent().parent().children(":first").text().split(" ");clearInterval(p),console.log(a);const n=a[2],o=a[1],i=new Date,r=parseInt(i.getTime()/1e3),s=i.format("yyyy-MM-dd hh:mm:ss");if("mugged"==o){let t=a[5];console.log(t),"wallet"==t&&(t="$0");const l={timestring:s,victim_id:c,victim_name:n,money_mugged:t};Yt("muglog",r,l)}}}}0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")&&(c=window.location.href.match(/loader\.php\?sid=attack\&user2ID=(\d+)/)[1],p=setInterval(L,300))}if(0<=window.location.href.indexOf("companies.php")){ue(".info-msg-cont").after("<div id='effectiveness-wrap' style='margin-top:10px; overflow-x: auto;'></div>"),ue(".info-msg-cont").after('<div id="bingwa-top-warn" class="info-msg-cont red border-round m-top10">');var Nt=de();console.log("userId "+Nt),wt(Nt).then(function(t){console.log(t);t=t[3];"Employee"===t?nt(ue("#effectiveness-wrap")):"Director"===t&&ot(ue("#effectiveness-wrap"))}).catch(t=>console.log("userId2otherIds "+t));const Ge=setInterval(function(){const t=ue(".employee-list-wrap").children("ul.employee-list").children("li");if(0<t.length){clearInterval(Ge);let n={},o=0;t.each(function(t,e){var a=ue(this).attr("data-user");n[a]=o,o+=1}),window.localStorage.setItem("EMPLOYEE_RANK",JSON.stringify(n))}},1e3)}else ot(null);0<=window.location.href.indexOf("joblist.php")&&setInterval(function(){const t=ue("ul.rank-list");if(0<t.length&&"1"!=t.attr("hasdone")){t.attr("hasdone","1");t.after(`
<div id="company_parade">
<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">公司阅兵</div>
<div class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
<button id="company_parade_start_btn" class="torn-btn" style="margin:5px;">开始阅兵</button>
<button id="company_parade_stop_btn" class="torn-btn" style="margin:5px;">暂停阅兵</button>
<span id="company_parade_tip" style="margin:5px;"></span>
</div>
</div>`);let a=!0;ue("#company_parade_start_btn").click(function(){a=!0,ue("#company_parade_start_btn").prop("disabled",!0),ue("#company_parade_stop_btn").removeAttr("disabled");const t=ue("ul.company-list").children().first();t.length<=0?(ue("#company_parade_tip").text("未找到公司列表"),ue("#company_parade_start_btn").removeAttr("disabled"),ue("#company_parade_stop_btn").prop("disabled",!0)):(ue("#company_parade_tip").text("阅兵开始"),ue("#company_parade_table").length<=0&&(ue("#company_parade").after(`
<div id="company_parade_table">
<table style="margin:auto;background-color:white;font-size:12px;">
<tr class="head">
<th>星级</th>
<th>名称</th>
<th>老板</th>
<th>天数</th>
<th>员工数</th>
<th title="24h未上线">不活跃</th>
<th title="入职不到10天">新员工</th>
<th>日收入</th>
<th>日单价</th>
<th>周收入</th>
<th>周单价</th>
</tr>
</table>
</div>`),ue("#company_parade_table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;")),setTimeout(()=>{!function d(c){if("1"==c.attr("detected"))ue("#company_parade_tip").text("公司已完成"),setTimeout(()=>{d(c.next())},0);else if(c.length<=0||0==a)ue("#company_parade_tip").text("阅兵已结束"),ue("#company_parade_start_btn").removeAttr("disabled"),ue("#company_parade_stop_btn").prop("disabled",!0);else{c.attr("detected","1");const e=c.children().children("li.view").children().attr("href"),p=e?e.replace(/[^\d]/g,""):0,h=c.children().children("li.company").text();var t=`https://api.torn.com/company/${p}?selections=profile&key=${u}`;ue("#company_parade_tip").text(`正在阅兵：${p} ${h}`),fetch(t).then(t=>t.json()).then(a=>{if("company"in a){var n=a.company.director,o=a.company.employees[n].name;let t=0,e=0;var i,r=parseInt((new Date).getTime()/1e3);for(i in a.company.employees){var s=a.company.employees[i].last_action.timestamp;86400<=r-s&&(t+=1);var l=a.company.employees[i].days_in_company;l<10&&(e+=1)}ue("#company_parade_table").children().append(`
<tr class="content">
<td>${a.company.rating}</td>
<td><a href="#!p=corpinfo&ID=${p}" target="_blank">${a.company.name}</a></td>
<td><a class="user name" href="/profiles.php?XID=${n}" target="_blank">${o}</a></td>
<td>${a.company.days_old}</td>
<td>${a.company.employees_hired}/${a.company.employees_capacity}</td>
<td>${t}</td>
<td>${e}</td>
<td>${Gt(a.company.daily_income)}</td>
<td>${Gt(a.company.daily_income/a.company.daily_customers)}</td>
<td>${Gt(a.company.weekly_income)}</td>
<td>${Gt(a.company.weekly_income/a.company.weekly_customers)}</td>
</tr>`),ue("#company_parade_table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),setTimeout(()=>{d(c.next())},1e3)}else"error"in a&&ue("#company_parade_tip").text(`蛙蛙探测失败：${p} ${h} ${a.error.error}`)}).catch(t=>console.log(t))}}(t)},1e3))}),ue("#company_parade_stop_btn").click(function(){a=!1})}},500)}function zt(t,r){var s=t,l=f(t);f.fn[o].defaults={version:"1.0",symbol:"$",showSymbolButton:!0,errorClass:"error",successClass:"success",groupMoneyClass:"input-money-group",symbolMoneyClass:"input-money-symbol",inputMoneyClass:"input-money",inputHiddenMoneyClass:"",buttonElement:f(".torn-btn"),buttonDisabledClass:"disabled",buttonDisabledAttribute:"disabled",moneySourceData:"data-money",title:"Click here to add the maximum amount, or use shortcuts like <br /> 5k, 1.5m, max, half, quarter, 1/2, 1/3, 1/4, 25%",strictMode:!0,ajaxAction:null,disabled:!1,disabledAutoCorrect:!0,allowNegativeNumbers:!1,skipBlurCheck:!1,minValue:"data-minvalue",onInit:function(){},onDestroy:function(){}};var i=(r=f.extend({},f.fn[o].defaults,r)).allowNegativeNumbers?"[-]?":"",d={digit:function(t){var e=new RegExp("^("+i+"[1-9]\\d*)$","i"),t=t||l.val(),t=e.exec(t);return t?t[1]:null},float:function(t){var e=new RegExp("^("+i+"[1-9]\\d*(?:[,]\\d{3})*)(?:[.]\\d{10})?$","i"),t=t||l.val(),t=e.exec(t);return t?t[1]:null},all:function(t){var e=t||l.val(),t=/^(all|max){1}$/i.exec(e),e=l.attr(r.moneySourceData);return t&&e?e:null},thousand:function(t){var e=new RegExp("^("+i+"\\d+[.]?(\\d{1,3})?)k$","i"),t=t||l.val(),t=e.exec(t);return t?Math.round(1e3*t[1]):null},million:function(t){var e=new RegExp("^("+i+"\\d+[.]?(\\d{1,6})?)m$","i"),t=t||l.val(),t=e.exec(t);return t?Math.round(1e6*t[1]):null},billion:function(t){var e=new RegExp("^("+i+"\\d+[.]?(\\d{1,9})?)b$","i"),t=t||l.val(),t=e.exec(t);return t?Math.round(1e9*t[1]):null},quarter:function(t){var e=t||l.val(),t=/^(1\/4|quarter){1}$/i.exec(e),e=l.attr(r.moneySourceData);return t&&e?Math.round(parseInt(e)/4):null},third:function(t){var e=t||l.val(),t=/^(1\/3){1}$/i.exec(e),e=l.attr(r.moneySourceData);return t&&e?Math.round(parseInt(e)/3):null},half:function(t){var e=t||l.val(),t=/^(1\/2|half){1}$/i.exec(e),e=l.attr(r.moneySourceData);return t&&e?Math.round(parseInt(e)/2):null},percent:function(t){var e=t||l.val(),t=/^([1-9][0-9]?|100)%$/i.exec(e),e=l.attr(r.moneySourceData);return t&&e?Math.round(parseInt(e)*t[1]/100):null},firstZero:function(t){var e=t||l.val(),t=/^([0])/i.exec(e),e=l.attr(r.moneySourceData),e=e?parseInt(e.replace(/,/g,"")):null;return t&&0==e?t[1]:null},zero:function(t){t=t||l.val(),t=/^([0])$/i.exec(t);return t&&!r.strictMode?t[1]:null},fraction:function(t){var e=t||l.val(),t=/^(([1-9])\/([2-9]|10))$/i.exec(e),e=l.attr(r.moneySourceData);return t&&e&&parseInt(t[2])<parseInt(t[3])?Math.round(parseInt(e)*t[2]/t[3]):null}};function c(t){return 65==t.which||17==t.which&&!t.ctrlKey||(91==t.which||224==t.which)&&!t.metaKey}function p(){return r.ajaxAction?f.ajax({method:"POST",url:addRFC(r.ajaxAction),success:function(t){t=h("onMoneyUpdate",t)||t;l.attr(r.moneySourceData,t),l.next().filter('input[type="hidden"].'+r.inputMoneyClass).attr(r.moneySourceData,t)}}):Promise.resolve()}function h(t,e){if(r[t]!==y)return r[t].call(s,e||{})}function g(){var n,a,o=l.val().replace(/,/g,"");if(f.each(d,function(t,e){if(o=f.trim(o),(n=e.call(this,o))||0==n){var a=parseInt(n.toString().replace(/,/g,"")),e=l.attr(r.moneySourceData),e=e?parseInt(e.replace(/,/g,"")):null;return o=(a=(e||0==e)&&e<=a?e:a).toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1,"),l.next().val(a),!1}}),l.val()!=o){var t=l.get(0);Object.getOwnPropertyDescriptor(b.HTMLInputElement.prototype,"value").set.call(t,o);try{t.dispatchEvent(new Event("input",{bubbles:!0}))}catch(t){console.error("Couldn't dispatch the event")}i=f.data(l,"selection_length")||0,e=f.data(l,"old_length")-f.data(l,"old_position"),a=(i=l.get(0).value.length-e+i)<0?0:i,l.each(function(t,e){e.setSelectionRange?e.setSelectionRange(a,a):e.createTextRange&&((e=e.createTextRange()).collapse(!0),e.moveEnd("character",a),e.moveStart("character",a),e.select())}),f.data(l,"selection_length",0)}var t=l.closest("."+r.groupMoneyClass).removeClass(r.successClass).removeClass(r.errorClass),e=r.buttonElement,i=l.attr(r.minValue),i=i?parseInt(i.replace(/,/g,"")):null;!n||0==n&&r.strictMode||(i||0==i)&&o<i?0<o.length&&(t.addClass(r.errorClass),e&&e.addClass(r.buttonDisabledClass),e&&e.prop(r.buttonDisabledAttribute,!0)):(t.addClass(r.successClass),e&&e.removeClass(r.buttonDisabledClass),e&&e.prop(r.buttonDisabledAttribute,!1))}return l.each(function(){var e=f(this),a=e.attr("disabled")||r.disabled;e.attr("disabled",a),e.attr("data-lpignore",!0),a&&e.attr("readonly",!0),r.disabledAutoCorrect&&(e.attr("autocomplete","off"),e.attr("autocorrect","off"),e.attr("autocapitalize","off"),e.attr("spellcheck","false"));var t=f("<input/>").attr("type","button").addClass("wai-btn").attr("aria-label",r.title),n=f("<span/>").attr("title",r.title).addClass(r.symbolMoneyClass).html(r.symbol).append(t),o=f("<div/>").addClass(r.groupMoneyClass+(a?" disabled":"")),t=e.wrap(o).parent();e.addClass(r.inputMoneyClass);o=e.clone();o.attr("type","hidden"),e.after(o),o.addClass(r.inputHiddenMoneyClass),e.attr("name",null);o=e.attr(r.moneySourceData);o?(e.attr(r.moneySourceData,o.replace(/([,\.])/g,"")),r.showSymbolButton&&n.prependTo(t)):t.addClass("no-max-value"),e.on("input",function(t){var e,a,n,o=l.val();r.buttonElement&&(l.val()?(r.buttonElement.removeClass(r.buttonDisabledClass),r.buttonElement.prop(r.buttonDisabledAttribute,!1)):(r.buttonElement.addClass(r.buttonDisabledClass),r.buttonElement.attr(r.buttonDisabledAttribute,!0))),n=l.closest("."+r.groupMoneyClass),l.val()&&n.removeClass(r.errorClass),o?(e=(a=new RegExp("("+i+"[0-9,\\.]*)").exec(o))&&a.input===a[0],n=parseInt(o.replace(/,/g,"")),n=(a=(a=l.attr(r.moneySourceData))?parseInt(a.replace(/,/g,"")):null)&&a<n,e&&!n||n&&p().then(g)):(l.closest("."+r.groupMoneyClass).removeClass(r.successClass),l.closest("."+r.groupMoneyClass).removeClass(r.errorClass)),"0"!==o&&""!==o||l.next().val(o),g();o=l.closest("."+r.groupMoneyClass);h("onAfterChange",{value:l.val(),error:o.hasClass(r.errorClass)}),t.preventDefault()}),e.on("keydown",function(t){c(t)||(f.data(l,"old_position",function(){var t=0,e=l.get(0);{var a,n;m.selection?(e.focus(),a=m.selection.createRange(),n=m.selection.createRange().text.length,a.moveStart("character",-e.value.length),t=a.text.length-n):!e.selectionStart&&"0"!=e.selectionStart||(t=e.selectionStart)}return t}()),f.data(l,"old_length",l.get(0).value.length))}),e.on("select",function(t){c(t)||f.data(l,"selection_length",function(){var t,e,a,n,o=0,i=0;"number"==typeof s.selectionStart&&"number"==typeof s.selectionEnd?(o=s.selectionStart,i=s.selectionEnd):(n=m.selection.createRange())&&n.parentElement()==s&&(a=s.value.length,t=s.value.replace(/\r\n/g,"\n"),(e=s.createTextRange()).moveToBookmark(n.getBookmark()),(n=s.createTextRange()).collapse(!1),-1<e.compareEndPoints("StartToEnd",n)?o=i=a:(o=-e.moveStart("character",-a),o+=t.slice(0,o).split("\n").length-1,-1<e.compareEndPoints("EndToEnd",n)?i=a:(i=-e.moveEnd("character",-a),i+=t.slice(0,i).split("\n").length-1)));return i-o}())}),e.closest("."+r.groupMoneyClass).find("."+r.symbolMoneyClass).on("click",function(t){a||e.attr("readonly")!==y||p().then(function(){e.val("max"),g(),h("onAfterMoneyUpdate")})}),e.val()?g():(r.buttonElement&&r.buttonElement.addClass(r.buttonDisabledClass),r.buttonElement&&r.buttonElement.prop(r.buttonDisabledAttribute,!0)),f(b).focus(function(){}),h("onInit")}),{option:function(t,e){if(!e)return r[t];r[t]=e},destroy:function(){l.each(function(){var t=f(this),e=t.clone(),a=t.parent();e.removeClass(r.inputMoneyClass),a.before(e),t.parent().remove(),h("onDestroy"),t.removeData("plugin_"+o)})},format:g,addRules:function(t,e){var a={};a[t]=e,d=f.extend(d,a)}}}function jt(t){const e=document.getElementById("BINGWA-GLOBAL-STYLE")||function(){const t=document.createElement("style");return t.type="text/css",t.id="BINGWA-GLOBAL-STYLE",document.head.appendChild(t),t}();e.sheet.insertRule(t)}function Rt(t){return Number(t.replace(/,/g,""))}function Bt(t){return 0<=t.toString().indexOf(",")?Rt(t):Number.isNaN(Number(t))?0:t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","})}function Lt(t){return 0<=t.toString().indexOf("$")?Number(t.replace(/\$|,/g,"")):Number.isNaN(Number(t))?0:t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}).replace(/^[^\$]\S+/,function(t){return"$"+t})}function Gt(t){return t<0?"-"+Gt(-t):0==t?"0":t<=1?(100*t).toFixed(2)+"%":t<1e3?""+parseInt(t):1e3<=t&&t<1e6?(t/1e3).toFixed(2)+"k":1e6<=t&&t<1e9?(t/1e6).toFixed(2)+"m":1e9<=t&&t<1e12?(t/1e9).toFixed(2)+"b":1e12<=t&&t<1e15?(t/1e12).toFixed(2)+"t":1e15<=t&&t<1e18?(t/1e15).toFixed(2)+"q":1e18<=t?"MAX":void 0}function Wt(t){return t<0?"-"+Wt(-t):0==t?"0":t<=1?parseFloat((100*t).toFixed(2))+"%":t<1e3?""+parseInt(t):1e3<=t&&t<1e6?parseFloat((t/1e3).toFixed(2))+"k":1e6<=t&&t<1e9?parseFloat((t/1e6).toFixed(2))+"m":1e9<=t&&t<1e12?parseFloat((t/1e9).toFixed(2))+"b":1e12<=t&&t<1e15?parseFloat((t/1e12).toFixed(2))+"t":1e15<=t&&t<1e18?parseFloat((t/1e15).toFixed(2))+"q":1e18<=t?"MAX":"error"}function Ht(t){return"[object Array]"===Object.prototype.toString.call(t)?t:"[object Object]"===Object.prototype.toString.call(t)?Object.values(t):null}function qt(t){var e=Ht(t);if(null==e||e.length<=0)return null;if(t=e,"[object Array]"===Object.prototype.toString.call(t)&&(!(t.length<=1)&&("[object Object]"===Object.prototype.toString.call(t[0])&&0<Object.keys(t[0]).length)))return e;for(let t=0;t<e.length;++t){var a=qt(e[t]);if(null!=a)return console.log(`在第 ${t} 个节点发现有效数据集`),a}return null}function Ut(t){for(var e in t)!function(t,e){var a=t[e];if("object"==typeof a){for(var n in a){var o=a[n];"object"==typeof o?Ut(a):t[n+"_"+e]=o}delete t[e]}}(t,e)}function Xt(e){var t=e[0];Ut(t);let a=Object.keys(t);console.log(`item_keys: ${a}`);for(let t=1;t<e.length;++t){var n=e[t];Ut(n);var o=Object.keys(n);for(let t=0;t<o.length;t++){var i=o[t];console.log(`add item_key: ${i}`),-1==a.indexOf(i)&&a.push(i)}}let r=a.sort().join(",");for(let t=0;t<e.length;++t){r+="\n";var s=e[t];Ut(s);for(let e=0;e<a.length;++e){let t=s[a[e]]+"";"object"==typeof t&&(t=JSON.stringify(t)),t='"'+t.replace(/<[^>]+>/g,"").trim().replace(/\"/g,'""')+'"',0<e&&(r+=","),r+=t}}return encodeURIComponent(r)}function Jt(t){if(void 0!==window.localStorage)return null===window.localStorage.getItem(t)?null:JSON.parse(window.localStorage.getItem(t))}function Kt(t,e){t=Jt(t);if(void 0!==t)return null===t?null:void 0!==t[e]?t[e]:void 0}function Vt(t,e){void 0===window.localStorage||window.localStorage.setItem(t,JSON.stringify(e))}function Yt(e,a,n){if(void 0!==window.localStorage)if(null===window.localStorage.getItem(e)){let t={};t[a]=n,window.localStorage.setItem(e,JSON.stringify(t))}else{let t=JSON.parse(window.localStorage.getItem(e));t[a]=n,window.localStorage.setItem(e,JSON.stringify(t))}}function Zt(t,e){if(void 0!==window.localStorage&&null!==window.localStorage.getItem(t)){const a=JSON.parse(window.localStorage.getItem(t));void 0===a[e]||(delete a[e],window.localStorage.setItem(t,JSON.stringify(a)))}}function Qt(o,i){o.click(function(){const t=ue(this).siblings();t.each(function(){var t=ue(this).text().replace(/[↑↓]/,"");ue(this).text(t),ue(this).removeAttr("sort")});var e=ue(this).text().replace(/[↑↓]/,"");let a="",n="";n="TH"==o[0].tagName?(a=o.parent().siblings(),o.parent().parent()):(a=o.parent().next().children(),o.parent().next()),"descend"==ue(this).attr("sort")?(a.sort(function(t,e){const a=i(t);e=i(e);return isNaN(a)?a.localeCompare(e):a-e}),a.detach().appendTo(n),ue(this).attr("sort","ascend").text(e+"↑")):(a.sort(function(t,e){t=i(t);const a=i(e);return isNaN(t)?a.localeCompare(t):a-t}),a.detach().appendTo(n),ue(this).attr("sort","descend").text(e+"↓"))})}function te(t,e,a,n,o){return`
<div style="position:relative; top:0; width:100%; height:${t-4}px; color:${a}; background-color:${n}; padding:2px 0px; text-align:center;">${o}</div>
<div style="position:relative; top:-${t}px; width:100%; left:${e-100}%; height:${t-4}px; padding:2px 0px; z-index:2; overflow:hidden;">
<div style="position:absolute; top:0; width:100%; left:${100-e}%; height:${t-4}px; color:${n}; background-color:${a}; padding:2px 0px; text-align:center;">${o}</div>
</div>`}function ee(t,e){return ue(t).on("input keydown keyup mousedown mouseup select contextmenu drop focusout",function(t){e(this.value)?this.oldValue=this.value:this.hasOwnProperty("oldValue")?this.value=this.oldValue:this.value=""})}function ae(st,lt,e){if(wawa_detection_cache){var t=function(t){var e,a,n=Math.floor(Date.now()/1e3);const o=Jt("wawa_detection_cache")??{};let i=!1;for([e,a]of Object.entries(o))a.ts<=n-30&&(delete o[e],i=!0);return i&&Vt("wawa_detection_cache",o),o[t]}(st);if(t)return void lt(t)}t=`https://api.torn.com/user/${st}?selections=profile,crimes,personalstats,bazaar&key=${u}`;fetch(t).then(t=>t.ok?t.json():void e("蛙蛙探测失败，请刷新重试"),t=>{e("蛙蛙探测失败，网络异常，请刷新重试")}).then(h=>{if(null!=h)if(h.hasOwnProperty("error"))e(`蛙蛙探测失败：${JSON.stringify(h,null,4)}`);else{var g=h.personalstats,f=g.defendslost||0,b=g.defendsstalemated||0,u=g.defendswon||0,m=g.attackswon||0,y=g.attacksdraw||0,x=g.attackslost||0,v=g.cantaken||0,w=g.exttaken||0,_=g.kettaken||0,k=g.lsdtaken||0,$=g.opitaken||0,I=g.pcptaken||0,S=g.shrtaken||0,D=g.spetaken||0,C=g.victaken||0,A=g.xantaken||0,M=h.age||1,T=g.trainsreceived||0,F=w+k+A,O=((h.xan_lsd_ecs=F)/M).toFixed(2);h.average_drugs=O;var E=g.refills||0,P=g.statenhancersused||0,N=g.useractivity||0,z=g.traveltime||0,j=(g.logins,g.dumpsearches||0),R=g.energydrinkused||0,B=g.boostersused||0,L=g.revives||0,F=m+y+x,O=g.daysbeendonator||0,y=Math.min(M,parseInt((new Date-new Date("2011/11/22"))/864e5));const at=Math.min(O/y,1);h.donator_percent=at.toFixed(2);x=480+240*at,O=611255/x,y=h.last_action.timestamp||0;let t=parseInt((new Date).getTime()/1e3)-y,e="";86400<t&&(e+=parseInt(t/86400)+"天",t%=86400),3600<t&&(e+=parseInt(t/3600)+"时",t%=3600),60<t&&(e+=parseInt(t/60)+"分",t%=60),e+=t+"秒",h.last_action_details=e;const nt=h.last_action.relative;h.last_action_brief=nt.replace(" minute ago","m").replace(" minutes ago","m").replace(" hours ago","h").replace(" hour ago","h").replace(" days ago","d").replace(" day ago","d");let a=0;nt.includes("d")&&(a=parseInt(nt.replace(/[^0-9|-]/gi,"")));y=Math.max(1,21*(M-a)/24),N=3*(N/86400)+z/86400,z=(75*v+210*w+52.5*_+425*k+215*$+430*I+209.5*S+301*D+300*C+420*A)/1440,v=h.criminalrecord.hasOwnProperty("vandalism"),w=(v?.1*h.criminalrecord.theft:h.criminalrecord.other)||0,_=(v?h.criminalrecord.counterfeiting:h.criminalrecord.selling_illegal_products)||0,$=(v?.65*h.criminalrecord.theft:h.criminalrecord.theft)||0,I=(v?h.criminalrecord.illicitservices/2:h.criminalrecord.drug_deals)||0,S=(v?h.criminalrecord.cybercrime:h.criminalrecord.computer_crimes)||0,D=(v?h.criminalrecord.illicitservices/2:h.criminalrecord.murder)||0,C=(v?h.criminalrecord.fraud:h.criminalrecord.fraud_crimes)||0,v=(v?.25*h.criminalrecord.theft:h.criminalrecord.auto_theft)||0;let n=.11*$+.5*S+.66*D+C+.66*v+.05*I;n<0&&(n=0),h.estimate_ace=parseInt(n),12862<n?h.estimate_nnb=60:9171<n?h.estimate_nnb=55:5950<n?h.estimate_nnb=50:4324<n?h.estimate_nnb=45:2750<n?h.estimate_nnb=40:1198<n?h.estimate_nnb=35:450<n?h.estimate_nnb=30:250<n?h.estimate_nnb=25:100<n?h.estimate_nnb=20:50<n?h.estimate_nnb=15:h.estimate_nnb=10;let o=5*(2*w+3*_+5*$+8*I/.8+9*S/.75+10*D/.75+11*C/.95+12*v/.7)/1440;o<O&&(O=Math.min(O/o,3),o*=O);z=Math.min(y,Math.max(N,z,o)).toFixed(2);h.estimate_active_days=z;T=parseInt(75*T+30*z+70*M);h.estimate_ws=T;const ot=parseInt(x*z),it=parseInt(150*E)+(250*A+50*k)+20*R+150*B,rt=25*F+25*L+5*j;let i=ot+it-rt;i<0&&(i=0),h.total_energy=i.toFixed(0),h.nature_energy=ot.toFixed(0),h.item_energy=it.toFixed(0),h.expend_energy=rt.toFixed(0);let r=40;var G=[2,2.8,3.2,3.2,3.6,3.8,3.7,4,4.8,4.8,5.2,5.2,5.4,5.8,5.8,6,6.4,6.6,6.8,7,7,7,7,7.3,8],W=[200,500,1e3,2e3,2750,3e3,3500,4e3,6e3,7e3,8e3,11e3,12420,18e3,18100,24140,31260,36610,46640,56520,67775,84535,106305,1e5,Number.MAX_SAFE_INTEGER];let s=0,l=i,d=W[0];for(var H=parseInt((new Date-new Date("2022/08/02"))/864e5),q=parseInt(i*(H-a)/(M-a));0<l;){let t="",e=Math.min(W[s],l,d,1e3),a=0;var U,X=G[s];a=l>q&&H<M?r<2e8?(t="OLD",1.122*1.02*X*e*((348e-9*Math.log(4750)+31e-7)*r/4+.32433-.0301431777)):(t="CAP",e=l-q,A<k&&A<=100?3240*(l-q):2510*(l-q)):(t="NEW",U=(U=3e9<=r?r-2e9:r/3)<5e7?U:(U-5e7)/(8.77635*Math.log10(U))+5e7,5e-6*X*Math.min(W[s],l,d,1e3)*1.165248*(U*Math.round(1+.07*Math.round(Math.log(21),4),4)+8*Math.pow(5e3,1.05)+1600*(1-Math.pow(5e3/99999,2))+2e3)),r+=a,l-=e,d-=e,console.log(`[${t}] 最近这次在系数为 ${X} 的健身房锻炼了 ${e} 能量，属性 +${a.toFixed(2)} 变为 ${r.toFixed(2)}，剩余 ${l} 能量`),l<=0?console.log("能量已用光"):s<G.length-1&&d<=0&&(console.log("要换健身房了"),++s,d=W[s])}0<P&&(r=.5*r+.25*r*(1+.85*(Math.pow(1.01,.8*P)-1))+.25*r*(1+.85*(Math.pow(1.01,.2*P)-1))),r=Math.floor(r);let c=Wt(r);var J,K=[2,6,11,26,31,50,71,100],V=[100,5e3,1e4,2e4,3e4,5e4],Y=[5e6,5e7,5e8,5e9,5e10],L=[2e3,2e4,2e5,2e6,2e7,2e8],j=[2500,25e3,25e4,25e5,35e6,25e7],Z={"Absolute beginner":1,Beginner:2,Inexperienced:3,Rookie:4,Novice:5,"Below average":6,Average:7,Reasonable:8,"Above average":9,Competent:10,"Highly competent":11,Veteran:12,Distinguished:13,"Highly distinguished":14,Professional:15,Star:16,Master:17,Outstanding:18,Celebrity:19,Supreme:20,Idolised:21,Champion:22,Heroic:23,Legendary:24,Elite:25,Invincible:26};let p=0;for(J in Z)if(0==h.rank.indexOf(J)){p=Z[J],h.rank_value=p,h.rank_name=J;break}P=h.rank.split(" ");if(h.rank_title=P[P.length-1],0<p&&r<Number.MAX_SAFE_INTEGER){--p;var Q=h.level||0;for(let t=0;t<K.length;++t)Q>=K[t]&&--p;var tt=h.criminalrecord.total||0;for(let t=0;t<V.length;++t)tt>=V[t]&&--p;var et=g.networth||0;for(let t=0;t<Y.length;++t)et>=Y[t]&&--p;let t=0,e=Number.MAX_SAFE_INTEGER;p<=0?e=j[0]:p>=L.length?t=L[L.length-1]:(t=L[p-1],e=j[p]),r<t?c=`${c} ~ ${Gt(t)}`:r>e&&(c=`${Gt(e)} ~ ${c}`)}h.estimate_bs=r,h.estimate_bs_display=c,h.attackWinRatio=m/F,h.defendWinRatio=(u+b)/(u+b+f),wawa_detection_cache&&(h.ts=Math.floor(Date.now()/1e3),function(t,e){const a=Jt("wawa_detection_cache")??{};for(a[t]=e;256e3<JSON.stringify(a).length;){var n=Object.entries(a).sort(([,t],[,e])=>t.ts-e.ts)[0][0];console.log("Deleting wawa detection cache for",n,"due to size limit"),delete a[n]}Vt("wawa_detection_cache",a)}(st,h)),lt(h)}})}console.log("冰蛙启动完毕");async function ne(t){switch(console.log(`[cors] get ${t}`),e){case me.GM:return new Promise((e,a)=>{GM_xmlhttpRequest({method:"get",url:t,headers:{"Cache-Control":"no-cache"},timeout:5e3,ontimeout:t=>a("请求超时"),onload:t=>e(t.responseText),onerror:t=>a(`error: ${t}`)})});case me.PDA:return new Promise((e,a)=>{PDA_httpGet(`${t}`).then(t=>{e(t.responseText)}).catch(t=>{a(`error: ${t}`)})});case me.OTHER:default:return new Promise((t,e)=>{e("不支持跨域")})}}async function*oe(t,e,a,n,o){for(n=n||Math.floor((new Date).getTime()/1e3);;){o&&o(n);var i=await async function(t,e,a,n){let o=`https://api.torn.com/user/?selections=log&key=${u}`;0<t.length&&(o+=`&cat=${t.join(",")}`),0<e.length&&(o+=`&log=${e.join(",")}`),a&&(o+=`&from=${a}`),n&&(o+=`&to=${n}`);let i=3;for(;;){let t;if(0<i){const s=new AbortController;t=s.signal,setTimeout(()=>s.abort(),5e3)}let e;try{e=await fetch(o,{signal:t})}catch(t){if("AbortError"!==t.name)throw t;i--;continue}if(!e.ok)throw new Error(e.statusText);var r=await e.json();if("error"in r){if(17===r.error.code&&0<i){i--;continue}throw new Error(r.error.error)}return null===r.log?[]:Object.values(r.log).sort((t,e)=>e.timestamp-t.timestamp)}}(t,e,a,n);if(0===i.length)break;var r=i[i.length-1].timestamp;if(i[0].timestamp==r){for(const s of i)yield s;break}for(const l of i){if(l.timestamp<=r)break;yield l}n=r+1,await new Promise(t=>setTimeout(t,1e3))}}function ie(t){ue("#api_result_container").val(ue("#api_result_container").val()+"\n"+t)}function re(t){var e=t.split("-")[0].trim();const a=t.split("-")[1].replace("TCT","").trim();var n="20"+a.split("/")[2].trim(),o=a.split("/")[1].trim(),t=a.split("/")[0].trim();const i=new Date(n+"/"+o+"/"+t+" "+e);return i.setHours(i.getHours()-(new Date).getTimezoneOffset()/60),parseInt(i.getTime()/1e3)}function se(n){const o=Kt("CHAT_LAST_MESSAGE",n);if(o){let t="";t=0<=o.indexOf("|||")?o.split("|||")[0]:o;n=re(t),n=parseInt((new Date).getTime()/1e3)-n;let e="",a="";return n<3600?(e=parseInt(n/60)+"m",a="#5d9525"):3600<=n&&n<86400?(e=parseInt(n/3600)+"h",a="#DAA520"):86400<=n&&n<3024e3?(e=parseInt(n/86400)+"d",a="#c0542f"):3024e3<=n&&(e=parseInt(n/86400)+"d",a="#777"),[a,e]}}function le(t){var e=window.localStorage.getItem("muglog");if(e){var e=JSON.parse(e),n=Object.entries(e);for(let a=n.length-1;0<=a;a--)if(n[a][1].victim_id==t){var o=n[a][0],i="$"+Gt(Lt(n[a][1].money_mugged)),o=parseInt((new Date).getTime()/1e3)-o;let t="",e="";return o<3600?(t=parseInt(o/60)+"m ago",e="#5d9525"):3600<=o&&o<86400?(t=parseInt(o/3600)+"h ago",e="#DAA520"):86400<=o&&(t=parseInt(o/86400)+"d ago",e="#c0542f"),e+","+t+","+i}}}function de(){return ue("script[uid]").attr("uid")}function ce(){var t=`https://api.torn.com/torn/?selections=companies&key=${u}`;fetch(t).then(t=>t.json()).then(e=>{const a=new Date;if("companies"in e){let t={};for(var n in t["last-updated"]=a.toString(),t.companies={},e.companies)t.companies[n]={name:e.companies[n].name,positions:e.companies[n].positions};window.localStorage.setItem("APICache_companies",JSON.stringify(t))}else"error"in e&&Yt("APICache_companies","last-updated",a.toString())}).catch(t=>console.log("fetch error",t))}function pe(){const n={"车":"<a href='/loader.php?sid=racing'>","啤":"<a href='/shops.php?step=bitsnbobs'>","飞行":"<a href='/travelagency.php'>","上货":"<a href='/bazaar.php#/add'>","买药":"<a href='/page.php?sid=ItemMarket#/market/view=category&categoryName=Most%20Popular'>","点市":"<a href='/pmarket.php'>","股市":"<a href='/page.php?sid=stocks'>","存钱":"<a href='/factions.php?step=your#/tab=armoury'>","取钱":"<a href='/factions.php?step=your#/tab=controls'>","博物":"<a href='/museum.php'>","员工":"<a href='/page.php?sid=UserList&searchConditions=inCompany&searchConditionNot=true&lastAction=1&levelTo=60&daysOldFrom=1200&levelFrom=15'>","群信":"<a href='/factions.php?step=your&type=1#/tab=controls&option=newsletter'>"};setInterval(function(){const t=ue("ul.menu-items");if("1"!=t.attr("hasdone")){if(0<t.siblings().length)for(var e in n)t.append('<li class="menu-item-link">'+n[e]+e+"</a></li>");else for(var a in t.attr("style","width:295px; margin-top:6px; line-height:16px;"),t.children(":last").remove(),t.children(":last").remove(),t.children(":last").remove(),n)t.append('<li class="menu-item-link">'+n[a]+a+"</a></li>");t.attr("hasdone","1")}},1e3)}function he(){setInterval(function(){const t=ue("[class*=chat-list-header__tabs___]");if(0<t.length){const e=t.children(":eq(3)").attr("class");if(0<=e.indexOf("active")){const a=ue("[class*=chat-tab-content___]");"1"!=a.attr("hasDone")&&(a.attr("hasDone","1"),function(i){var t=`https://api.torn.com/faction/?selections=basic,positions&key=${u}`;fetch(t).then(t=>t.json()).then(e=>{if("members"in e&&"positions"in e){const n=Object.keys(e.positions).filter(t=>e.positions[t].canGiveMoney);n.push("Leader","Co-leader");let r=[];for(const o in e.members){var t=e.members[o].position,a=e.members[o].status.state;0<=n.indexOf(t)&&"Okay"==a&&r.push(o)}i.each(function(t,e){var a=0<ue(this).find("[class*=online-status--online___]").length;const n=ue(this).find("a[class*=member-card-detail___]"),o=n.attr("href");var i=o?o.substring(18):0;0<=r.indexOf(i)&&a&&(ue(this).find("a").append("<span style='color:white'><b> 可取钱 在城内</b></span>"),ue(this).css("background-color","Darkseagreen"))})}else"error"in e&&console.log(e.error.error)}).catch(t=>console.log("fetch error",t))}(a.children("div")))}}},3e3)}function ge(t){0<ue("li[class^=icon15__]").length&&ue("#nurse").length<1&&(ue(t).before(`
<div style="margin-bottom:5px;">
<div id='nurse' style='color:#333;width:inherit;margin:auto;padding:10px;border:5px solid gray;background-color:#ccc;text-align:center;'>
<div id='nurse-eff' style='font-size:12px;padding:2px;'></div>
<div id='nurse-cd' style='font-size:24px;padding:2px;'>小护士竭诚为你服务</div>
<div id='nurse-item' style='font-size:12px;padding:2px;'></div>
<div id='nurse-suggestion' style='font-size:24px;padding:2px;'></div>
<div id='nurse-item-life' style='font-size:12px;padding:2px;'></div>
<div id='nurse-suggestion-life' style='font-size:24px;padding:2px;'></div>
</div>
</div>`),t=`https://api.torn.com/user/?selections=profile,cooldowns,perks&key=${u}`,fetch(t).then(t=>t.ok?t.json():void ue("#nurse-cd").text("--- 小护士探测失败 ---"),t=>{ue("#nurse-cd").text("--- 小护士网络异常 ---")}).then(f=>{if(null!=f)if("error"in f)ue("#nurse-cd").text(`--- API错误 --- code: ${f.error.code} error: ${f.error.error}`);else if("basicicons"in f&&"icon15"in f.basicicons){function b(t){let e=parseInt(t/3600);e=e<10?"0"+e:e;let a=parseInt(t/60)%60;a=a<10?"0"+a:a;let n=t%60;return n=n<10?"0"+n:n,e+":"+a+":"+n}var u=f.states.hospital_timestamp,m=u?u-parseInt((new Date).getTime()/1e3):0,y=b(m),x=Math.ceil(m/60),v=100-(f.life.current||0)/(f.life.maximum||7500)*100,w=b(f.cooldowns.medical||0);let a=!1,t=0,e=0,n=0;if("education_perks"in f){const A=f.education_perks;0<=A.indexOf("+ Withdraw and deliver blood")&&(a=!0),0<=A.indexOf("+ 20% medical item effectiveness")&&(t=20),0<=A.indexOf("+ 10% medical item effectiveness")&&(t=10)}if("faction_perks"in f){const M=f.faction_perks;M.forEach(function(t){0<=t.indexOf("medical item effectiveness")&&(e=t?parseInt(t.match(/\d+/)[0]):0),0<=t.indexOf("minutes of maximum medical cooldown")&&(n=t?parseInt(t.match(/\d+/)[0]):0)})}let o=6+parseInt(n/60);o=o<10?"0"+o:o;let i=n%60;i=i<10?"0"+i:i;var _=o+":"+i+":00";const C=parseInt(t)+parseInt(e)+100;console.log(C);let r=0,s=0,l=0,d=0;console.log(x);var k=function t(e){return a&&e>.7*C?(r+=1,t(e-1.2*C)):e>.4*C?(s+=1,t(e-.7*C)):e>.2*C?(l+=1,t(e-.4*C)):0<e?(d+=1,t(e-.2*C)):e}(x);console.log(k);var $=0==r?"":"大血包*"+r,I=0==s?"":"吗啡*"+s,S=0==l?"":"小蓝包*"+l,D=0==d?"":"小红包*"+d,u=30*r+20*s+15*l+10*d;let c=0,p=0,h=0,g=0;m=function t(e){return a&&e>.15*C?(c+=1,t(e-.3*C)):e>.1*C?(p+=1,t(e-.15*C)):e>.05*C?(h+=1,t(e-.1*C)):0<e?(g+=1,t(e-.05*C)):e}(v);console.log(m);f=0==c?"":"大血包*"+c,x=0==p?"":"吗啡*"+p,k=0==h?"":"小蓝包*"+h,v=0==g?"":"小红包*"+g,m=30*c+20*p+15*h+10*g;ue("#nurse-cd").text(`住院时间 ${y} 医疗冷却 ${w}/${_}`),ue("#nurse-eff").text(`抽血: ${a} 教育加成: +${t}% 帮派加成: +${e}%`),ue("#nurse-item").text(`大血包: -${parseInt(1.2*C)}分钟 吗啡: -${parseInt(.7*C)}分钟 小蓝包: -${parseInt(.4*C)}分钟 小红包: -${parseInt(.2*C)}分钟`),ue("#nurse-suggestion").text(`【出院模式】 ${$} ${I} ${S} ${D} (冷却 +${u}分钟)`),ue("#nurse-item-life").text(`大血包: 回血+${parseInt(.3*C)}% 吗啡: 回血+${parseInt(.15*C)}% 小蓝包: 回血+${parseInt(.1*C)}% 小红包: 回血+${parseInt(.05*C)}%`),ue("#nurse-suggestion-life").text(`【满血模式】 ${f} ${x} ${k} ${v} (冷却 +${m}分钟)`)}}).catch(t=>ue("#nurse-cd").text(t)))}function fe(o){if(null!==o.sharedData){const t=ue("#faction-armoury-tabs div.armoury-tabs:visible ul.item-list > li");if(0!==t.length){const i=Math.floor(Date.now()/1e3);t.each(function(){var a=ue(this).find("[data-armoryid]").first().attr("data-armoryid"),a=o.sharedData[a];if(a&&a.shared&&!(0<ue(this).find(".bw-shared-armory").length)){const t=ue('<div class="bw-shared-armory"><div></div></div>');a.factionId===o.factionId?(t.children().text(a.text??"公"),t.children().css("color",a.color??"white"),t.children().css("background",a.background??"#5d9525")):(t.children().text("外"),t.children().css("color","white"),t.children().css("background","#5d9525")),ue(this).children(".name").append(t);const n=ue(this).find('.loaned a[href^="/profiles.php?XID="]').first(),e=n.attr("href");a=e?e.substr(18):void 0,a=o.lastActions[a];if(a){a=i-a;let t="",e="";e=a<3600?(t=`${(a/60).toFixed(0)}m`,"#5d9525"):a<86400?(t=`${(a/3600).toFixed(0)}h`,"#DAA520"):(t=`${(a/86400).toFixed(0)}d`,"#c0542f"),n.after(`<span style="color:white;background-color:${e};padding:4px;margin-left:4px;border-radius:4px">${t}</span>`)}}})}}else o.error}function be(){if(this.dataset.confirm){if(!confirm(this.dataset.msg))return}else alert(this.dataset.msg);ue(this).hide(),ue(this).siblings(".travel-info-btn").show()}}}function getVersion(){var e,a={"3.4.4":{date:"2024.11.27",notes:["修改: 优化冰蛙战力估算（对50mcap取消日前后分段、按新旧锻炼公式分别计算）by bingri"]},"3.4.3":{date:"2024.09.07",notes:["修复: 公司详情在有员工未指定职位时无法显示的问题 by toby","修复: PDA 上预估战力时的卡顿 by toby","修复: 预估战力数值溢出错误 by toby","修复: 健身房实际系数错误 by toby","修复: 冰蛙版本记录中日期停留在 2023 年的错误 by toby"]},"3.4.2":{date:"2024.08.17",notes:["修复: 优化冰蛙战力估算（取消50m cap的新锻炼公式 + se主要吃一维）by bingri","修改: 监狱界面显示当日 bust 人数 (TCT 零点开始) by kaeru","修复: 修复查看 API 中部分字段在手机上显示不全的问题 by toby","修改: 更新查看 API 中的字段列表 by toby","修改: 删除设置中的聊天快捷取钱选项并总是启用该功能 by toby","修改: 保存所有聊天窗口中的最近聊天记录 (之前版本会忽略 1 天内无新消息的对话) by toby","修改: 帮派武器库中注明外帮公共装备 by toby","修改: 更新市场快捷链接中 Colina Tanprice 的名称 by toby","修改: 将 Hermit Sage 加入友帮列表 by toby"]},"3.4.1":{date:"2024.06.10",notes:["修改: 在市场入口也显示山贼助手 by toby"]},"3.4.0":{date:"2024.06.10",notes:["新功能: 允许编辑市场物品关注列表 by toby","新功能: 默认缓存蛙蛙探测结果30秒，可在设置中禁用 by toby","修复: 山贼助手缓存因 API 变化导致的错误 by toby","修复: 山贼助手在当前物品无人出售时的显示错误 by toby"]},"3.3.8":{date:"2024.05.19",notes:["新功能: 显示帮派仓库中的共享装备 by toby","修复: 删除对 torn.com 脚本的依赖，改为使用 cdnjs by toby","修复: 最近聊天记录时间戳识别错误 by toby"]},"3.3.7":{date:"2024.01.26",notes:["修复: 跨域请求(加载帮派贷款)在新版 PDA 上的错误 by toby"]},"3.3.6":{date:"2023.12.19",notes:["修复: 聊天快捷取钱及时间戳 by toby","修复: 最近聊天记录 by toby","删除: 插件中心 by toby","删除: 复活助手功能 by toby"]},"3.3.5":{date:"2023.11.26",notes:["修复: RW 墙上敌人 bs 显示 by toby","修改: 添加聊天时间戳距离现在的时间差 by toby","修改: 加载贷款额度失败时显示失败原因 by toby","修改: 更新帮派贷款相关的跨域 URL by toby"]},"3.3.4":{date:"2023.11.05",notes:["修复: 聊天取钱玩家名称识别错误 by toby","修复: 最近聊天时间戳 by toby"]},"3.3.3":{date:"2023.10.23",notes:["修复: 聊天快捷取钱适配新聊天 by toby","修复: 取钱助手适配新聊天 by toby","修复: 聊天记录适配新聊天 by toby","修复: 高级搜索界面的上次聊天时间戳 by toby","删除: 聊天时间戳 by toby"]},"3.3.2":{date:"2023.10.20",notes:["修复: 帮派取钱界面 by toby","修改: 提高毒瘾分析的计算精度 by toby"]},"3.3.1":{date:"2023.09.23",notes:["修复: 系统商店买不了啤酒的问题 by toby","修复: 市场快捷搜索中饮料箱的名称 by toby","修复: 快捷取钱全取按钮对贷款额度的处理 by toby","修复: 第一个犯罪百分比的显示问题 by toby","修改: 在脚本结尾添加一行标志结束的注释 by toby"]},"3.3.0":{date:"2023.08.13",notes:["重要改动: 基于安全方面的考虑，删除插件中心的自动安装功能，之前自动安装的插件需重新手工安装 by toby","新功能: 显示调账 event 变化金额 by toby","修复: 市场中武器防具的 bazaar 价格显示错误的问题 by toby","修复: 起飞前提醒 by toby","修复: 将锻炼比例选项挪回健身房列表下方 by toby","修改: 飞花过滤由白名单改为黑名单，以避免过滤新增物品 by toby","修改: 添加手工检查贷款按钮以绕过贷款检查 by toby","删除: 犯罪经验 by toby"]},"3.2.3":{date:"2023.07.16",notes:["新功能: 取钱时检查贷款额度 by toby","修复: Firefox 上的跨域请求 by toby","修改: raid 墙上也显示 bs by toby"]},"3.2.2":{date:"2023.07.13",notes:["修复: 小护士智能提醒出院吃药 by toby","修改: 海外市场不再屏蔽墨西哥酒和中国crime道具 by toby","修改: 快捷取钱无需金额也会显示按钮（例如全取）by toby","修改: 地盘战显示最快攻陷时间 by toby","修改: 适配工作信息相关的 API 更新 by toby"]},"3.2.1":{date:"2023.06.24",notes:["新功能: 犯罪助手 - 显示成功率最高的选项的百分比，需要手动在设置中打开 by toby","修复: 护士建议住院时间取整问题 by toby","修改: 蛙蛙探测勉强支持 crime 2.0 by toby","修改: 估算地盘战的最少进攻人数和最少防守时间 by toby","修改: 计划删除犯罪经验估算功能 by toby","修改: 隐藏并计划删除蛙蛙探测中的估算 NNB by toby"]},"3.2.0":{date:"2023.06.18",notes:["修复: 悬赏阅兵 by toby","修复: 修复自定义取钱快捷方式 by toby","修改: 帮派详情页重排各列顺序 by toby","修改: 帮派详情页重新读取时保留排序方式 by toby","修改: 快捷取钱中避免在住院时调账 by toby","修改: 快捷取钱支持英文关键字 withdraw by toby","修改: 犯罪经验中 nnb < 50 时不再计算预估升级天数 by toby"]},"3.1.11":{date:"2023.05.16",notes:["新功能: 设置中添加侧边栏冰蛙图标的开关 by kaeru","新功能: 新增快速 bail by toby","修复: 同时开启冰蛙和 TT 的快速 bust 时可以正常工作了 by toby","修复: 修复取钱助手(右下角people框)可取钱名单不全的问题 by toby","修改: 将 Bright Summit 加入友帮列表 by toby","修改: 简化攻击界面目标状态相关代码 by toby","修改: 更新冰蛙菜单查看 API 中的选项列表 by toby"]},"3.1.10":{date:"2023.03.19",notes:["修复: 修复起飞时 OC 提醒按钮点击无效的问题 by toby","修改: 犯罪经验中忽略 merit 重置导致的 nnb 变化 by toby"]},"3.1.9":{date:"2023.02.19",notes:["修复: 适配 PDA 2.9.5 (建议 PDA 用户在 START/END 中选择 START) by toby","修改: 毒瘾分析中正确处理拉满的戒毒记录 by toby","修改: 未设置 API Key 时不再自动跳转 by toby","修改: PDA 不再需要手工修改 @match 部分 by toby"]},"3.1.8":{date:"2023.02.15",notes:["新功能: 毒瘾分析 by toby","新功能: 增加起飞前 OC 弹窗提醒 by toby","修复: 在 API 超时或返回临时错误时重试 by toby","修改: 墙上敌人 bs 优先使用冰娃目标缓存数据 by toby","修改: 删除世界局势和近期RW功能 by toby","修改: 使聊天窗口时间戳和快捷取钱按钮不可选中 by toby"]},"3.1.7":{date:"2022.10.28",notes:["新功能: attack页面右侧显示RW武器技能描述 by htys","修复: 修复最近攻击功能的错误，并且设为默认不开启，需要在设置中手动开启 by htys","修复: 修复attack页面玩家名字英文大写被改成小写的错误 by htys","修改: 聊天记录被保存时间从5秒减少到1秒 by htys","修改: 取消最近唠嗑的阅兵需求，并可以在手机上显示了 by htys","修改: 修改了部分页面的颜色显示，使其在dark mode下更加和谐 by htys"]},"3.1.6":{date:"2022.10.23",notes:["新功能: 帮派chain页面额外显示更多5分钟内攻击记录(减少错过的复仇) by htys","新功能: 帮派取钱页面在更加明显的位置显示收款人余额 by htys"]},"3.1.5":{date:"2022.10.22",notes:["修复: 取钱快捷方式和帮派聊天快速取钱 by htys","修复: 冰蛙目标页面可以长按显示mini profile了 by htys","修复: PDA可以使用冰蛙目标了(只能导入csv格式) by htys"]},"3.1.4":{date:"2022.10.20",notes:["修复: 冰蛙主页面宽度现在可以适配手机了 by htys","修复: attack界面血量百分比，手机上出现攻守双方名字相同的bug by htys","修改: 修改冰蛙目标栏目顺序以更加适合手机上输出 by htys"]},"3.1.3":{date:"2022.10.20",notes:["新功能: mini profile界面新增攻击按钮 by htys","新功能: attack界面显示敌我双方血量百分比(斩杀武器技能可能有用) by htys","修复: 冰蛙主界面位置偏左的问题 by htys","修改: 优化手机模式下APIKEY选取界面UI by htys","修改: attack界面取消chain显示，将刷新按钮移动到原来显示chain的位置 by htys"]},"3.1.2":{date:"2022.10.11",notes:["修复: 在脚本头部引用了jQuery插件库以解决bust菜单无法使用的问题 by toby"]},"3.1.1":{date:"2022.10.11",notes:["修复: Update regex of bust perks by toby","修复: 在脚本头部引用了jQuery库以解决油猴更新后冰蛙无法使用的问题 by htys","修复: 更新了perks的正则匹配以解决小护士的显示问题 by htys","修改: 缩小了mini profile界面BS显示的区域以避免在手机模式下遮挡重要信息 by htys"]},"3.1.0":{date:"2022.09.23",notes:["修复: Fix bust filter not hiding targets with zero probability by toby","修改: 优化APIKEY选取界面UI by htys","修改: 优化mini profile界面额外信息UI by htys","修改: 地盘战显示墙上BS - 可以显示友方和第三方BS了 by htys","修改: 地盘战显示预估结束时间 by htys"]},"3.0.9":{date:"2022.09.21",notes:["修复: 修复犯罪经验计算中 NNB 升降时间识别问题 by toby","修复: Match API responses case-insensitively by toby","修复: 友邦列表新增 SMTH - Concord by htys"]},"3.0.8":{date:"2022.08.11",notes:["修复: 无论在城里还是在飞行，看别人的公司页面都输出员工状态表"]},"3.0.7":{date:"2022.08.09",notes:["修复: 修复监狱助手与新版 TornPDA 的冲突 by toby"]},"3.0.6":{date:"2022.07.10",notes:["修改: 冰蛙目标 - 重写部分内容以改善页面卡顿 by htys","修改: 冰蛙目标 - 住院时间更新频率为每秒一次 by htys","修改: 冰蛙目标 - 当有多个冰蛙目标页面打开时，最多只允许一个页面正常刷新 by htys"]},"3.0.5":{date:"2022.07.01",notes:["新功能: 监狱bust - 完全重做并新增估算bust成功率 by toby","新功能: gym页面 - 界面微调并新增检测何时可吃SE by htys"]},"3.0.4":{date:"2022.06.23",notes:["新功能: 冰蛙目标 - 加入过滤功能 by htys","修改: 冰蛙目标 - 当cdn不可用时增加了错误提示 by htys","修改: 从友方帮派中移除LND by htys"]},"3.0.3":{date:"2022.06.10",notes:["新功能: 聊天记录(代替抢劫历史) by htys","新功能: 帮派详情 - 新增显示能否被复活(需要阅兵) by htys","修改: 犯罪经验 - 修正犯罪惩罚公式 by toby","修改: 犯罪经验 - 删除犯罪经验的保存数据按钮 by toby","修改: 插件中心添加对PDA 2.8.0的支持 by mirror","修改: 聊天时间戳外观微调 by htys","修复: 修复最后唠嗑时间不显示的问题 by microdust"]},"3.0.2":{date:"2022.05.13",notes:["新功能: 插件中心 by mirror","新功能: 查询bust惩罚 by toby","修改: 犯罪经验 - 日志页面增加导出按钮 by toby","修改: 犯罪经验 - 增加犯罪经验数据收集说明 by toby","修改: 冰蛙目标支持导入csv格式文件 by microdust","修复: gym页面加成数字不显示的问题 by htys","修复: home页面perks显示错位的问题 by htys","修复: market search页面有时会不显示bazaar的问题 by htys"]},"3.0.1":{date:"2022.04.29",notes:["修改: 公司效率估算公式 by microdust","修改: 聊天框取钱跳转优化 by mirror","修改: 放宽对 NNB 升降级事件的时间要求 by toby","修复: 阅兵 by mirror","修复: 替换空值合并运算符 by toby"]},"3.0.0":{date:"2022.04.07",notes:["新功能: 犯罪经验 by toby"]},"2.9.9":{date:"2022.04.05",notes:["新功能: 灵活配置快捷取钱按钮 by mirror","新功能: 聊天栏添加取钱按钮 by mirror","修改: 公司数据拉取时机 by mirror","修复: 修复在高级搜索界面时，打开honerbar的时候上次唠嗑不显示的问题 by mirror"]},"2.9.8":{date:"2022.03.31",notes:["修改: 冰蛙目标页面 - 添加bs提示","修改: 友好帮派增加pta新帮","修复: 唠嗑时间在转换时区时有多余空格的bug"]},"2.9.7":{date:"2022.02.27",notes:["新功能: attack页面 - 显示chain进度，防止bonus打偏","修改: 公司页面 - 新增效率估算","修改: 冰蛙目标页面 - 若出院时间小于10分钟，则根据出院时间逐渐降低背景色透明度","修改: 搜索页面 - 若与目标超过35天未有聊天行为，则最近唠嗑显示为灰色","修复: 无法阅兵的bug"]},"2.9.6":{date:"2022.02.22",notes:["新功能: profile页面和mini profile页面显示血条"]},"2.9.5":{date:"2022.02.15",notes:["新功能: 冰蛙目标，自动刷新的目标监视利器","新功能: 帮派详情增加level和id显示","修复: 小护士调整小数保留位数"]},"2.9.4":{date:"2022.01.24",notes:["修复: 部分顶部链接","修复: miniBS显示位置","修复: PTA取钱功能","修复: 帮派页面显示阅兵、BS、离线时间和住院时间，取消排序功能"]},"2.9.3":{date:"2022.01.08",notes:["新功能：近期RW显示服务器近期RW的记录"]},"2.9.2":{date:"2022.01.04",notes:["新功能：帮派取钱现在在更加明显的位置提示余额，并且新增加了全取按钮","新功能：侧边栏现在有冰蛙图标了","修复：修复了飞行时读取不到自己id导致的公司页面无法显示问题","修复：帮派详情页面增加了显示内容（帮派图标和rank等级）"]},"2.9.1":{date:"2021.12.30",notes:["修复：修正了某些API的匹配格式，使得小护士可以正常运行","修复：更新了profile页面的攻击链接，现在玩家在医院可以读取完整的战斗页面了","修复：为一部分表格增加横向拖动条，使其在超出手机屏幕宽度时也可以显示完整内容（感谢Woohoo）","修复：微调了profile页面BS显示相关内容"]},"2.9.0":{date:"2021.12.28",notes:["新功能：小护士现在可以分别按照【出院模式】和【满血模式】提供建议","新功能：profile页面新增估算WS","新功能：针对公司老板新增显示公司货物库存","修复：修复了mini profile上估算bs重复显示的问题","修复：修复了小护士有时获取不到住院时间的问题","修复：修复了帮派余额和准备金率显示错误的问题","修复：profile连续活跃天数重新修改为冰蛙活跃天数","修复：修改了某些配色以解决深色模式下看不清的问题","修复：现在飞行无云功能不再显示飞机图片了","修复：针对非东8区用户修改了唠嗑时间显示不正确的问题","修复：更新了key->info和rankedwarreport等API条目"]},"2.8.9":{date:"2021.12.09",notes:["新功能：自己帮派的Ranked War界面会显示敌人bs(需提前对该帮派阅兵)，并且可以按bs排序","修复：小护士读取不到API时的报错","修复：faction和company重绘读取不到API时的报错"]},"2.8.8":{date:"2021.11.24",notes:["修复：使用API重绘faction和company页面时匹配不同url","修复：一个神奇的bug"]},"2.8.7":{date:"2021.11.23",notes:["新功能：在个人profile页面显示上次聊天时间和上次mug时间金额","新功能：在高级搜索页面显示上次聊天时间"]},"2.8.6":{date:"2021.11.19",notes:["新功能：mini profile显示冰蛙估算战力","新功能：帮派仓库增加快捷取钱按钮","修改：使用帮派药品出院时也可以获得小护士建议了"]},"2.8.5":{date:"2021.11.08",notes:["新功能：战斗页面增加显示目标在线状态","修改：冰蛙APIKey读取页面UI","修改：阅兵可以按bazaar金额筛选目标，增加bazaar链接","修改：在飞行入院或入狱时也可以在company.php页面查看效率表格了"]},"2.8.4":{date:"2021.11.01",notes:["新功能：战斗页面增加量化显示stealth隐身概率","新功能：item页面增加小护士智能出院建议","新功能：在自己帮派的战斗中，会显示墙上敌人的bs(需提前对该帮派阅兵)","修复PDA会重复载入冰蛙的bug(感谢Woohoo-)"]},"2.8.3.1":{date:"2021.10.25",notes:["公司管理中增加显示本周销售额（实时数据）和近一周利润（缓存数据）","公司管理表格改为显示到公司页面的下方"]},"2.8.3":{date:"2021.10.23",notes:["起飞页面增加吃药cd和oc提醒功能","bounty页面增加自动阅兵功能，默认关闭需在设置中手动开启","个人页面的冰蛙检测增加显示活跃天数，删除ECS数量","在个人页面enemy数量右侧增加显示坏比指数","points市场目标提示现在可以显示新人和衣服店了"]},"2.8.2":{date:"2021.10.08",notes:["启用更精确的计算监狱分数公式并且显示分数提高到25000","修复阅兵bug"]},"2.8.1":{date:"2021.09.30",notes:["取消大乱斗功能","取消oc提醒功能"]},"2.8.0":{date:"2021.09.11",notes:["新增大乱斗阅兵","优化了大乱斗界面"]},"2.7.9":{date:"2021.09.09",notes:["新增了API条目","更新了顶部快捷链接","阅兵可以显示大乱斗所在队伍","在海外也可以查看大乱斗"]},"2.7.8":{date:"2021.08.18",notes:["阅兵可以显示目标bazaar内全部物品价值总和"]},"2.7.7":{date:"2021.06.20",notes:["公司排行页面可以进行公司阅兵了","增加新的快捷打劫链接","不再显示已售空的额外的bazaar","buymug时加入自己人防误伤提醒","OC即将开始时进入飞行界面将获得更加明显的提示","隐藏laptop边框","飞行时不显示云和飞机"]},"2.7.6":{date:"2021.05.29",notes:["不是老板也能查看我的公司表格了","新增帮派取钱助手"]},"2.7.5.2":{date:"2021.05.29",notes:["聊天框时间戳不显示秒","Jail界面增加显示更多按钮","海外库存界面增加显示更多按钮"]},"2.7.5.1":{date:"2021.05.27",notes:["修复聊天框时间戳"]},"2.7.5":{date:"2021.04.12",notes:["顶部链接、健身房、赛车界面UI微调"]},"2.7.4":{date:"2021.04.01",notes:["飞行时查看的公司页面增加TV和油厂的单价估算"]},"2.7.3":{date:"2021.03.30",notes:["我的公司页面UI微调"]},"2.7.2":{date:"2021.03.23",notes:["添加顶部链接和健身房的开关","在股票交易市场页面显示股票缩写"]},"2.7.1":{date:"2021.03.10",notes:["我的公司页面新增显示各员工工资和当前公司实时数据，修复保存31天显示32天的bug","飞行中的帮派信息页区分显示正在被突击和主动突击别人"]},"2.7.0":{date:"2021.02.14",notes:["修改imarket search页面，增加显示目标bazaar内全部物品价值总和","新增功能复活助手"]},"2.6.9":{date:"2021.02.11",notes:["帮派对比功能重做以显示更多数据","加入更多设置选项","index页面加入一键显示全部perks"]},"2.6.8":{date:"2021.02.02",notes:["新增世界局势功能，显示所有正在进行的地盘战，按战况激烈程度染色"]},"2.6.7":{date:"2021.01.24",notes:["在飞行/医院/监狱中也可以查看自己/他人Bazaar中物品"]},"2.6.6.3":{date:"2021.01.22",notes:["解决gym页面与torntools兼容问题"]},"2.6.6.2":{date:"2021.01.19",notes:["修改一些可能存在的bug","Gym页面提供Hank和Baldr属性比例参考","监视列表可以自由添加玩家ID，被监视的目标在海外被高亮（橙色）显示"]},"2.6.6.1":{date:"2021.01.19",notes:["查看个人profile页面的Last action显示为x天x时x分x秒"]},"2.6.6":{date:"2021.01.14",notes:["我的公司及飞行中看帮派、公司功能汉化。","飞行中看帮派信息增加chain、地盘战、raid战的信息。","产量数据支持多种库存的公司。"]},"2.6.5.1":{date:"2021.01.13",notes:["对使用过【我的公司】功能的，每天进游戏时自动检查抓取昨晚的公司运营数据。"]},"2.6.5":{date:"2021.01.11",notes:["公司效率表格微调：增加inactivy，调整列顺序","新增公司历史数据表格","飞行时也能看帮派和公司页面"]},"2.6.4.1":{date:"2021.01.05",notes:["优化公司效率表格显示，并且海外可查看"]},"2.6.4":{date:"2021.01.04",notes:["公司页面显示效率表格","聊天框显示时间戳"]},"2.6.3":{date:"2020.12.28",notes:["顶部增加简易导航条，从api.torn.com更新了API条目","优化阅兵功能，增加暂停和继续按钮","优化帮派对比功能，增加历史记录和高亮显示leader","增加抢劫历史功能，可以从历史记录中选择目标加入监视列表"]},"2.6.2":{date:"2020.11.11",notes:["修复顶部链接导致页面排版错乱的问题","payday功能只向leader和coleader提供"]},"2.6.1":{date:"2020.10.22",notes:["美化排版：pmarket、imarket(search)、imarket页面在显示bs时不再影响原始布局","市场显示超过3个bazaar：imarket(search)页面显示bazaar数量不再局限于3个","bazaar页面简易计算器：可以通过点击选中物品，页面顶部显示选中物品的总价值"]},"2.6.0":{date:"2020.09.28",notes:["itemmarket/pointmarket/bazaar界面增加3个mug相关脚本（感谢Mirror），使用mugoo=true开启","revivehelper重命名为facPageEnhanced，显示内容优化，使用foo=true开启","阅兵模块优化，增加阅兵内容选项，所有阅兵相关功能都使用foo=true开启","监狱置顶标记友帮成员，无视分数","海外people界面用颜色标记友帮和敌帮成员"]},"2.5.9":{date:"2020.09.16",notes:["修复飞花增强功能失效的bug"]},"2.5.8":{date:"2020.11.11",notes:["回滚上版本第一条，因为networth会变化，持续7天才触发rank","蛙蛙探测显示更多页面里的锻炼总能量换成Booster数量"]},"2.5.7":{date:"2020.08.14",notes:["当rank反推的bs上限低于估算值时，忽略估算值，使用rank反推的上下限区间","修复蛙蛙探测显示更多页面排版问题","帮派页面Revive增强功能默认关闭，需要时请将代码头部 reviveHelper 设为 true 手动开启"]},"2.5.6":{date:"2020.08.01",notes:["飞行中也可以方便的查看帮派成员状态，以及支持包括自己帮在内的最多3个帮派横向对比"]},"2.5.5.1":{date:"2020.07.30",notes:["修复一些取款小bug，给自己取款时，输入.或者?(英文标点)可自动替换为本人名字，减少输入时间"]},"2.5.5":{date:"2020.07.30",notes:["屏蔽全取按钮，选择取款目标时显示目标额度"]},"2.5.4":{date:"2020.07.27",notes:["增加帮派成员界面一系列功能：阅兵，显示bs、上次登录时间、旅行状态和住院时间，高亮标记住院成员，排序等"]},"2.5.3":{date:"2020.07.07",notes:["增加防打重功能，开关noAssisting = true"]},"2.5.2":{date:"2020.06.17",notes:["修复顶部链接导致页面排版错乱的问题"]},"2.5.1":{date:"2020.06.15",notes:["修复阅兵转换为csv有时丢失某些列的问题"]},"2.5.0":{date:"2020.06.05",notes:["搜索及海外用户列表阅兵功能优化：过滤5b以下，显示mugged, rehabcost, rank, job"]},"2.4.9":{date:"2020.06.05",notes:["飞行中也可以方便的查看帮派成员状态，以及支持包括自己帮在内的最多3个帮派横向对比"]},"2.4.8":{date:"2020.06.04",notes:["jailview 按 jailscore 排序，并优化体验","更新看库存的链接","用户搜索页面增加阅兵功能"]},"2.4.7":{date:"2020.04.26",notes:["左上角菜单中新增常用链接：市场","jailview页面增强：显示各目标的 分钟数*级别；过滤大于1万的；bust不需要二次确认（类似DN的quick bust功能）"]},"2.4.6":{date:"2020.04.26",notes:["左上角菜单中新增常用链接：赛车/啤酒/飞行/库存"]}};let n="",o=0,i="",r=0;for(e in a)if(r<10){i+=a[e].date+" --v"+e+"\n";for(let t=0;t<a[e].notes.length;t++)i+="    "+a[e].notes[t]+"\n";i+="\n";let t=e.split(".");t.splice(1,0,"."),t.join("");var s=parseFloat(t);s>o&&(o=s,n=e),r++}return[n,i]}"loading"===document.readyState?document.addEventListener("readystatechange",()=>{"interactive"===document.readyState&&bingwaMain()}):bingwaMain();/* 冰蛙宝鉴到此结束 */
